!function(a){define(function(require,b,c){function d(){var b=p.getLoginInfo(),c=b.username,d=b.password,f=b.logintype,g=a("#pre_type").val()-0;"ActiveDirectory"===f&&(g=13),"LDAP"===f&&(g=12),e(),plugin.login(c,d,g).done(function(){q.leave(),webApp.IsSDIntel&&o.DevIntelliTracker.start(),require.async("index_page",function(b){q.indexPage=new b({element:a("#main").translation()})})})}function e(){(""==a("alarm_frame").src||location.href.contains(a("alarm_frame").src))&&(IS_CGI_SEND=!0,alarmCGI.open(),alarm_timer=setInterval("showAlarmTips()",1e3)),window.setTimeout(function(){var a=["NewFirmware"];o.EventManager.attach(a).done(function(a){a&&f()})},8e3)}function f(){o.Upgrader.check().done(function(a){g_cloudInfo=a.info,g_cloudInfo&&"None"!=g_cloudInfo.State&&(s=!0,"regular"==g_cloudInfo.type.toLocaleLowerCase()?h():g())})}function g(){plugin.hide(),a("#upgradeDialog").show(),a("#go_updata").click(function(){canUpgrade=!0,webApp.dandan=!0,a('[data-for="set"]').trigger("click"),a('[filename = "upgradeConfig"]').trigger("click"),a("#upgradeDialog").hide()})}function h(){plugin.hide(),a("#cloudDialog").show(),a("#cloud_curVer").text(g_cloudInfo.OldVersion),a("#cloud_upVer").text(g_cloudInfo.NewVersion),a("#cloud_updata").click(function(){canUpgrade=!0,webApp.dandan=!0,a('[data-for="set"]').trigger("click"),a('[filename = "upgradeConfig"]').trigger("click"),a("#cloudDialog").hide()}),a("#cloud_cancel").click(function(){g_cloudInfo=null,t=!0,a("#cloudDialog").hide(),plugin.cover()})}function i(){plugin.logout(),p.logout()}var j,k=require("/jsCore/pageBase"),l=require("common/common"),m=l.Cookie,n=l.Check,o=(require("/jsCore/ability"),require("/jsCore/rpc")),p=require("/jsCore/rpcLogin"),q=null,r=null,s=!1,t=!1;c.exports=k.extend({init:function(){if(q=this,q.$("#login_user").textfield(),q.$("#login_psw").textfield().on("keydown",function(a){13===a.keyCode&&(q.$("#login_psw").blur(),q.$("[btn-for=onLogin]").click())}),r=q.$("#login_modify").dialog({confirm:function(){return j.isInvalid()?j.validate():(r.closeFlag=!0,r.dialog("close"),r.closeFlag=!1,void o.MagicBox.getSerialNo().done(function(b){var c,e,f="Login to "+b,g=p.getLoginInfo(),h=r.find("[name=newpwd]").textfield("value");webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&webCaps.OnvifSync?(c=h,e=g.password):(c=hex_md5(g.username+":"+f+":"+h),e=hex_md5(g.username+":"+f+":"+g.password)),o.UserManager.modifyPassword(g.username,c,e).done(function(){p.getLoginInfo().password=r.find("[name=newpwd]").textfield("value"),d()}).fail(function(b){var c=b.error.code,d="w_ChangePwdFail";switch(c){case 604:d="w_useMannageErr_InputNotValid";break;case 605:d="w_useMannageErr_IndexOverlap_user";break;case 606:case 607:d="w_useMannageErr_ObjectNotValid_user";break;case 608:d="w_useMannageErr_ObjectInUse_user";break;case 609:d="w_useMannageErr_SubsetOverlap_user";break;case 610:d="w_useMannageErr_SaveCfgError";break;case 611:d="w_useMannageErr_PwdNotValid";break;case 612:d="w_useMannageErr_PwdNotMatch";break;case 613:d="w_useMannageErr_ReservedAccount";break;case 614:d="w_useMannageErr_TooManyGroup";break;case 615:d="w_useMannageErr_TooManyUser"}a.alert(tl(d))})}))},close:function(){!r.closeFlag&&d()}}).detach().appendTo(document.body),r.find(":checkbox").on("change",function(a){m.set("pwdNoTip",a.target.checked?1:0,{expires:365})}),r.find("[name=newpwd2]").textfield({success:a.noop}),r.find("[name=newpwd]").textfield({success:a.noop}).on("keyup",function(){var a=l.pwdStrenthValidator(this.value),b=r.find(".ui-pwd-strength");b.find("li").removeClass("current"),this.value?(b.find("li."+a).addClass("current"),b.removeClass().addClass("ui-pwd-strength").addClass(a)):b.removeClass().addClass("ui-pwd-strength")}),j=a.validator([{element:r.find("[name=newpwd]"),check:[n.require,n.noQuotationColonAnd,function(a){return a.length>=8},getPasswordStrong],errorMsg:[tl("w_Badlengtsh"),tl("badPwdString"),tl("w_Badlengtsh"),tl("w_errorModifypwd")],events:["keyup","keyup","keyup","keyup"],errorElem:".u-input-error"},{element:r.find("[name=newpwd2]"),check:[n.require,function(a){return a===r.find("[name=newpwd]").val()},n.noQuotationColonAnd],errorMsg:[tl("w_Badlengtsh"),tl("w_PwdDif"),tl("badPwdString")],events:["keyup","keyup","keyup"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),"Dahua"===webApp.Vendor)q.$("#login_logo").addClass("login-logo"),a("#main_logo").addClass("main-logo");else if(-1===webApp.DeviceType.indexOf("SD"))q.$("#login_logo").addClass("login-logo"),a("#main_logo").addClass("main-logo");else switch(webApp.DeviceSubClass){case"SDC":q.$("#login_logo").addClass("login-logo-ipdome"),a("#main_logo").addClass("main-logo-ipdome");break;case"SD_CA":case"SD_CA_ICT":q.$("#login_logo").addClass("login-logo"),a("#main_logo").addClass("main-logo");break;case"SD_PTZ":q.$("#login_logo").addClass("login-logo-ipptz"),a("#main_logo").addClass("main-logo-ipptz");break;default:q.$("#login_logo").addClass("login-logo-ipdome"),a("#main_logo").addClass("main-logo-ipdome")}q.render()},render:function(b){a("#main").hide(),q.element.css("top","50%").show(),"anonymity"!==m.get("username")&&q.$("#login_user").textfield("value",m.get("username")),q.$("#login_psw").textfield("value",""),(isDDNS()||webCaps.Anonymous)&&b!==!0?setTimeout(q.onLogin,100):q.$("#login_user").textfield("value")?q.$("#login_psw").focus():q.$("#login_user").focus(),document.title=tl("w_Login")},leave:function(){q.element.css("top","-100000").hide(),a("#main").show()},destory:function(){r.remove()},onLogin:function(b){var c=q.$("#login_user").textfield("value"),e=q.$("#login_psw").textfield("value"),f=q.$("#login_selType").val()||"Direct";if(!b)if(isDDNS()){var g=getDDNSMessage();c=g.username,e=g.password}else webCaps.Anonymous&&(c="anonymity",e="anonymity");p.login(c,e,f).done(function(){!p.needModifyPsw()||m.get("pwdNoTip")-0?d():(r.find(":password").val(""),r.find(".u-input-error").hide(),r.find(":checkbox").prop("checked",!1),r.find("li").removeClass("current"),r.find(".ui-pwd-strength").removeClass().addClass("ui-pwd-strength"),r.dialog("show"),r.find("[name=newpwd]").focus(),webApp.GongAnDetect&&(r.find("#no_tip").hide(),r.find("#u_close").hide(),r.find("#i_close").hide()))}).fail(function(b){switch(b){case 268632070:alert(tl("The user is not exited."));break;case 268632071:alert(tl("usernameOrPwdError"));break;case 268632073:alert(tl("The user is invalid."));break;case 268632074:alert(tl("The user has logined."));break;case 268632075:alert(tl("the number of connection is maximal.request is refused!"));break;case 268632081:alert(tl("The user is locked."));break;case 268632085:a.alert(tl("usernameOrPwdError"));break;default:alert(tl("Login failure!"))}})},onCancel:function(){q.$("#login_user").textfield("value",""),q.$("#login_psw").textfield("value","")},onLogout:function(){webApp.IsSDIntel&&o.DevIntelliTracker.stop(),plugin.logout(),q.indexPage.leave(),q.indexPage.destory(),q.render(!0),p.logout()}}),a(window).on("unload",i)}),define("index_page",function(require,b,c){var d=require("/jsCore/pageBase"),e=(require("/jsCore/plugin"),webCaps.WebVersion?"?version="+webCaps.WebVersion:"");c.exports=d.extend({init:function(){var b=this,c=b.element.children(".u-tab"),d=b.element.children(".u-tab-content");b.tabs={},b.current=null,c.find("[data-for=ptz]").hide(),login.chkAuthority("Replay_01")&&webApp.IsLocalStore&&!isEnable("is_8M_Flash")?c.find("[data-for=playback]").show():c.find("[data-for=playback]").hide(),a(document.body).css("background",'#000000 url("image/setbg.png") repeat-x'),c.tab({switched:function(a,f){var g=b.tabs[f.from],h=b.tabs[f.to];if(document.title=c.find("[data-for="+f.to+"] a").text(),g&&g.leave(),h)h.render(),b.current=h;else{var i=["/js/"+f.to+".js"+e];switch(f.to){case"logout":return webApp.loginPage.onLogout();case"playback":i.push("/html/"+f.to+".htm"+e);case"alarm":break;case"preview":var j=["/js/alarm.js"+e,"/html/alarm.htm"+e];require.async(j,function(a,c){var e=d.find("[data-page=alarm]");c?e.empty().append(c).translation():e.translation(),b.tabs.alarm=new a({element:e}),b.tabs.alarm.init(!0)});case"ptz":case"set":}require.async(i,function(a,c){var e=d.find("[data-page="+f.to+"]");c?e.empty().append(c).translation():e.translation(),b.tabs[f.to]=new a({element:e}),b.current=b.tabs[f.to]})}}})},render:function(){this.current&&this.current.render()},leave:function(){this.current&&this.current.leave()},destory:function(){a.each(this.tabs,function(b,c){a.isFunction(c.destory)&&c.destory()}),this.current=null,this.tabs=null,this.element.children(".u-tab").tab("destroy"),a(document.body).css("background","#09548E")}})})}(jQuery);