!function(){!function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=!0,l=100/95,m=0,n=0,o=[1,1,1,1],p=[1,1,1,1],q=[],r=[],s={N1:null,N2:null,N3:null,N4:null,F1:null,F2:null,F3:null,F4:null},t=new Class({initialize:function(a,b,c){b.newDom&&(a=this.initDom(a),b.container=$(b.newContainer)),this.element=$(a),this.options=b,this.container=$(this.options.container),this.limitFunc=c;var d=this;b.onDrag||(b.onDrag=function(a){var b=(parseInt(a.style.left)*l).round();d.element.setProperty("title",b),d.setValue(b)}),this.drag=new Drag.Move(a,b),this.element.setProperty("title",0),this.addElement=a.split("_"),this.addElement.pop()&&this.addElement.push("add")&&(this.addElement=this.addElement.join("_")),this.reduceElement=a.split("_"),this.reduceElement.pop()&&this.reduceElement.push("reduce")&&(this.reduceElement=this.reduceElement.join("_")),this.container.addEvent("click",this.containerTick.bind(this)),this.addElement&&$(this.addElement).addEvent("click",this.add.bind(this)),this.reduceElement&&$(this.reduceElement).addEvent("click",this.reduce.bind(this))},initDom:function(a){var b=$(a);return b.innerHTML='<a class="ui-slider-less" href="javascript:;" id="'+a+'_reduce"></a>                            <div id="'+a+'_first" class="ui-lightbg-slider">                                <div class="ui-lightbg-slider-bg" id="'+a+'_pic">                                    <div id="'+a+'_end" class="ui-slider-sax"></div>                                </div>                            </div>                            <a class="ui-slider-more" href="javascript:;" id="'+a+'_add"></a>                            <span class="ui-slider-text" id="'+a+'_label">0</span>',a+"_end"},add:function(){var a=this.element.getProperty("title")-0,b=this.limitFunc();100>b&&a>=0&&100>a&&(a+=1,this.setValue(a,!0))},reduce:function(){var a=this.element.getProperty("title")-0;a>0&&100>=a&&this.setValue(--a,!0)},setValue:function(a,b){var c=this.limitFunc(),d=this.element.id.split("_");d.splice(4,1,"pic"),d=d.join("_");var e=this.element.id.split("_");e.splice(4,1,"label"),e=e.join("_"),a=c>100?100+a-c:a,this.element.style.left=(a/l).round()+"px",$(d).style.width=parseInt(this.element.style.left)+10+"px",$(e).setProperty("text",a),this.element.style.top="-1px",this.element.setProperty("title",a),b&&this.options.onComplete(a)},containerTick:function(a){var b=a.page.x-this.container.getPosition().x-5,c=(b*l).round().limit(0,100);this.element.setProperty("title",c),this.setValue(c,!0)}}),u=Page.IRLightConfig={init:function(){a=rpc.PTZ,u.translate(),u.bind().done(function(){u.render()})},translate:function(){$("light").set("text",tl("w_IRLight")),$("light_footStep_title").set("text",tl("w_Step")),$("light_zoom_title").set("text",tl("w_Zoom")),$("light_focus_title").set("text",tl("w_Focus")),$("light_iris_title").set("text",tl("w_Iris")),$("light_infrared_near_mode_title").set("text",tl("w_Mode")),$("light_iris_title").set("text",tl("w_Iris"));var a=$("light_infrared_near_mode").getElements("option");a[0].setProperty("text",tl("w_zoomPrio")),a[1].setProperty("text",tl("w_Manual")),$("light_infrared_correction_title").set("text",tl("w_IRcomensation")),$("light_infrared_near1_enable_title").set("text",tl("w_Mode")),$("light_infrared_near1_enable_title").set("text",tl("w_NearLight1")),$("light_infrared_near2_enable_title").set("text",tl("w_NearLight2")),$("light_infrared_near3_enable_title").set("text",tl("w_NearLight3")),$("light_infrared_near4_enable_title").set("text",tl("w_NearLight4")),$("light_infrared_far1_enable_title").set("text",tl("w_FarLight1")),$("light_infrared_far2_enable_title").set("text",tl("w_FarLight2")),$("light_infrared_far3_enable_title").set("text",tl("w_FarLight3")),$("light_infrared_far4_enable_title").set("text",tl("w_FarLight4")),$("light_infrared_near1_bright_title").set("text",tl("w_NearLight1")),$("light_infrared_near2_bright_title").set("text",tl("w_NearLight2")),$("light_infrared_near3_bright_title").set("text",tl("w_NearLight3")),$("light_infrared_near4_bright_title").set("text",tl("w_NearLight4")),$("light_infrared_far1_bright_title").set("text",tl("w_FarLight1")),$("light_infrared_far2_bright_title").set("text",tl("w_FarLight2")),$("light_infrared_far3_bright_title").set("text",tl("w_FarLight3")),$("light_infrared_far4_bright_title").set("text",tl("w_FarLight4")),$("page_LightConfig").translation()},render:function(){rpc.ConfingManager.getConfig("Lighting").done(function(a){lightingList=a[0][0],u._RenderElements()}).fail(function(){remarkDisplay("light_infrared_remark",tl("Operateingfailure"),3e3,1)}),u._loadlightocx()},bind:function(){return u._sliderInit().done(function(){var a={light_boat_Up:1,light_boat_Left:2,light_boat_Right:4,light_boat_Down:5};for(var b in a)u._onDirectionEvent(b,a[b]);$$("#page_LightConfig .lightcontrol").addEvent("mousedown",function(){this.addClass("mouse-down");var a=this.id.split("_");rpc.PTZ.start(a[2],$("light_footStep").value-0,0,0)}),$$("#page_LightConfig .lightcontrol").addEvent("mouseup",function(){this.removeClass("mouse-down");var a=this.id.split("_");rpc.PTZ.stop(a[2],$("light_footStep").value-0,0,0)}),$$("#page_LightConfig .lightcontrol").addEvent("mouseout",function(){if(this.hasClass("mouse-down")){this.removeClass("mouse-down");var a=this.id.split("_");rpc.PTZ.stop(a[2],$("light_footStep").value-0,0,0)}}),$("light_vedioControl_snap").addEvent("click",u._onSnapPictureClick),$("light_infrared_near_mode").addEvent("change",u._onModeChange),$$("#light_infrared_wrap input[id^=light_infrared_]").addEvent("click",u._setconfig),$("lightConfig_help").addEvent("click",function(){openHelp("IRLightConfig.htm")})})},_onDirectionEvent:function(a){var b=a.split("_");$(a).addEvent("mouseover",function(){$("light_boatX").addClass("ui-boat-current-"+b[2].toLowerCase())}),$(a).addEvent("mouseout",function(){$("light_boatX").removeClass("ui-boat-current-"+b[2].toLowerCase()),$(a).removeClass("ui-boat-current-"+b[2].toLowerCase()),this.hasClass("mouse-down")&&(this.removeClass("mouse-down"),rpc.PTZ.stop(b[2],$("light_footStep").value-0,0,0))}),$(a).addEvent("mousedown",function(){this.addClass("mouse-down"),$(a).addClass("ui-boat-current-"+b[2].toLowerCase());var c=a.split("_");rpc.PTZ.start(c[2],$("light_footStep").value-0,0,0)}),$(a).addEvent("mouseup",function(){this.removeClass("mouse-down"),$(a).removeClass("ui-boat-current-"+b[2].toLowerCase()),rpc.PTZ.stop(b[2],$("light_footStep").value-0,0,0)})},_seriousSend:function(a){var b=a.split("_");$(a)&&$(a).hasClass("ui-boat-current-"+b[2].toLowerCase())&&(cptzd(!0,b[2],$("light_footStep").value-0,0,!1),u._seriousSend.delay(500,"",a))},_onSnapPictureClick:function(){$("ocx").SubVideoWndCtrl(2,6)},_onModeChange:function(){"ZoomPrio"==$("light_infrared_near_mode").value?($("light_infrared_correction_wrap").style.display="",$("light_infrared_wrap").style.display="none"):($("light_infrared_correction_wrap").style.display="none",$("light_infrared_wrap").style.display=""),u._setconfig()},_sliderInit:function(){return ability.get("Focus").done(function(a){$("light_focus_wrap").style.display=a&&a.Support?"":"none"}),ability.get("Iris").done(function(a){$("light_iris_wrap").style.display=a&&a.Support?"":"none"}),ability.get("LightingControl").done(function(a){if(a){m=a.NearLightNumber,n=a.FarLightNumber;var l=a.ModeList||[];if(k=l.contains("On-Off")?!1:!0,a.Power){var s=a.Power.NearLight||[],v=a.Power.FarLight||[];o=[0,0,0,0],p=[0,0,0,0],s.each(function(a){o[a-1]=1}),v.each(function(a){p[a-1]=1})}else o=[1,1,1,1],p=[1,1,1,1];if(a.AngleControl&&(q=a.AngleControl.NearLight||[],r=a.AngleControl.FarLight||[],u._angleControlSliderInit()),$("light_infrared_near_mode_wrap").style.display=l.length<2?"none":"",$("light_infrared_wrap").style.display="",m>0){if(k){$("light_infrared_near1_bright_wrap").style.display="";var w=o[0]?u._lightValueSum:u._lightValueSumNot;c=new t("light_infrared_near1_bright_end",{container:$("light_infrared_near1_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_near1_enable_wrap").style.display="";if(1==m&&($("light_infrared_near1_enable_title").set("text",tl("w_NearLight")),$("light_infrared_near1_bright_title").set("text",tl("w_NearLight")),1>n&&$("light_infrared_near1_bright_title").set("text",tl("w_IRLight"))),m>1){if(k){$("light_infrared_near2_bright_wrap").style.display="";var w=o[1]?u._lightValueSum:u._lightValueSumNot;d=new t("light_infrared_near2_bright_end",{container:$("light_infrared_near2_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_near2_enable_wrap").style.display="";if(m>2){if(k){$("light_infrared_near3_bright_wrap").style.display="";var w=o[2]?u._lightValueSum:u._lightValueSumNot;e=new t("light_infrared_near3_bright_end",{container:$("light_infrared_near3_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_near3_enable_wrap").style.display="";if(m>3)if(k){$("light_infrared_near4_bright_wrap").style.display="";var w=o[3]?u._lightValueSum:u._lightValueSumNot;f=new t("light_infrared_near4_bright_end",{container:$("light_infrared_near4_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_near4_enable_wrap").style.display=""}}}if(n>0){if(k){$("light_infrared_far1_bright_wrap").style.display="";var w=p[0]?u._lightValueSum:u._lightValueSumNot;g=new t("light_infrared_far1_bright_end",{container:$("light_infrared_far1_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_far1_enable_wrap").style.display="";if(1===n&&($("light_infrared_far1_enable_title").set("text",tl("w_FarLight")),$("light_infrared_far1_bright_title").set("text",tl("w_FarLight"))),n>1){if(k){$("light_infrared_far2_bright_wrap").style.display="";var w=p[1]?u._lightValueSum:u._lightValueSumNot;h=new t("light_infrared_far2_bright_end",{container:$("light_infrared_far2_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_far2_enable_wrap").style.display="";if(n>2){if(k){$("light_infrared_far3_bright_wrap").style.display="";var w=p[2]?u._lightValueSum:u._lightValueSumNot;i=new t("light_infrared_far3_bright_end",{container:$("light_infrared_far3_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_far3_enable_wrap").style.display="";if(n>3)if(k){$("light_infrared_far4_bright_wrap").style.display="";var w=p[3]?u._lightValueSum:u._lightValueSumNot;j=new t("light_infrared_far4_bright_end",{container:$("light_infrared_far4_bright_first"),x:[0,100],onComplete:function(){u._setconfig()}},w)}else $("light_infrared_far4_enable_wrap").style.display=""}}}if($("light_infrared_wrap").style.display="none","LaserLight"==a.LightType){for(var x=1,y=0;y<a.NearLightNumber;y++){var z=y+1;$("light_infrared_near"+z+"_bright_title").set("text",tl("w_laserLightPower")+" "+x),x++}for(var y=0;y<a.FarLightNumber;y++){var z=y+1;$("light_infrared_far"+z+"_bright_title").set("text",tl("w_laserLightPower")+" "+x),x++}if(a.AngleControl){x=1;for(var y=0;y<q.length;y++)$("light_Angle_N"+q[y]).set("text",tl("w_laserLightAngle")+x),x++;for(var y=0;y<r.length;y++)$("light_Angle_F"+r[y]).set("text",tl("w_laserLightAngle")+x),x++}}$("light_infrared_correction_wrap").style.display="",b=new FineSlider("light_infrared_correction_first",$("light_infrared_correction_end"),{range:[1,5],onComplete:function(){u._setconfig()}}),$("light_infrared_correction_wrap").style.display="none"}})},_angleControlSliderInit:function(){q.each(function(a){var b=u._lightValueSumNot;s["N"+a]=new t("light_infrared_nAng"+a+"_bright",{newDom:!0,newContainer:"light_infrared_nAng"+a+"_bright_first",x:[0,100],onComplete:function(a){if("number"===$type(a)){var b=$(this.container).getProperty("id").substr(19,1)-1;u._setAngle("NearLight",b,a),u._setconfig()}}},b),$("light_infrared_nAng"+a+"_wrap").removeClass("fn-hide")}),r.each(function(a){var b=u._lightValueSumNot;s["F"+a]=new t("light_infrared_fAng"+a+"_bright",{newDom:!0,newContainer:"light_infrared_fAng"+a+"_bright_first",x:[0,100],onComplete:function(a){if("number"===$type(a)){var b=$(this.container).getProperty("id").substr(19,1)-1;u._setAngle("FarLight",b,a),u._setconfig()}}},b),$("light_infrared_fAng"+a+"_wrap").removeClass("fn-hide")})},_RenderElements:function(){$("light_infrared_near_mode").value=lightingList.Mode,$("light_infrared_wrap").style.display="","ZoomPrio"==lightingList.Mode?($("light_infrared_correction_wrap").style.display="",$("light_infrared_wrap").style.display="none",b.set(lightingList.Correction+1)):($("light_infrared_wrap").style.display="",$("light_infrared_correction_wrap").style.display="none",k?(m>0&&c.setValue(lightingList.NearLight[0].Enable?lightingList.NearLight[0].Light:0),m>1&&d.setValue(lightingList.NearLight[1].Enable?lightingList.NearLight[1].Light:0),m>2&&e.setValue(lightingList.NearLight[2].Enable?lightingList.NearLight[2].Light:0),m>3&&f.setValue(lightingList.NearLight[3].Enable?lightingList.NearLight[3].Light:0),n>0&&g.setValue(lightingList.FarLight[0].Enable?lightingList.FarLight[0].Light:0),n>1&&h.setValue(lightingList.FarLight[1].Enable?lightingList.FarLight[1].Light:0),n>2&&i.setValue(lightingList.FarLight[2].Enable?lightingList.FarLight[2].Light:0),n>3&&j.setValue(lightingList.FarLight[3].Enable?lightingList.FarLight[3].Light:0)):(m>0&&($("light_infrared_near1_enable").checked=lightingList.NearLight[0].Enable),m>1&&($("light_infrared_near2_enable").checked=lightingList.NearLight[1].Enable),m>2&&($("light_infrared_near3_enable").checked=lightingList.NearLight[2].Enable),m>3&&($("light_infrared_near4_enable").checked=lightingList.NearLight[3].Enable),n>0&&($("light_infrared_far1_enable").checked=lightingList.FarLight[0].Enable),n>1&&($("light_infrared_far2_enable").checked=lightingList.FarLight[1].Enable),n>2&&($("light_infrared_far3_enable").checked=lightingList.FarLight[2].Enable),n>3&&($("light_infrared_far4_enable").checked=lightingList.FarLight[3].Enable))),u._renderAngle()},_lightValueSum:function(){var a=0;return c&&o[0]&&(a+=$("light_infrared_near1_bright_end").getProperty("title")-0),d&&o[1]&&(a+=$("light_infrared_near2_bright_end").getProperty("title")-0),e&&o[2]&&(a+=$("light_infrared_near3_bright_end").getProperty("title")-0),f&&o[3]&&(a+=$("light_infrared_near4_bright_end").getProperty("title")-0),g&&p[0]&&(a+=$("light_infrared_far1_bright_end").getProperty("title")-0),h&&p[1]&&(a+=$("light_infrared_far2_bright_end").getProperty("title")-0),i&&p[2]&&(a+=$("light_infrared_far3_bright_end").getProperty("title")-0),j&&p[3]&&(a+=$("light_infrared_far4_bright_end").getProperty("title")-0),a},_lightValueSumNot:function(){return 0},_renderAngle:function(){q.each(function(a){var b=lightingList.NearLight[a-1];b=b||{};var c=b.Angle||0;s["N"+a].setValue(c)}),r.each(function(a){if(lightingList.FarLight[a-1]){var b=lightingList.FarLight[a-1].Angle||0;s["F"+a].setValue(b)}})},_setAngle:function(a,b,c){var d=lightingList[a][b];d=d||{},d.Angle=c-0},_setconfig:function(){lightingList.Mode=$("light_infrared_near_mode").value,k?(m>0&&(lightingList.NearLight[0].Enable=$("light_infrared_near1_bright_end").getProperty("title")-0==0?!1:!0,lightingList.NearLight[0].Light=$("light_infrared_near1_bright_end").getProperty("title")-0),m>1&&(lightingList.NearLight[1].Enable=$("light_infrared_near2_bright_end").getProperty("title")-0==0?!1:!0,lightingList.NearLight[1].Light=$("light_infrared_near2_bright_end").getProperty("title")-0),m>2&&(lightingList.NearLight[2].Light=$("light_infrared_near3_bright_end").getProperty("title")-0,lightingList.NearLight[2].Enable=$("light_infrared_near3_bright_end").getProperty("title")-0==0?!1:!0),m>3&&(lightingList.NearLight[3].Light=$("light_infrared_near4_bright_end").getProperty("title")-0,lightingList.NearLight[3].Enable=$("light_infrared_near4_bright_end").getProperty("title")-0==0?!1:!0),n>0&&(lightingList.FarLight[0].Enable=$("light_infrared_far1_bright_end").getProperty("title")-0==0?!1:!0,lightingList.FarLight[0].Light=$("light_infrared_far1_bright_end").getProperty("title")-0),n>1&&(lightingList.FarLight[1].Enable=$("light_infrared_far2_bright_end").getProperty("title")-0==0?!1:!0,lightingList.FarLight[1].Light=$("light_infrared_far2_bright_end").getProperty("title")-0),n>2&&(lightingList.FarLight[2].Enable=$("light_infrared_far3_bright_end").getProperty("title")-0==0?!1:!0,lightingList.FarLight[2].Light=$("light_infrared_far3_bright_end").getProperty("title")-0),n>3&&(lightingList.FarLight[3].Enable=$("light_infrared_far4_bright_end").getProperty("title")-0==0?!1:!0,lightingList.FarLight[3].Light=$("light_infrared_far4_bright_end").getProperty("title")-0)):(m>0&&(lightingList.NearLight[0].Enable=$("light_infrared_near1_enable").checked),m>1&&(lightingList.NearLight[1].Enable=$("light_infrared_near2_enable").checked),m>2&&(lightingList.NearLight[2].Enable=$("light_infrared_near3_enable").checked),m>3&&(lightingList.NearLight[3].Enable=$("light_infrared_near4_enable").checked),n>0&&(lightingList.FarLight[0].Enable=$("light_infrared_far1_enable").checked),n>1&&(lightingList.FarLight[1].Enable=$("light_infrared_far2_enable").checked),n>2&&(lightingList.FarLight[2].Enable=$("light_infrared_far3_enable").checked),n>3&&(lightingList.FarLight[3].Enable=$("light_infrared_far4_enable").checked)),lightingList.Correction=($("light_infrared_correction_first").getProperty("title")-1).limit(0,4),rpc.ConfingManager.setConfig("Lighting",[[lightingList]]).fail(function(){remarkDisplay("light_infrared_remark",tl("Saving failure"),3e3,1)}),u._RenderElements()},leave:function(){plugin.hide()},_loadlightocx:function(){Site.currentPage.is.IRLightConfig&&plugin.cover("#light_vedio",function(){$("ocx")&&$("ocx").SetRegionNum(0),$("ocx")&&$("ocx").SetModuleMode(1),$("ocx")&&$("ocx").ConnectRealVideo(0,1)})}}}()}();