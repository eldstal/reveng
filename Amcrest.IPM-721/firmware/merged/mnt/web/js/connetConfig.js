!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("Conn-Connect",function(require,b,c){function d(a,b){var c=b.attr("id"),d=b.attr("exceptport")-0;return!w.chkPort(a,d)||"con_udp_port"===c&&a===l.numberfield("value")-1||"con_http_port"===c&&a===l.numberfield("value")-1||"con_rtsp_port"===c&&a===l.numberfield("value")-1?!1:!0}function e(a,b){for(var c=0;c<r.length;++c)if(b[0]!==r[c]&&a===r[c].value)return!1;return!0}function f(a){return a===x?!1:!0}var g,h,i,j,k,l,m,n,o,p,q,r,s,t=require("jsCore/pageBase"),u=require("jsCore/rpc"),v=require("common/rpcBase"),w=require("common/common"),x="5555";c.exports=t.extend({init:function(){var b=this;k=b.$("#con_max_cons").numberfield({max:20,min:1,allowDecimal:!1,allowNegative:!1}),webApp.GongAnDetect&&(b.$("#con_max_cons").numberfield("max",28),b.$("#con_max_20").addClass("fn-hide"),b.$("#con_max_28").removeClass("fn-hide")),l=b.$("#con_tcp_port"),m=b.$("#con_udp_port"),n=b.$("#con_http_port"),o=b.$("#con_rtsp_port"),p=b.$("#con_https_port"),q=b.$("#con_https_enable"),r=b.$("input[name=ports]"),r.numberfield({max:65534,allowDecimal:!1,allowNegative:!1}),q.on("change",function(){j.ServerCertificate&&""===j.ServerCertificate.CommonName&&(b.tip("error","w_CertificateNotAvailible"),q.prop("checked",j.Enable))}),s=a.validator([{element:l,check:[e,d,f],errorMsg:[tl("w_f_port_same"),tl("Port in use!"),tl("Port is used")],events:["blur","blur","blur"],errorElem:".u-input-error"},{element:m,check:[e,d,f],errorMsg:[tl("w_f_port_same"),tl("Port in use!"),tl("Port is used")],events:["blur","blur","blur"],errorElem:".u-input-error"},{element:n,check:[e,d,f],errorMsg:[tl("w_f_port_same"),tl("Port in use!"),tl("Port is used")],events:["blur","blur","blur"]},{element:o,check:[e,d,f],errorMsg:[tl("w_f_port_same"),tl("Port in use!"),tl("Port is used")],events:["blur","blur","blur"]},{element:p,check:[e,d,f],errorMsg:[tl("w_f_port_same"),tl("Port in use!"),tl("Port is used")],events:["blur","blur","blur"]}]),b.render()},render:function(){this._getConfig()},_render:function(a,b,c,d){k.numberfield("value",a.MaxConnections),l.numberfield("value",a.TCPPort),m.numberfield("value",a.UDPPort),n.numberfield("value",b.Port),o.numberfield("value",c.Port),p.numberfield("value",d.Port),q.prop("checked",d.Enable),"https:"===window.location.protocol.toLowerCase()&&q.prop("disabled",!0),s.validate()},_getConfig:function(a){var b=this;u.ConfigManager.getConfig(["DVRIP","Web","RTSP","Https"]).done(function(c){g=c[0].params.table,h=c[1].params.table,i=c[2].params.table,j=c[3].params.table,b._render(g,h,i,j),a&&b.tip("success","Operateingsuccess"),b.disabled("[btn-for=onSave]",!1)}).fail(function(){b.tip("error","Operateingfailure"),b.disabled("[btn-for=onSave]",!0)})},onSave:function(){var a=this;return s.isInvalid()?a.tip("warning",s.errors()[0].errorMsg):void u.ConfigManager.getConfig("DVRIP").done(function(b){g=b,g.MaxConnections=k.numberfield("value"),j.Enable=q.prop("checked"),g.TCPPort=l.numberfield("value"),g.UDPPort=m.numberfield("value"),h.Port=n.numberfield("value"),j.Port=p.numberfield("value"),i.Port=o.numberfield("value"),u.ConfigManager.setConfig(["DVRIP","Web","RTSP"],[g,h,i]).done(function(b){w.chkMutilCallRet(b)?(a.tip("success","Succeed in saving configure"),webApp.isNeedReboot(b)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later...")):a.tip("error","Saving failure")}),j.Enable&&j.ServerCertificate?v.CertManager.getSvrCertInfo().done(function(){u.ConfigManager.setConfig("Https",j).done(function(b){a.tip("success","Succeed in saving configure"),webApp.isNeedReboot(b)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later...")}).fail(function(){a.tip("error","Saving failure")}),a.tip("success","Succeed in saving configure")}).fail(function(){a.tip("error","w_CertificateNotAvailible")}):u.ConfigManager.setConfig("Https",j).done(function(b){a.tip("success","Succeed in saving configure"),webApp.isNeedReboot(b)&&webApp.reboot("The configration take effect! The device is restarting now,please reconnect later...")}).fail(function(){a.tip("error","Saving failure")})})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;u.ConfigManager.getDefault(["DVRIP","Web","RTSP","Https"]).done(function(b){g=b[0].params.table,h=b[1].params.table,i=b[2].params.table,j=b[3].params.table,a._render(g,h,i,j),a.disabled("[btn-for=onSave]",!1),a.tip("success","Defaultsuccess")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","Defaultfailure")})}})}),define("Conn-Onvif",function(require,a,b){var c,d=require("jsCore/rpc"),e=require("jsCore/pageBase");b.exports=e.extend({init:function(){var a=this;a.render()},render:function(){this._getConfig()},_render:function(a){this.$("input[name=ra_login][loginchk="+(a.OnvifLoginCheck?1:0)+"]").prop("checked",!0)},_getConfig:function(a){var b=this;d.ConfigManager.getConfig("UserGlobal").done(function(d){c=d||{},b._render(c),b.disabled("[btn-for=onSave]",!1),a&&b.tip("success","Operateingsuccess")}).fail(function(){b.disabled("[btn-for=onSave]",!0),b.tip("error","Operateingfailure")})},onSave:function(){var a=this;c.OnvifLoginCheck=!!(a.$("input[name=ra_login]:checked").attr("loginchk")-0),d.ConfigManager.setConfig("UserGlobal",c).done(function(){a.tip("success","Succeed in saving configure")}).fail(function(){a.tip("error","Saving failure")})},onRefresh:function(){this._getConfig(!0)},onDefault:function(){var a=this;d.ConfigManager.getDefault("UserGlobal").done(function(b){c=b||{},a._render(c),a.disabled("[btn-for=onSave]",!1),a.tip("success","Defaultsuccess")}).fail(function(){a.disabled("[btn-for=onSave]",!0),a.tip("error","Defaultfailure")})}})})}(jQuery);