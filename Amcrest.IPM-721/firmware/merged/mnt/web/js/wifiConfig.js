!function(a){var b,c,d,e,f=!1;define(function(require,a,g){b=require("jsCore/pageBase"),c=require("jsCore/rpc"),d=require("jsCore/ability"),e=require("common/common").Check,g.exports=require("jsCore/pageTab"),g.exports.prototype.wifi_wps=d.get("SupportedWPS"),g.exports.prototype.wifi_ap=d.get("Industry").then(function(a){return f="AIO"==a})}),define("wifi_wifi",function(require,d,e){function g(a,b,c){switch("add"+a+b){case"add00":return c?tl("NONE"):"Off";case"add01":return"WEP-OPEN";case"add11":return c?tl("WEP-SHARE"):"WEP-SHARED";case"add32":return"WPA-PSK-TKIP";case"add33":return c?tl("WPA-PSK-AES"):"WPA-PSK-CCMP";case"add34":return c?tl("WPA-PSK-TKIP+AES"):"WPA-PSK-TKIP";case"add52":return"WPA2-PSK-TKIP";case"add53":return"WPA2-PSK-AES";case"add54":return c?tl("WPA2-PSK-TKIP+AES"):"WPA2-PSK-TKIP";case"add42":return"WPA2-TKIP";case"add73":return c?tl("WPA/WPA2-PSK-AES"):"WPA2-PSK-AES";case"add74":return c?tl("WPA/WPA2-PSK-TKIP+AES"):"WPA2-PSK-TKIP";case"add72":return c?tl("WPA/WPA2-PSK-TKIP"):"WPA2-PSK-TKIP";default:return c?tl("UNKNOWN"):"Off"}}function h(a){m.data(a),m.dialog("title",tl("m_connecto")+" "+a.SSID),m.find("#conctTo_sigQua").text(a.LinkQuality+"%"),m.find("#conctTo_authMode").text(g(a.AuthMode,a.EncrAlgr,!0)),m.find("#conctTo_pswInput").val(""),m.dialog("show"),0===a.AuthMode&&0===a.EncrAlgr?(m.find("#conctTo_pswIndex").parent().hide(),m.find("#conctTo_pswInput").parent().hide()):1===a.EncrAlgr?(m.find("#conctTo_pswIndex").parent().show(),m.find("#conctTo_pswInput").focus().next("span").hide().parent().show()):(m.find("#conctTo_pswIndex").parent().hide(),m.find("#conctTo_pswInput").focus().next("span").hide().parent().show())}var i,j,k,l,m,n,o,p,q,r,s,t=null,u=null,v=!1,w=null,x=require("common/common");e.exports=b.extend({init:function(){var b=this;i=b.$("#wifi_enable").click(function(c){var d=a(c.target).prop("checked");f&&d&&w.eth2.ssid.Enable&&b.$("#confilctTip").tip("warning",tl("WIFIConfilctAP")),b._onEnable(d)}),o=b.$("#wifi_curPoint"),p=b.$("#wifi_status"),q=b.$("#wifi_ip"),r=b.$("#wifi_submask"),s=b.$("#wifi_defGway"),j=b.$("#wifi_table").table({height:220,reSelectRow:!0,columns:[{width:"10%",render:function(a){return'<input name="indexColumn" type="radio" disabled '+(2===a.ApConnected?"checked":"")+"/>"}},{title:tl("SSID"),width:"25%",render:function(a){return a.SSID.replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/ /g,"&nbsp;")}},{fields:"LinkMode",title:tl("Connectmode"),width:"20%",valueMap:{0:tl("Auto"),1:tl("Adhoc"),2:tl("Infrastructure")}},{title:tl("AuthMode"),width:"20%",render:function(a){return g(a.AuthMode,a.EncrAlgr,!0)}},{title:tl("Signalqality"),width:"15%",render:function(a){var b=0;return 0<a.LinkQuality&&a.LinkQuality<20?b=1:20<=a.LinkQuality&&a.LinkQuality<40?b=2:40<=a.LinkQuality&&a.LinkQuality<60?b=3:60<=a.LinkQuality&&a.LinkQuality<80?b=4:80<=a.LinkQuality&&a.LinkQuality<=100&&(b=5),'<i class="wifi-sign-icon'+b+'"></i>'}}],onRowSelect:function(a,b){!v&&h(b.data)}}),k=b.$("#dlg_addWifi").dialog({confirm:function(){b._onAddWifi()}}).detach().appendTo(document.body),l=k.find("#addWifi_SSID").keydown(function(a){13===a.which&&b._onAddWifi()}).textfield({length:35,showLengthError:!0}),m=b.$("#dlg_conctTo").dialog({confirm:function(){b._onConctTo()}}).detach().appendTo(document.body),n=m.find("#conctTo_pswInput").keydown(function(a){13===a.which&&b._onConctTo()}).textfield(),b.render()},destory:function(){k.remove(),m.remove()},render:function(){var a=this;c.ConfigManager.getConfig(["WLan","AccessPoint"]).done(function(b){t=b[0].params.table,w=b[1].result&&b[1].params.table,i.prop("checked",t.eth2.Enable),t.eth2.Enable?a._scanWLanDevices():(a.disabled("[btn-for=onRefresh],[btn-for=onAddWifi]",!0),j.table("dataSource",[]),a._renderWlanInfo())})},leave:function(){clearTimeout(u),u=null},onRefresh:function(){var a=this;return a._scanWLanDevices(),!1},_onEnable:function(a){var b=this;t.eth2.Enable=a,i.prop("disabled",!0);var d=["WLan"],e=[t];a&&f&&w&&(w.eth2.ssid.Enable=!1,d.push("AccessPoint"),e.push(w)),c.ConfigManager.setConfig(d,e).done(function(c){x.chkMutilCallRet(c)?a?b._scanWLanDevices():(b.disabled("[btn-for=onRefresh],[btn-for=onAddWifi]",!0),j.table("dataSource",[]),b._renderWlanInfo(),b.tip("success","Succeed in saving configure")):b.tip("error","Saving failure"),i.prop("disabled",!1)})},onAddWifi:function(){k.dialog("show"),k.find("#addWifi_SSID").val("").focus()},_onAddWifi:function(){var a=this,b=k.find("#addWifi_SSID").val();k.dialog("close"),""===b||"*"===b?a._scanWLanDevices():(a.disabled("[btn-for=onRefresh],[btn-for=onAddWifi]",!0),v=!0,a.tip("warning","w_onsearch",-1),c.NetApp.scanWLanDevices("eth2",b).done(function(b){b&&b.length>=1&&h(b[0]),a.tip("warning","w_onsearch",0)}).fail(function(){a.tip("error","w_CannotConnect")}).always(function(){a.disabled("[btn-for=onRefresh],[btn-for=onAddWifi]",!1),v=!1}))},_onConctTo:function(){var b=this,d=m.data(),e=t.eth2,f=m.find("#conctTo_pswInput"),h=f.val(),i=h.length;if(0===d.AuthMode&&0===d.EncrAlgr)e.Keys=["","","",""];else if(1===d.EncrAlgr){if(5!==i&&10!==i&&13!==i&&26!==i&&32!==i)return void f.next("span").show();e.Keys=["","","",""],e.KeyID=m.find("#conctTo_pswIndex").val()-0,e.Keys[e.KeyID]=h}else{if(7>=i||i>=65)return void f.next("span").show();e.Keys=["","","",""],e.Keys[0]=h}e.SSID=d.SSID,0===d.LinkMode?e.LinkMode="Auto":1===d.LinkMode?e.LinkMode="Ad-hoc":2===d.LinkMode&&(e.LinkMode="Infrastructure"),e.Encryption=g(d.AuthMode,d.EncrAlgr),e.ConnectEnable=!0,e.KeyFlag=!0,m.dialog("close"),c.ConfigManager.setConfig("WLan",t).done(function(){b.tip("success","Succeed in saving configure"),b._scanWLanDevices()}).fail(function(c){c.params&&a.isArray(c.params.options)&&-1!==a.inArray("ValidateFailed",c.params.options)?b.tip("error","w_PwdDif"):b.tip("error","w_PwdDif")})},_scanWLanDevices:function(){var b=this;b.disabled("[btn-for=onRefresh],[btn-for=onAddWifi]",!0),v=!0,b.tip("warning","w_onsearch",-1),c.NetApp.scanWLanDevices("eth2").done(function(c){j.table("dataSource",c),b._getWlanInfo(function(b){a.each(c,function(a,c){c.SSID===b&&(c.ApConnected=2)}),j.table("dataSource",c)})}).always(function(){b.disabled("[btn-for=onRefresh],[btn-for=onAddWifi]",!1),v=!1,b.tip("warning","w_onsearch",0)})},_getWlanInfo:function(b){var d=this,e=arguments.callee;c.NetApp.getNetInterfaces().done(function(c){a.each(c,function(a,c){return"eth2"===c.Name?(d._renderWlanInfo(c),"Connecting"===c.ConnStatus?(clearTimeout(u),u=setTimeout(function(){e.call(d,b)},5e3)):"Connected"===c.ConnStatus&&b(c.ApSSID),!1):void 0})})},_renderWlanInfo:function(a){function b(){q.text(""),r.text(""),s.text("")}return a?(o.text(a.ApSSID),""===a.ApSSID?(p.text(tl("w_disconnected")).removeClass("ui-tip-green").addClass("ui-tip-red"),b()):"Disconn"===a.ConnStatus?(p.text(tl("w_disconnected")).removeClass("ui-tip-green").addClass("ui-tip-red"),b()):"Connecting"===a.ConnStatus?(p.text(tl("connecting")).removeClass("ui-tip-red").addClass("ui-tip-green"),b()):void("Connected"===a.ConnStatus&&(p.text(tl("m_connected")).removeClass("ui-tip-red").addClass("ui-tip-green"),c.ConfigManager.getConfig("Network").done(function(a){q.text(a.eth2.IPAddress),r.text(a.eth2.SubnetMask),s.text(a.eth2.DefaultGateway)}).fail(b)))):(o.text(""),p.text(""),b())}})}),define("wifi_wps",function(require,d,f){var g,h,i;f.exports=b.extend({init:function(){var b=this;g=b.$("#wps_ping").textfield(),h=b.$("#wps_ssid").textfield(),i=a.validator([{element:g,check:function(a){return e.number(a)&&8===a.length},errorMsg:tl("w_null_limite_pin"),events:"keyup blur"},{element:h,check:e.require,errorMsg:tl("w_null_limite"),events:"keyup blur"}]),b.render()},render:function(){this._getStatus()},_getStatus:function(){var b=this,d=b.$("#wps_state");c.NetApp.getNetInterfaces().done(function(b){d.text(tl("w_disconnected")).removeClass("ui-tip-green").addClass("ui-tip-red"),a.each(b,function(a,b){return"eth2"===b.Name?(""===b.ApSSID?d.text(tl("w_disconnected")).removeClass("ui-tip-green").addClass("ui-tip-red"):"Disconn"===b.ConnStatus?d.text(tl("w_disconnected")).removeClass("ui-tip-green").addClass("ui-tip-red"):"Connecting"===b.ConnStatus?d.text(tl("connecting")).removeClass("ui-tip-red").addClass("ui-tip-green"):"Connected"===b.ConnStatus&&d.text(tl("m_connected")).removeClass("ui-tip-red").addClass("ui-tip-green"),!1):void 0})}).fail(function(){d.text(tl("w_disconnected")).removeClass("ui-tip-green").addClass("ui-tip-red")})},onConnect:function(){var a=this,b=a.$("[wpstype]:checked").attr("wpstype")-0,d="",e="";if(2===b){if(i.isInvalid())return a.tip("warning",i.errorInfo[0].errorMsg);d=g.textfield("value"),e=h.textfield("value")}return c.NetApp.connectByWps(b,d,e).done(function(){a.tip("success","Succeed in saving configure")}).fail(function(){a.tip("error","Saving failure")}),!1},onRefresh:function(){return this._getStatus(),!1}})}),define("wifi_ap",function(require,d,e){var f,g,h,i=require("common/common");e.exports=b.extend({init:function(){h=this,h.render(),h.$("#ap_ssid").textfield({charset:"utf-8",length:32}),h.$("#ap_pwd").textfield({charset:"utf-8",length:32})},render:function(a){c.ConfigManager.getConfig(["AccessPoint","WLan"]).done(function(b){f=b[0].params.table,g=b[1].params.table,h._renderElement(),a&&h.tip("success","Operateingsuccess")}).fail(function(){a&&h.tip("error","Operateingfailure")})},_renderElement:function(){var a=f.eth2.ssid;h.$("#ap_enable").prop("checked",a.Enable),h.$("#ap_ssid").textfield("value",a.SSID),h.$("#ap_pwd").textfield("value",a["WPA PSK"].Password)},onDefault:function(){c.ConfigManager.getDefault("AccessPoint").done(function(a){f=a,h._renderElement(),h.tip("success",tl("Defaultsuccess"))}).fail(function(){h.tip("error",tl("Defaultfailure"))})},onRefresh:function(){h.render(!0)},onConfirm:function(){var a=f.eth2.ssid;a.Enable=h.$("#ap_enable").prop("checked"),a.SSID=h.$("#ap_ssid").textfield("value"),a["WPA PSK"].Password=h.$("#ap_pwd").textfield("value"),a.Enable&&(g.eth2.Enable=!1),c.ConfigManager.setConfig(["AccessPoint","WLan"],[f,g]).done(function(a){i.chkMutilCallRet(a)?h.tip("success","Succeed in saving configure"):h.tip("error","Saving failure")})},onCheck:function(b){var c=a(b.target).prop("checked");c&&g.eth2.Enable&&h.tip("warning","APConfilctWIFI")}})})}(jQuery);