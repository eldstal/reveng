!function(a){define(function(){var b=[],c=["videoDetect","alarmAudio","FaceDetection","NumberStat","HeatMap"],d=["Normal","w_carDetection","TrafficTollGate"],e=["NumberStat","FaceDetection","HeatMap","TakenAwayDetection","TrafficTollGate","ParkingDetection","RetrogradeDetection"],f=null,g={videoDetect:"videoDetectConfig",alarmAudio:"alarmAudioConfig",NumberStat:"flowrateConfig",FaceDetection:"ipcFaceNewConfig",HeatMap:"ipcHeatMapConfig",TrafficTollGate:"ipcIntellTrafficConfig",Normal:"ipcIntellentNewConfig",w_carDetection:"ipcIntellentCarConfig"},h={MotionDetect:"videoDetectConfig-motionDetect",BlindDetect:"videoDetectConfig-blindDetect",UnFocusDetect:"videoDetectConfig-blindDetect",AnomalyDetect:"alarmAudioConfig-alarmAudioConfig",MutationDetect:"alarmAudioConfig-alarmAudioConfig",FaceDetection:"ipcFaceNewConfig-ipcFaceNewConfig",NumberStat:"flowrateConfig-setFlowrate",HeatMap:"ipcHeatMapConfig-HeatMap",TrafficTollGate:"ipcIntellTrafficConfig-traffic_scene",ParkingDetection:"ipcIntellentCarConfig-ParkingDetection",RetrogradeDetection:"ipcIntellentCarConfig-RetrogradeDetection",Normal:"ipcIntellentNewConfig"},i={MotionDetect:["MotionDetect","Enable"],BlindDetect:["BlindDetect","Enable"],UnFocusDetect:["UnFocusDetect","Enable"],AnomalyDetect:["AudioDetect","AnomalyDetect"],MutationDetect:["AudioDetect","MutationDetect"],FaceDetection:["VideoAnalyseRule","FaceDetection"],NumberStat:["VideoAnalyseRule","NumberStat"],HeatMap:["VideoAnalyseRule","HeatMap"],Normal:["VideoAnalyseRule"],TrafficTollGate:["VideoAnalyseRule","TrafficTollGate"],ParkingDetection:["VideoAnalyseRule","Enable"],RetrogradeDetection:["VideoAnalyseRule","Enable"]},j=[],k={},l={},m=!0,n="",o=null,p=null,q=Page.eventManageConfig={init:function(){f={videoDetect:["MotionDetect","BlindDetect","UnFocusDetect"],alarmAudio:["AnomalyDetect","MutationDetect"],NumberStat:["NumberStat"],FaceDetection:["FaceDetection"],HeatMap:["HeatMap"],Normal:[],w_carDetection:["ParkingDetection","RetrogradeDetection"],TrafficTollGate:["TrafficTollGate"]},p=$$('#set-menu li[filename = "eventManageConfig"]')[0],q._getEventCpas().always(function(){o=$$('#page_eventManageConfig input[configName = "VideoAnalyseRule"]'),q.bind(),q.render()})},translate:function(){$("page_eventManageConfig").translation()},bind:function(){$$(".eventM_table span").addEvent("click",q._goTagPage),$("eventManage_confirm").addEvent("click",q._onConfirmClick),$("eventManage_refresh").addEvent("click",q._onRefreshClick),o.addEvent("click",function(){n="";var a=this.getProperty("enableName");if(o.each(function(b){var c=b.getProperty("enableName");b.checked&&c!=a&&(n+=c)}),this.checked&&m&&n)if("FaceDetection"==a||"NumberStat"==a||"TrafficTollGate"==a){var b=tl("w_ivsConflict");-1!=n.indexOf("ParkingDetection")||-1!=n.indexOf("RetrogradeDetection")?(""!=n.replace("ParkingDetection","").replace("RetrogradeDetection","")&&(b+=tl("Normal")+","),b+=tl("w_carDetection")):b+=tl("FaceDetection"!=n&&"NumberStat"!=n&&"TrafficTollGate"!=n?"Normal":n),remarkDisplay("eventManage_remark",b,3e3,0),o.each(function(a){a.checked=!1}),this.checked=!0}else("FaceDetection"==n||"NumberStat"==n||"TrafficTollGate"==n)&&(remarkDisplay("eventManage_remark",tl("w_ivsConflict")+tl(n),3e3,0),$$('#page_eventManageConfig input[enableName = "'+n+'"]').each(function(a){a.checked=!1}))})},render:function(){rpc.ConfigManager.getConfig(j).done(function(a){j.each(function(b,c){k[b]=a[c].params.table}),f.Normal&&q._getIVSConfig(),q._renderElements()})},_renderElements:function(){$$('#page_eventManageConfig input[type = "checkbox"]').each(function(a){var b=a.getProperty("configName"),c=a.getProperty("enableName");if("VideoAnalyseRule"==b){var d=k.VideoAnalyseRule;"FaceDetection"==c?a.checked=d[analyseSenceRuleMap.FaceDetection][0].Enable:"NumberStat"==c?a.checked=d[analyseSenceRuleMap.NumberStat][0].Enable:"TrafficTollGate"==c?a.checked=d[analyseSenceRuleMap.Traffic][0].Enable:l[c]?(a.disabled=!1,a.checked=l[c][0].Enable):(a.disabled=!0,a.checked=!1)}else a.checked=k[b][0][c]})},_getEventCpas:function(){var a=[];for(var c in f){var d=$$('#set-menu li[filename = "'+g[c]+'"]');d.length<1&&a.push(c)}a.each(function(a){delete f[a]});var h=ability.get("VideoDetectCaps").done(function(a){a&&a.UnFocusDetect||f.videoDetect.erase("UnFocusDetect")}),k=ability.get("IVSCaps").always(function(a){b=a.SupportedRules||[]});return jQuery.when(h,k).done(function(){if(f.Normal){f.Normal=[];for(var a=!1,c=!1,d=0;d<b.length;d++)if("RetrogradeDetection"===b[d]&&(c=!0),"ParkingDetection"===b[d]&&(a=!0),!e.contains(b[d]))if("VideoAbnormalDetection"===b[d]&&f.Normal.contains("WanderDetection")){for(var g=0;g<f.Normal.length;g++)if("WanderDetection"===f.Normal[g]){f.Normal.splice(g,0,b[d]);break}}else if("RioterDetection"===b[d]&&f.Normal.contains("MoveDetection")){for(var g=0;g<f.Normal.length;g++)if("MoveDetection"===f.Normal[g]){f.Normal.splice(g,0,b[d]);break}}else f.Normal.push(b[d]);f&&f.w_carDetection&&(a||f.w_carDetection.splice(0,1),c||f.w_carDetection.splice(1,1))}for(var h in f)"Normal"!=h?f[h].each(function(a){j.include(i[a][0])}):j.include(i.Normal[0]);q._displayByCaps()})},_displayByCaps:function(){for(var a="<tr>",b=0;b<c.length;b++)if(f[c[b]]){var e=f[c[b]].length;a+=e>1?'<th colspan="'+e+'">'+tl(c[b])+"</th>":"<th>"+tl(c[b])+"</th>"}a+="</tr><tr>";for(var b=0;b<c.length;b++)if(f[c[b]])for(var g=f[c[b]],j=0;j<g.length;j++)a+='<td><div class="title">'+tl(g[j])+'<span filename="'+h[g[j]]+'"></span></div><div><input type="checkbox" configName="'+i[g[j]][0]+'" enableName ="'+i[g[j]][1]+'"/></div></td>';if(a+="</tr>",$("eventTable1").set("html",a),f.Normal||f.w_carDetection||f.TrafficTollGate){$("eventTable2").style.display="";for(var k="<tr>",b=0;b<d.length;b++)if(f[d[b]]){var e=f[d[b]].length;k+=e>1?'<th colspan="'+e+'">'+tl(d[b])+"</th>":"<th>"+tl(d[b])+"</th>"}k+="</tr><tr>";for(var b=0;b<d.length;b++)if(f[d[b]])for(var g=f[d[b]],j=0;j<g.length;j++){var l=g[j];"VideoAbnormalDetection"==l&&(l="w_VideoAbnormalDetection"),"LeftDetection"==l&&(l="w_LeftDetectionDis"),k+='<td><div class="title">'+tl(l)+'<span filename="'+("Normal"===d[b]?h.Normal+"-"+g[j]:h[g[j]])+'"></span></div><div><input type="checkbox" configName="'+i.Normal[0]+'" enableName ="'+("TrafficTollGate"===d[b]?"TrafficTollGate":g[j])+'"/></div></td>'}k+="</tr>",$("eventTable2").set("html",k),f.Normal.contains("ParkingDetection")&&$$('#page_eventManageConfig span[filename $= "ParkingDetection"]')[0].setProperty("filename",h.ParkingDetection),f.Normal.contains("RetrogradeDetection")&&$$('#page_eventManageConfig span[filename $= "RetrogradeDetection"]')[0].setProperty("filename",h.RetrogradeDetection)}else $("eventTable2").style.display="none"},_goTagPage:function(){var b=this.getProperty("filename"),c=b.split("-"),d=c[0],e=c[1],f=a('#set-menu li[filename = "'+d+'"]');if(a("[data-for="+d+"][id=page_"+d+"]").is("div"))Page[d]?(a("#page_"+d+" .ui-tab li").removeClass("ui-tab-current"),a("#page_"+d+' .ui-tab li[data-for = "'+e+'"]').addClass("ui-tab-current")):a("#page_"+d+" .u-tab").tab("select",e),f.click();else{f.click();var g=setInterval(function(){f.data("page")&&(clearInterval(g),Page[d]?(a("#page_"+d+" .ui-tab li").removeClass("ui-tab-current"),a("#page_"+d+' .ui-tab li[data-for = "'+e+'"]').addClass("ui-tab-current"),Page[d].render()):a("#page_"+d+" .u-tab").tab("select",e))},10)}},_getIVSConfig:function(){var a=k.VideoAnalyseRule[analyseSenceRuleMap.Normal];l={},a.each(function(a){"TakenAwayDetection"!=a.Type?(l[a.Type]||(l[a.Type]=[]),l[a.Type].push(a)):(l.LeftDetection||(l.LeftDetection=[]),l.LeftDetection.push(a))})},_saveElements:function(){$$('#page_eventManageConfig input[type = "checkbox"]').each(function(a){var b=a.getProperty("configName"),c=a.getProperty("enableName");if("VideoAnalyseRule"==b){var d=k.VideoAnalyseRule;"FaceDetection"==c?d[analyseSenceRuleMap.FaceDetection][0].Enable=a.checked:"NumberStat"==c?d[analyseSenceRuleMap.NumberStat][0].Enable=a.checked:"TrafficTollGate"==c?d[analyseSenceRuleMap.Traffic][0].Enable=a.checked:l[c]&&l[c].each(function(b){b.Enable=a.checked})}else k[b][0][c]=a.checked})},_onConfirmClick:function(){q._saveElements();var a=[];for(var b in l)a.combine(l[b]);f.Normal&&(k.VideoAnalyseRule[analyseSenceRuleMap.Normal]=a);var c=[];j.each(function(a){c.push(k[a])}),rpc.ConfigManager.setConfig(j,c).done(function(a){common.chkMutilCallRet(a)?remarkDisplay("eventManage_remark",tl("Succeed in saving configure"),3e3,0):remarkDisplay("eventManage_remark",tl("Saving failure"),3e3,1)})},_onRefreshClick:function(){rpc.ConfigManager.getConfig(j).done(function(a){common.chkMutilCallRet(a)?(j.each(function(b,c){k[b]=a[c].params.table}),f.Normal&&q._getIVSConfig(),q._renderElements(),remarkDisplay("eventManage_remark",tl("Operateingsuccess"),3e3,0)):remarkDisplay("eventManage_remark",tl("Operateingfailure"),3e3,1)})}}})}(jQuery);