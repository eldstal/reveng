!function(a){function b(a,b,c){switch(a){case 604:b="w_useMannageErr_InputNotValid";break;case 605:b=c?"w_useMannageErr_IndexOverlap_group":"w_useMannageErr_IndexOverlap_user";break;case 606:case 607:b=c?"w_useMannageErr_IndexOverlap_group":"w_useMannageErr_IndexOverlap_user";break;case 608:b=c?"w_useMannageErr_ObjectInUse_group":"w_useMannageErr_ObjectInUse_user";break;case 609:b=c?"w_useMannageErr_SubsetOverlap_group":"w_useMannageErr_SubsetOverlap_user";break;case 610:b="w_useMannageErr_SaveCfgError";break;case 611:b="w_useMannageErr_PwdNotValid";break;case 612:b="w_useMannageErr_PwdNotMatch";break;case 613:b="w_useMannageErr_ReservedAccount";break;case 614:b="w_useMannageErr_TooManyGroup";break;case 615:b="w_useMannageErr_TooManyUser"}return b}function c(b,c){var d=a(c).attr("data-pwd"),e=[];return a("input[data-pwd="+d+"]").each(function(b,c){e.push(a(c).val())}),e[0]===e[1]}function d(a){var b=a.children("li");b.removeClass("current"),a.prop("class","ui-pwd-strength")}function e(a){return a.length<8?!1:!0}define(function(require,a,b){b.exports=require("jsCore/pageTab"),b.exports.prototype.getCondition=function(){b.exports.prototype.use_onvif=!(!webApp.EncryptInfo||!webApp.EncryptInfo.asymmetric)&&webCaps.OnvifSync&&/simpchinese/i.test(Site.currentLanguage)}}),define("use_userM",function(require,c,d){function f(b,c,d,e){var f=b.prop("id");b.empty(),a.each(d,function(d,g){-1===a.inArray(g,c)&&"IntelliConf"!==g&&(a('<div class="ui-textarea-item fn-clear">                        <div class="ui-checkbox">                            <input type="checkbox" data-for="'+g+'" id="'+f+"_"+g+'"/>                        </div>                        <label class="ui-label-sub" for="'+f+"_"+g+'" t="'+g+'"></label>                    </div>').appendTo(b),-1!==a.inArray(g,e)&&b.find("input[data-for="+g+"]").prop("checked",!0))}),b.translation()}function g(b){var c=[];return b.find("input:checked").each(function(b,d){c.push(a(d).attr("data-for"))}),c}function h(a){return a.find("input:checked").length===a.find("input").length}function i(b,c){var d=b.prop("checked");c.find("input").each(function(b,c){a(c).prop("checked",d)})}var j,k,l=require("jsCore/rpc"),m=require("jsCore/pageBase"),n=require("jsCore/ability"),o=require("common/common"),p=null,q=null,r=null;d.exports=m.extend({init:function(){p=this,q=p,$anonym2=p.$("#use_anonym2"),$anonym1=p.$("#use_anonym1"),j=p.$("#use_anonym"),p._initTab(),p._renderAnonymity(),p._bind(),l.MagicBox.getSerialNo().done(function(a){k=a})},_bind:function(){$anonym1.click(function(){r.Anonymous=j.prop("checked"),l.UserManager.modifyUser("anonymity",r).done(function(){p.tip("success",r.Anonymous?"w_openAnonymLoginSucceed":"w_closeAnonymLoginSucceed")}).fail(function(){p.tip("error",r.Anonymous?"w_openAnonymLoginFailed":"w_closeAnonymLoginFailed"),j.prop("checked",!r.Anonymous)})}),$anonym2.click(function(){r.Anonymous=j.prop("checked"),l.UserManager.modifyUser("anonymity",r).done(function(){p.tip("success",r.Anonymous?"w_openAnonymLoginSucceed":"w_closeAnonymLoginSucceed")}).fail(function(){p.tip("error",r.Anonymous?"w_openAnonymLoginFailed":"w_closeAnonymLoginFailed"),j.prop("checked",!r.Anonymous)})})},_initTab:function(){var a=p.$(".u-tab"),b=p.$(".u-tab-content");p.tabs={},a.tab({switched:function(a,c){var d=p.tabs[c.from],e=p.tabs[c.to];d&&d.leave(),e?(e.render(),p.current=e):require.async(c.to,function(a){p.tabs[c.to]=new a({element:b.find("[data-page="+c.to+"]")}),p.current=p.tabs[c.to]})}})},render:function(){p.current.render()},_renderAnonymity:function(){l.UserManager.getUserInfo("anonymity").done(function(a){r=a,j.prop("checked",r.Anonymous)})},destory:function(){p.current.destory()}}),define("userM_user",function(require,c,d){function j(b,c){var d=a(c).attr("data-pwd"),e=[];return a("input[data-pwd="+d+"]").each(function(b,c){e.push(a(c).val())}),e[0]===e[1]}function p(a,b){var c=b.children("li");if(c.removeClass("current"),a){var d=o.pwdStrenthValidator(a),e=b.find("."+d);e.addClass("current"),b.prop("class","ui-pwd-strength "+d)}else b.prop("class","ui-pwd-strength")}function r(a){var b=a.children("li");b.removeClass("current"),a.prop("class","ui-pwd-strength")}var s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=null,J=["ComConf","MHardisk","ShutDown"],K=[];d.exports=m.extend({init:function(){I=this,F=I.$("#use_AUserDlg"),G=I.$("#use_EUserDlg"),H=I.$("#use_DUserDlg"),I._initTable(),I._initDialog(),A=F.find("#use_AUserAuth"),B=F.find("#use_AUserAuthli"),C=G.find("#use_EUserAuth"),D=G.find("#use_EUserAuthli"),E=G.find("#use_EUserChkPwd"),I._initInput(),I._bind(),I.render()},_bind:function(){A.on("click",function(){i(A,B)}),B.on("click",function(){A.prop("checked",h(B))}),C.on("click",function(){i(C,D)}),D.on("click",function(){C.prop("checked",h(D))}),E.on("click",function(){G.find("div[data-warp=editPwd]").css("display",E.prop("checked")?"":"none")}),F.find("#use_AUserPwd").on("keyup",function(){var b=a(this).val();if(b.length>=32){var c=a("#use_AUserPwd + span")[0];c.style.color="#f00",c.style.display="block"}var d=a(this).offsetParent().find(".ui-pwd-strength");p(b,d)}),G.find("#use_EUserNPwd").on("keyup",function(){var b=a(this).val(),c=a(this).offsetParent().find(".ui-pwd-strength");p(b,c)})},_initTable:function(){s=I.$("#use_userTab").table({pageable:!1,height:200,columns:[{title:tl("w_Numbers"),width:"10%",render:function(a){return a._index+1}},{title:tl("w_User"),width:"15%",fields:"Name"},{title:tl("w_Group Name"),width:"15%",fields:"Group"},{title:tl("w_Remark"),width:"40%",fields:"Memo"},{title:tl("w_Amend"),width:"10%",action:"edit",icon:"ui-table-icon-edit",handle:function(a){t=a,G.dialog("show"),I._renderEditUser(t)}},{title:tl("Delete"),action:"delete",icon:"ui-table-icon-del",handle:function(a,b){t=a,H.dialog("show"),b.stopPropagation()}}],onRowSelect:function(a,b){return t=b.data,I._renderUserInfo(b.data),!1}})},_initDialog:function(){F.dialog({confirm:function(a,b){I._onAddUser(b)}}).detach().appendTo(document.body),G.dialog({confirm:function(a,b){I._onEditUser(b)}}).detach().appendTo(document.body),H.dialog({confirm:function(a,b){I._onDelUser(),b.ui.close()}}).detach().appendTo(document.body)},_initInput:function(){x=a.validator([{element:F.find("#use_AUserName"),check:[o.Check.require,o.Check.require,o.Check.getnameString,o.Check.getnameString],errorMsg:["w_Need","w_Need","w_badUserString","w_badUserString"],events:["keyup","blur","keyup","blur"],errorElem:".u-input-error"},{element:F.find("#use_AUserMemo"),check:[o.Check.alphaNumLineQuoSpace],errorMsg:["w_Badmemo"],events:["blur"],errorElem:".u-input-error"},{element:F.find("#use_AUserPwdCfm"),check:[j,o.Check.noQuotationColonAnd],errorMsg:["w_PwdDif","badPwdString"],events:["blur","blur"],errorElem:"#use_AUserPwdCfmTip.u-input-error"},{element:F.find("#use_AUserPwd"),check:[j],errorMsg:["w_PwdDif"],events:["blur"],errorElem:"#use_AUserPwdCfmTip.u-input-error"},{element:F.find("#use_AUserPwd"),check:[o.Check.require,o.Check.noQuotationColonAnd,e,e,getPasswordStrong,getPasswordStrong],errorMsg:["w_Badlengtsh","badPwdString","w_Badlengtsh","w_Badlengtsh","w_errorModifypwd","w_errorModifypwd"],events:["blur","blur","keyup","blur","keyup","blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),y=a.validator([{element:G.find("#use_EUserMemo"),check:[o.Check.alphaNumLineQuoSpace],errorMsg:["w_Badmemo"],events:["blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),z=a.validator([{element:G.find("#use_EUserPwdCfm"),check:[j,o.Check.noQuotationColonAnd],errorMsg:["w_PwdDif","badPwdString"],events:["blur","blur"],errorElem:"#use_EUserPwdCfmTip.u-input-error"},{element:G.find("#use_EUserNPwd"),check:[j],errorMsg:["w_PwdDif"],events:["blur"],errorElem:"#use_EUserPwdCfmTip.u-input-error"},{element:G.find("#use_EUserNPwd"),check:[o.Check.require,o.Check.noQuotationColonAnd,function(a){return"admin"!=a},e,getPasswordStrong],errorMsg:["w_passwordMustnotNull","w_Badlengtsh","badPwdString","w_Badlengtsh","w_errorModifypwd"],events:["blur","blur","blur","blur","blur"],errorElem:".u-input-error"},{element:G.find("#use_EUserOPwd"),check:[o.Check.noQuotationColonAnd],errorMsg:["badPwdString"],events:["blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()})},render:function(){n.get("IsLocalStore").done(function(a){J=a?["ComConf","MHardisk","ShutDown"]:["ComConf","MHardisk","ShutDown","Replay_01","Backup"],l.UserManager.getUserInfoAll().done(function(a){w=a,s.table("dataSource",w).table("selectRow",0)})}),l.UserManager.getActiveUserInfoAll().done(function(b){K.length=0,a.each(b,function(a,b){"web3.0"==b.ClientType.toLowerCase()&&K.push(b.Name)})})},destory:function(){F.remove(),G.remove(),H.remove()},_renderUserInfo:function(b){var c=I.$("#use_Ulist").empty();a.each(b.AuthorityList,function(b,d){-1===a.inArray(d,J)&&"IntelliConf"!==d&&a('<span class="ui-detail-item" t="'+d+'"></span>').appendTo(c)}),c.translation()},renderAddUser:function(){F.find(":input").each(function(b,c){a(c).val("")}),F.find("#use_AUserAuthTip").text(""),r(F.find(".ui-pwd-strength")),l.UserManager.getGroupInfoAll().done(function(b){v=b;var c=F.find("#use_AUsergrp").empty();a.each(v,function(b,d){a('<option value="'+d.Name+'"></option>').text(d.Name).appendTo(c)}),a.each(v,function(a,b){b.Name===c.val()&&(u=b,f(B,J,b.AuthorityList,b.AuthorityList))}),A.prop("checked",h(B))}),x.validate(),F.dialog("show")},onSelAddGroup:function(b){var c=F.find(b.target).val();u=a.grep(v,function(a){return a.Name==c})[0],f(B,J,u.AuthorityList,u.AuthorityList),A.prop("checked",h(B))},_onAddUser:function(c){if(x.isInvalid())return void x.validate();var d=g(B);if(0==d.length)return void F.find("#use_AUserAuthTip").text(tl("w_Authnone"));var e={},f="Login to "+k,h=F.find("#use_AUserPwd").val(),i=F.find("#use_AUserName").val();e.Id=w.length+1,e.Name=i,e.Password=hex_md5(i+":"+f+":"+h),e.Type="",e.ModifiedTime="",e.Memo=F.find("#use_AUserMemo").val(),e.Group=F.find("#use_AUsergrp").val(),-1!==a.inArray("MHardisk",u.AuthorityList)&&-1!==a.inArray("ShutDown",u.AuthorityList)&&d.push("MHardisk","ShutDown"),e.AuthorityList=d,e.Reserved=!1,e.Sharable=!0,l.UserManager.addUser(e).done(function(){s.table("add",e,-1).table("selectRow",w.length-1),c.ui.close(),q.tip("success","w_AddUserSuc")}).fail(function(a){c.ui.close();var d=b(a.error&&a.error.code,"w_AddUserFail",0);q.tip("error",d)})},_renderEditUser:function(b){G.find(":input").each(function(b,c){a(c).val("")}),G.find("#use_EUserAuthliTip").text(""),r(G.find(".ui-pwd-strength")),G.find("div[data-warp=editPwd]").css("display","none"),E.prop("checked",!1);var c=G.find("#use_EUserName").empty();a.each(w,function(b,d){a('<option value="'+d.Name+'"></option>').text(d.Name).appendTo(c)}),c.val(b.Name),l.UserManager.getGroupInfoAll().done(function(c){v=c;var d=G.find("#use_EUserGrp").empty();a.each(v,function(b,c){a('<option value="'+c.Name+'"></option>').text(c.Name).appendTo(d)}),d.val(b.Group),a.each(v,function(a,c){c.Name===b.Group&&(u=c,f(D,J,c.AuthorityList,b.AuthorityList))}),C.prop("checked",h(D)),I._renderAdminInfo("admin"==b.Name||a.inArray(b.Name,K)>-1?!0:!1)}),G.find("#use_EUserMemo").val(b.Memo),y.validate(),z.validate()},_renderAdminInfo:function(b){G.find("#use_EUserGrp").prop("disabled",b),G.find("#use_EUserMemo").prop("disabled",b),C.prop("disabled",b),D.find(":input").each(function(c,d){a(d).prop("disabled",b)})},onSelEditGroup:function(b){var c=G.find(b.target).val();u=a.grep(v,function(a){return a.Name==c})[0],f(D,J,u.AuthorityList,c===t.Group?t.AuthorityList:[]),C.prop("checked",h(D))},onSelEditUser:function(b){var c=G.find(b.target).val();t=a.grep(w,function(a){return a.Name==c})[0],I._renderEditUser(t)},_onEditUser:function(c){if(y.isInvalid())return void y.validate();var d=g(D);if(0==d.length)return void G.find("#use_EUserAuthliTip").text(tl("w_Authnone"));if(E.prop("checked")){if(z.isInvalid())return void z.validate();var e,f,h=G.find("#use_EUserName").val(),i=G.find("#use_EUserOPwd").val(),j=G.find("#use_EUserNPwd").val(),m="Login to "+k;webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&webCaps.OnvifSync?(e=j,f=i):(e=hex_md5(h+":"+m+":"+j),f=hex_md5(h+":"+m+":"+i)),l.UserManager.modifyPassword(h,e,f).done(function(){login.getLoginInfo().username;"admin"==t.Name||a.inArray(t.Name,K)>-1?(c.ui.close(),q.tip("success","w_ChangeUserSucce")):I._onEditUserOnly()}).fail(function(a){var d=b(a.error&&a.error.code,"w_ChangePwdFail",0);c.ui.close(),q.tip("error",d)})}else I._onEditUserOnly()},_onEditUserOnly:function(){var c=a.extend(!0,{},t);c.Group=G.find("#use_EUserGrp").val(),c.Memo=G.find("#use_EUserMemo").val(),c.AuthorityList=u.AuthorityList;var d=g(D);-1!==a.inArray("MHardisk",c.AuthorityList)&&-1!==a.inArray("ShutDown",c.AuthorityList)&&d.push("MHardisk","ShutDown"),c.AuthorityList=d,l.UserManager.modifyUser(c.Name,c).done(function(){t.Group=c.Group,t.Memo=c.Memo,t.AuthorityList=c.AuthorityList;var b=0;G.find("#use_EUserName").find("option").each(function(c,d){a(d).val()==t.Name&&(b=c)}),s.table("modify",t,b),s.table("selectRow",b),q.tip("success","w_ChangeUserSucce")}).fail(function(a){var c=b(a.error&&a.error.code,"w_ChangeUserFail",0);q.tip("error",c)}),G.dialog("close")},_onDelUser:function(){l.UserManager.deleteUser(t.Name).done(function(){q.tip("success","w_DelUserSucce"),s.table("del",t),s.table("selectRow",0)}).fail(function(a){var c=b(a.error&&a.error.code,"w_DelUserFail",0);q.tip("error",c)})}})}),define("userM_group",function(require,c,d){var e,j,k,p,r,s,t,u,v,w,x,y,z=null,A=["ComConf","MHardisk","ShutDown"],B=[];d.exports=m.extend({init:function(){z=this,w=z.$("#use_AGrpDlg"),x=z.$("#use_EGrpDlg"),y=z.$("#use_DGrpDlg"),z._initTable(),z._initDialog(),s=w.find("#use_AGrpAuth"),t=w.find("#use_AGrpAuthli"),u=x.find("#use_EGrpAuth"),v=x.find("#use_EGrpAuthli"),z._initInput(),l.UserManager.getAuthorityList().done(function(a){B=a}),z._bind(),z.render()},_initTable:function(){e=z.$("#use_groupTab").table({pageable:!1,height:200,columns:[{title:tl("w_Numbers"),width:"10%",render:function(a){return a._index+1}},{title:tl("w_Group Name"),width:"20%",fields:"Name"},{title:tl("w_Remark"),width:"50%",fields:"Memo"},{title:tl("w_Amend"),width:"10%",action:"edit",icon:"ui-table-icon-edit",handle:function(a){x.dialog("show"),k=a,z._renderEditGroup(a)}},{title:tl("Delete"),action:"delete",icon:"ui-table-icon-del",handle:function(a,b){k=a,y.dialog("show"),b.stopPropagation()}}],onRowSelect:function(a,b){return k=b.data,z._renderGroupInfo(b.data),!1}})},_initDialog:function(){w.dialog({confirm:function(a,b){z._onAddGroup(b)}}).detach().appendTo(document.body),x.dialog({confirm:function(a,b){z._onEditGroup(b)}}).detach().appendTo(document.body),y.dialog({confirm:function(a,b){z._onDelGroup(),b.ui.close()}}).detach().appendTo(document.body)},_initInput:function(){p=a.validator([{element:w.find("#use_AGrpName"),check:[o.Check.alphaNumUnderline,o.Check.require],errorMsg:[tl("w_Badstring"),tl("w_Need")],events:["blur","blur"],errorElem:".u-input-error"},{element:w.find("#use_AGrpMemo"),check:[o.Check.alphaNumLineQuoSpace],errorMsg:[tl("w_Badmemo")],events:["blur"],errorElem:".u-input-error"}]),r=a.validator([{element:x.find("#use_EGrpMemo"),check:[o.Check.alphaNumLineQuoSpace],errorMsg:[tl("w_Badmemo")],events:["blur"],errorElem:".u-input-error"}])},_bind:function(){s.on("click",function(){i(s,t)}),t.on("click",function(){s.prop("checked",h(t))}),u.on("click",function(){i(u,v)}),v.on("click",function(){u.prop("checked",h(v))})},render:function(){n.get("IsLocalStore").done(function(a){A=a?["ComConf","MHardisk","ShutDown"]:["ComConf","MHardisk","ShutDown","Replay_01","Backup"],l.UserManager.getGroupInfoAll().done(function(a){j=a,e.table("dataSource",j).table("selectRow",0)})})},destory:function(){w.remove(),x.remove(),y.remove()},_renderGroupInfo:function(b){var c=z.$("#use_Glist").empty();a.each(b.AuthorityList,function(b,d){-1===a.inArray(d,A)&&"IntelliConf"!==d&&a('<span class="ui-detail-item" t="'+d+'"></span>').appendTo(c)}),c.translation()},renderAddGroup:function(){w.find(":input").each(function(b,c){a(c).val("")}),w.find("#use_AGrpAuthTip").text(""),f(t,A,B,[]),s.prop("checked",h(t)),p.validate(),w.dialog("show")},_onAddGroup:function(c){if(p.isInvalid())return void p.validate();var d=g(t);if(0==d.length)return void w.find("#use_AGrpAuthTip").text(tl("w_Authnone"));var f={};f.Id=j.length+1,f.Name=w.find("#use_AGrpName").val(),f.Memo=w.find("#use_AGrpMemo").val(),a.each(A,function(b,c){-1===a.inArray(c,d)&&d.push(c)}),f.AuthorityList=d,l.UserManager.addGroup(f).done(function(){e.table("add",f,-1),e.table("selectRow",j.length-1),c.ui.close(),q.tip("success","w_AddGroupSucce")}).fail(function(a){c.ui.close();var d=b(a.error&&a.error.code,"w_AddGroupFail",1);q.tip("error",d)})},_renderEditGroup:function(b){x.find(":input").each(function(b,c){a(c).val("")}),x.find("#use_EGrpAuthTip").text("");var c=x.find("#use_EGrpName").empty();a.each(j,function(b,d){a('<option value="'+d.Name+'"></option>').text(d.Name).appendTo(c)}),c.val(b.Name),x.find("#use_EGrpMemo").val(b.Memo),a.each(j,function(a,c){c.Name===b.Name&&(k=c,f(v,A,B,b.AuthorityList))}),u.prop("checked",h(v))},onSelEditGroup:function(b){var c=x.find(b.target).val();k=a.grep(j,function(a){return a.Name==c})[0],z._renderEditGroup(k)},_onEditGroup:function(c){if(r.isInvalid())return void r.validate();var d=g(v);if(0==d.length)return void x.find("#use_EGrpAuthTip").text(tl("w_Authnone"));var f=a.extend(!0,{},k);f.Name=x.find("#use_EGrpName").val(),f.Memo=x.find("#use_EGrpMemo").val(),a.each(A,function(b,c){-1===a.inArray(c,d)&&d.push(c)}),f.AuthorityList=d,l.UserManager.modifyGroup(f.Name,f).done(function(){k.Name=f.Name,k.Memo=f.Memo,k.AuthorityList=f.AuthorityList;var b=0;x.find("#use_EGrpName").find("option").each(function(c,d){a(d).val()==k.Name&&(b=c)}),e.table("modify",k,b),e.table("selectRow",b),q.tip("success","w_ChangeGrpSuc")}).fail(function(a){var c=b(a.error&&a.error.code,"w_ChangeGrpFail",1);q.tip("error",c)}),c.ui.close()},_onDelGroup:function(){l.UserManager.deleteGroup(k.Name).done(function(){q.tip("success","w_DelGroupSucce"),e.table("del",k),e.table("selectRow",0)}).fail(function(a){var c=b(a.error&&a.error.code,"w_DelGroupFali",1);q.tip("error",c)})}})})}),define("use_onvif",function(require,e,f){function g(a,b){var c=b.children("li");if(c.removeClass("current"),a){var d=s.pwdStrenthValidator(a),e=b.find("."+d);e.addClass("current"),b.prop("class","ui-pwd-strength "+d)}else b.prop("class","ui-pwd-strength")}var h,i,j,k,l,m,n,o,p,q=require("jsCore/rpc"),r=require("jsCore/pageBase"),s=require("common/common"),t=["admin","operator","user"];f.exports=r.extend({init:function(){l=this,i=l.$("#use_AOnvifDlg"),j=l.$("#use_EOnvifDlg"),k=l.$("#use_DOnvifDlg"),j.find("#use_EOnvifChkPwd").on("click",function(){j.find("div[data-warp=editOnvifPwd]").css("display",j.find("#use_EOnvifChkPwd").prop("checked")?"":"none")}),i.find("#use_AOnvifPwd").on("keyup",function(){var b=a(this).val(),c=a(this).offsetParent().find(".ui-pwd-strength");g(b,c)}),j.find("#use_EOnvifNPwd").on("keyup",function(){var b=a(this).val(),c=a(this).offsetParent().find(".ui-pwd-strength");g(b,c)}),l._initTable(),l._initDialog(),l._initInput(),l.render()},render:function(){q.DockUser.getUserInfoAll().done(function(a){n=a,h.table("dataSource",n).table("selectRow",0)})},destory:function(){i.remove(),j.remove(),k.remove()},_initTable:function(){h=l.$("#use_OnvifTab").table({pageable:!1,height:200,columns:[{title:tl("w_Numbers"),width:"15%",render:function(a){return a._index+1}},{title:tl("w_User"),width:"25%",fields:"Name"},{title:tl("w_Group Name"),width:"25%",fields:"Group"},{title:tl("w_Amend"),width:"17%",action:"edit",icon:"ui-table-icon-edit",handle:function(a){m=a,j.dialog("show"),l._renderEditOnvif(m)}},{title:tl("Delete"),action:"delete",icon:"ui-table-icon-del",handle:function(a,b){m=a,k.dialog("show"),b.stopPropagation()}}]})},_initDialog:function(){i.dialog({confirm:function(a,b){l._onAddOnvif(b)}}).detach().appendTo(document.body),j.dialog({confirm:function(a,b){l._onEditOnvif(b)}}).detach().appendTo(document.body),k.dialog({confirm:function(a,b){l._onDelOnvif(),b.ui.close()}}).detach().appendTo(document.body)},_initInput:function(){o=a.validator([{element:i.find("#use_AOnvifName"),check:[s.Check.alphaNumLineDotA,s.Check.require],errorMsg:["w_badUserString","w_Need"],events:["blur","blur"],errorElem:".u-input-error"},{element:i.find("#use_AOnvifPwdCfm"),check:[c,s.Check.noQuotationColonAnd],errorMsg:["w_PwdDif","badPwdString"],events:["blur","blur"],errorElem:"#use_AOnvifPwdCfmTip.u-input-error"},{element:i.find("#use_AOnvifPwd"),check:[c],errorMsg:["w_PwdDif"],events:["blur"],errorElem:"#use_AOnvifPwdCfmTip.u-input-error"},{element:i.find("#use_AOnvifPwd"),check:[s.Check.require,s.Check.noQuotationColonAnd],errorMsg:["w_passwordMustnotNull","badPwdString"],events:["blur","blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()}),p=a.validator([{element:j.find("#use_EOnvifPwdCfm"),check:[c,s.Check.noQuotationColonAnd],errorMsg:["w_PwdDif","badPwdString"],events:["blur","blur"],errorElem:"#use_EOnvifPwdCfmTip.u-input-error"},{element:j.find("#use_EOnvifOPwd"),check:[s.Check.noQuotationColonAnd],errorMsg:["badPwdString"],events:["blur"],errorElem:".u-input-error"},{element:j.find("#use_EOnvifNPwd"),check:[c],errorMsg:["w_PwdDif"],events:["blur"],errorElem:"#use_EOnvifPwdCfmTip.u-input-error"},{element:j.find("#use_EOnvifNPwd"),check:[s.Check.require,s.Check.noQuotationColonAnd],errorMsg:["w_passwordMustnotNull","badPwdString"],events:["blur","blur"],errorElem:".u-input-error"}],function(a){a.parent().translation()})},renderAddOnvif:function(){i.find(":input").each(function(b,c){a(c).val("")});var b=i.find("#use_AOnvifgrp").empty();a.each(t,function(c,d){a('<option value="'+d+'"></option>').text(d).appendTo(b)}),d(i.find(".ui-pwd-strength")),o.validate(),i.dialog("show")},_onAddOnvif:function(a){if(o.isInvalid())return void o.validate();var c={};c.Id=n.length+1,c.Name=i.find("#use_AOnvifName").val(),c.Password=i.find("#use_AOnvifPwd").val(),c.Group=i.find("#use_AOnvifgrp").val(),s.EncryptInfo(webApp.EncryptInfo.pub,{user:c}).done(function(d){q.DockUser.addUser(d.salt,"AES-128",d.content).done(function(){c.Password="******",h.table("add",c,-1).table("selectRow",n.length-1),a.ui.close(),l.tip("success","w_AddUserSuc")}).fail(function(c){a.ui.close();var d=b(c.error&&c.error.code,"w_AddUserFail",0);l.tip("error",d)})})},_renderEditOnvif:function(b){j.find(":input").each(function(b,c){a(c).val("")}),d(j.find(".ui-pwd-strength")),j.find("div[data-warp=editOnvifPwd]").css("display","none"),j.find("#use_EOnvifChkPwd").prop("checked",!1);var c=j.find("#use_EOnvifName").empty();a.each(n,function(b,d){a('<option value="'+d.Name+'"></option>').text(d.Name).appendTo(c)}),c.val(b.Name);var e=j.find("#use_EOnvifGrp").empty();a.each(t,function(b,c){a('<option value="'+c+'"></option>').text(c).appendTo(e)}),e.val(b.Group),l.disabled(e,"admin"===b.Name),p.validate()},onSelEditOnvif:function(b){var c=j.find(b.target).val();m=a.grep(n,function(a){return a.Name==c})[0],l._renderEditOnvif(m)},_onEditOnvif:function(a){var c=j.find("#use_EOnvifName").val();if(j.find("#use_EOnvifChkPwd").prop("checked")){if(p.isInvalid())return void p.validate();var d=j.find("#use_EOnvifOPwd").val(),e=j.find("#use_EOnvifNPwd").val();s.EncryptInfo(webApp.EncryptInfo.pub,{name:c,pwd:e,pwdOld:d}).done(function(d){q.DockUser.modifyPassword(d.salt,"AES-128",d.content).done(function(){"admin"===c?l.tip("success","w_ChangeUserSucce"):l._onEditOnvifOnly(),j.dialog("close")}).fail(function(c){var d=b(c.error&&c.error.code,"w_ChangePwdFail",0);a.ui.close(),l.tip("error",d)})})}else"admin"!==c&&l._onEditOnvifOnly(),j.dialog("close")},_onEditOnvifOnly:function(){m.Group=j.find("#use_EOnvifGrp").val(),q.DockUser.modifyUser(m.Name,m).done(function(){var b=0;j.find("#use_EOnvifName").find("option").each(function(c,d){a(d).val()==m.Name&&(b=c)}),h.table("modify",m,b),h.table("selectRow",b),l.tip("success","w_ChangeUserSucce")}).fail(function(a){var c=b(a.error&&a.error.code,"w_ChangeUserFail",0);l.tip("error",c)})},_onDelOnvif:function(){q.DockUser.deleteUser(m.Name).done(function(){l.tip("success","w_DelUserSucce"),h.table("del",m),h.table("selectRow",0)}).fail(function(a){var c=b(a.error&&a.error.code,"w_DelUserFail",0);l.tip("error",c)})}})})}(jQuery);