!function(a){define(function(require,a,b){b.exports=require("jsCore/pageTab")}),define("ala_audio",function(require,b,c){var d=require("jsCore/rpc"),e=require("jsCore/pageBase"),f=require("jsCore/ability"),g=require("common/common"),h=require("jsCore/modules/timeSection");require("widget/js/dui.slider"),require("widget/js/dui.figure"),require("jsCore/modules/eventHandler");var i=null,j=null,k=0;c.exports=e.extend({init:function(){i=this,i.$("#al_au_event").eventHandler(),i.$("#al_au_notingle").numberfield({min:0,max:100,allowDecimal:!1,allowNegative:!1}),f.get("AnomalyDetect").done(function(a){a&&i.$("#al_au_ano").parent().show()}),f.get("MutationDetect").done(function(a){a&&i.$("#al_au_mut").parent().show()}),i.$("#al_au_ano").slider({min:1}),i.$("#al_au_mut").slider({min:1,change:function(a,b){i.$("#al_au_figure").figure("threshold",b.value)}}),i.$("#al_au_figure").figure({width:338});for(var a=i.$("[sel-for=onChangeChannel]").empty().append('<option value="0" t="Audio_Channel+1"></option>'),b=1;b<webApp.AUDIO_IN_NUMBER;b++)a.append("<option value="+b+' t="Audio_Channel+'+(b+1)+'"></option>');a.translation(),d.ConfigManager.getConfig("AudioInput").done(function(b){var c=b[0].AudioSource;f.get("AudioInputCaps").done(function(b){b&&webApp.AUDIO_IN_NUMBER>1&&("LineIn"===c&&b.LineIn>1||"Mic"===c&&b.Mic>1)&&a.parent().show()})}),i.render()},render:function(){i._getConfig(!1),i.$("#al_au_figure").figure("start"),k=(k+1)%65536;for(var a=0;a<webApp.AUDIO_IN_NUMBER;a++)d.DevAudioDetect.attachDetectData(a,k);webApp.NotifyVersion?g.devNotify.subscribe("devAudioDetect.notifyDetectData",window.showMutationFigure):i.$("#al_au_frame").attr("src","cgi-bin/audiomutation.cgi?sessionId="+d.getSession()),$$("[data-page=ala_audio]").getElementById("e_recordchn").addClass("fn-hide"),$$("[data-page=ala_audio]").getElementById("e_snapchn").addClass("fn-hide")},_getConfig:function(a){d.ConfigManager.getConfig("AudioDetect").done(function(b){j=b,i.onChangeChannel(),a&&i.tip("success","Operateingsuccess"),i.disabled("[btn-for=onConfirm]",!1)}).fail(function(){i.tip("error","Operateingfailure"),i.disabled("[btn-for=onConfirm]",!0)})},leave:function(){i._detachData()},destory:function(){i._detachData()},onChangeChannel:function(){var a=j[parseInt(i.$("[sel-for=onChangeChannel]").val())];i.$("#al_au_expopen").prop("checked",a.AnomalyDetect),i.$("#al_au_breopen").prop("checked",a.MutationDetect),i.$("#al_au_notingle").numberfield("value",a.EventHandler.Dejitter),i.$("#al_au_ano").slider("value",a.AnomalySensitive),i.$("#al_au_mut").slider("value",a.MutationThreold),i.$("#al_au_figure").figure("threshold",a.MutationThreold),i.$("#al_au_event").eventHandler("set",a.EventHandler)},onDefault:function(){d.ConfigManager.getDefault("AudioDetect").done(function(a){j=a,i.onChangeChannel(),i.tip("success","Defaultsuccess")}).fail(function(){i.tip("error","Defaultfailure")})},onRefresh:function(){i._getConfig(!0)},onConfirm:function(){var a=parseInt(i.$("[sel-for=onChangeChannel]").val());j[a].AnomalyDetect=i.$("#al_au_expopen").prop("checked"),j[a].MutationDetect=i.$("#al_au_breopen").prop("checked"),j[a].AnomalySensitive=i.$("#al_au_ano").slider("value"),j[a].MutationThreold=i.$("#al_au_mut").slider("value"),j[a].EventHandler=i.$("#al_au_event").eventHandler("get"),j[a].EventHandler.SnapshotChannels=[0],j[a].EventHandler.RecordChannels=[0],j[a].EventHandler.ExAlarmOutChannels=[0],j[a].EventHandler.Dejitter=i.$("#al_au_notingle").numberfield("value"),d.ConfigManager.setConfig("AudioDetect",j).done(function(){i.tip("success","Succeed in saving configure")}).fail(function(){i.tip("error","Saving failure")})},onSetPeriod:function(){var a=j[parseInt(i.$("[sel-for=onChangeChannel]").val())];h.open(a.EventHandler.TimeSection).done(function(b){a.EventHandler.TimeSection=b})},_detachData:function(){i.$("#al_au_figure").figure("stop");for(var a=0;a<webApp.AUDIO_IN_NUMBER;a++)d.DevAudioDetect.detachDetectData(a,k);webApp.NotifyVersion?g.devNotify.detach("devAudioDetect.notifyDetectData"):i.$("#al_au_frame").attr("src","")}}),window.showMutationFigure=function(b){if(b&&b.data){var c=parseInt(i.$("[sel-for=onChangeChannel]").val()),d=b.data;c===d.Channel&&a.isNumeric(d.AudioMutation)&&i.$("#al_au_figure").figure("push",d.AudioMutation)}}})}(jQuery);