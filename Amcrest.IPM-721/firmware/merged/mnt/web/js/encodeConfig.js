!function(a){var b={};define(function(require,c,d){d.exports=require("jsCore/pageTab"),d.exports.prototype.enc_inter=a.when(rpc.DevVideoEncode.getCaps(),ability.is("ROIConflict")).then(function(a,c){return b=a,!(c||!isEnable("is_show_roi")||!a.MaxROICount)}),d.exports.prototype.enc_encrypt=rpc.DevVideoEncode.getCaps().then(function(a){return 2===a.EncryptMask})}),define("enc_encode",function(require,c,d){var e=require("jsCore/pageBase"),f=require("jsCore/rpc");require("widget/js/dui.iconlist"),require("widget/js/dui.iconSelect");var g,h,i,j,k,l,m,n,o=null,p=null,q=0,r=0,s=0,t=[0,32,48,64,80,96,128,160,192,224,256,320,384,448,512,640,768,896,1024,1280,1536,1792,2048,4096,6144,8192,10240,12288,14336,16384,18432,20480,22528],u={Main:"H.264",Baseline:"H.264B",High:"H.264H"},v=0,w=["H.264"],x=!0,y=[{Compression:"H.264",Policy:0},{Compression:"H.264",Policy:0},{Compression:"H.264",Policy:0}],z=null,A=["H.264"],B=null,s=0;d.exports=e.extend({init:function(){if(o=this,webApp.GongAnDetect&&A.push("H.265"),webApp.CHANNEL_NUMBER>1&&(o.$("#enc_encode_channel").parent().removeClass("fn-hide"),o.$("#enc_encode_channel").parent().next("div").removeClass("fn-hide"),B=a("#enc_encode_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){s=b.ch,o._putvalueWater(h,s),o._putJsonEncode(g)}}),B.iconSelect("index",s)),o.bind(),v=b.MaxSVCTLevel||0,w=b.SvcEncodeTypes||["H.264"],x=isEnable("special_GOP_728WP"),v>0){for(var c="",d=1;v>=d;d++)c+='<option value="'+d+'">'+d+(1==d?"(off)":"")+"</option>";o.$("#video_svc0").append(c),o.$("#video_svc1").append(c),o.$("#video_mainSvc").removeClass("fn-hide"),o.$("#video_extrSvc").removeClass("fn-hide")}if(isEnable("is_show_mainStreamType")){var e=o.$("#video_streamType0");e.parent().removeClass("fn-hide");var f='<option value="1" t="w_Motion"></option>';(webApp.ALARM_IN_NUMBER>0||webApp.IsLocalStore)&&(f+='<option value="2" t="w_Alarm"></option>'),e.append(f).translation()}var i=o.$("#video_extraAudioList");ability.is("ExtraConflict").done(function(a){if(webApp.MaxExtraStream<1)o.$("#video_subStream_con").addClass("fn-hide");else if(webApp.MaxExtraStream<2)i.addClass("fn-hide");else{for(var b="",c=a?1:webApp.MaxExtraStream,d=0;c>d;d++)b+="<option value="+d+' t="w_SecondStream'+(d+1)+'"></option>';i.append(b).translation(),webApp.GongAnDetect&&(i.append('<option value="2">辅码流3</option>'),i.append('<option value="3">辅码流4</option>'))}o.render()}),ability.get("RotateResolutionLimit").done(function(a){a&&o.$("#video_resolution0").data("limitR",a)})},bind:function(){o.$("#video_custom0").numberfield({allowNegative:!1,allowDecimal:!1}),o.$("#video_custom1").numberfield({allowNegative:!1,allowDecimal:!1}),o.$("#video_gop0").numberfield({max:150,allowNegative:!1,allowDecimal:!1}).change(function(){o._refreshEncodeCap(0)}),o.$("#video_gop1").numberfield({max:150,allowNegative:!1,allowDecimal:!1}).change(function(){o._refreshEncodeCap(1)}),o.$("#video_waterString").textfield({charset:"utf-8",length:127}),o.$("#svcPsd0").textfield({validReg:/^[^\u4E00-\u9FA5]*$/,errorHandle:"prevent"})},onSelectMode:function(b){var c=a(b.target),d=c.attr("id").slice(-1),e="#video_bitctrl"+d;"on"===c.val()?(o.$(e).val("VBR").change(),o.$("#video_showGop0").addClass("fn-hide")):(o.$(e).val("CBR").change(),o.$("#video_showGop0").removeClass("fn-hide")),p[0].Enable="on"===c.val(),v&&o.renderSvc(g[s].MainFormat[q].Video.Compression,0)},render:function(){q=0,r=0,o.$("#video_extraAudioList").val(r),f.ConfigManager.getConfig(["Encode","VideoWaterMark","MediaGlobal","EncodeEncrypt","EncodeAuth","VideoImageControl"]).done(function(b){if(g=b[0].params.table,j=a.extend(!0,{},g),h=b[1].params.table,i=b[2].params.table,l=b[3].result&&b[3].params.table,m=b[4].result&&b[4].params.table,b[5].result){var c=b[5].params.table[s].Rotate90;o.$("#video_resolution0").data("rotate",c)}o._getCapsConfig(),f.Encode.getConfigCaps(0,g).done(function(a){k=a,f.Encode.getSmartCaps(y,s).done(function(a){z=a,f.ConfigManager.getConfig("SmartEncode").done(function(a){p=a,o._initPage(),o._putvalue()})}).fail(function(){o._initPage(),o._putvalue()})})})},_getCapsConfig:function(){var b=[g[s].MainFormat[0].Video,g[s].ExtraFormat[0].Video,g[s].ExtraFormat[1].Video];a.each(b,function(a,b){y[a].Compression=b.Compression})},_initPage:function(a){var b=k[s].MainFormat[q];if(z&&1===z[0]&&!a&&(n=p[0].Enable?"on":"off"),o._putEncodeCap(b,0),webApp.MaxExtraStream>0){var c=k[s].ExtraFormat[r];o._putEncodeCap(c,1)}},_putvalue:function(a,b){o._putvalueMain(g,s,q,a,b),o._putvalueExtr(g,s,r,a,b),o._putvalueWater(h,s)},_putEncodeCap:function(b,c){var d=g[s].MainFormat[q].Video.Compression;z&&1===z[0]&&"MJPG"===d?(o.$("#video_sencode0").parent().hide(),p[0].Enable=!1,o.$("#video_sencode0").val("off")):o.$("#video_sencode0").parent().hide();var e=o.$("#video_compression"+c);e.empty();var f="";a.each(b.Video.CompressionTypes,function(c,d){isEnable("is_k6_DeviceType")&&"MJPG"==d||("H.264"==d?b.Video.H264Profile?a.each(b.Video.H264Profile,function(a,b){f+="<option value="+u[b]+" t=w_"+b+"></option>"}):(f+="<option value="+d+" t=w_"+d+"></option>",f+='<option value="H.264B" t="H.264B"></option>',f+='<option value="H.264H" t="H.264H"></option>'):"H.265"==d?(f+="<option value="+d+" t="+d+"></option>",webApp.GongAnDetect&&(f+='<option value="H.265B" t="H.265B"></option>',f+='<option value="H.265H" t="H.265H"></option>')):f+="<option value="+d+" t="+d+"></option>")}),e.append(f).translation(),o._insertResolution(b.Video.ResolutionTypes,o.$("#video_resolution"+c));var h=o.$("#video_fps"+c);h.empty(),0===b.Video.FPSMax&&h.append('<option value="0">0</option>');for(var i=0;i<b.Video.FPSMax;i++)h.append("<option value="+(i+1)+">"+(i+1)+"</option>");var j=b.Video.BitRateOptions;o.renderBitRate(o.$("#video_bitrate"+c),o.getBitRateList(j)),a("#video_bitrefer"+c).text(j[0]+"-"+j[1]+"Kb/S"),a("#video_custom"+c).numberfield("min",j[0]),a("#video_custom"+c).numberfield("max",j[1])},_insertResolution:function(b,c){c.empty(),a.each(b,function(a,b){var d=b;"720"==b&&(d="720P"),"1080"==b&&(d="1080P"),"1_3M"==b&&(d="1.3M"),"2_5M"==b&&(d="2.5M"),c.append("5_1M"==d?"<option value="+d+" realvalue="+b+">5M ("+getWidthH(d)+")</option>":"<option value="+d+" realvalue="+b+">"+d+" ("+getWidthH(d)+")</option>")})},_putvalueMain:function(b,c,d,e,f){var g=b[c].MainFormat[d],h=g.Video,i=getFrame(h.Width,h.Height);o.$("#video_resolution0")[0].value=i,o.disabled(o.$("#video_resolution0"),!!d),o.disabled(o.$("#video_compression0"),!!d),o.$("#video_quality0").val(h.Quality),o.$("#video_gop0").val(h.GOP),v>0&&o.$("#video_svc0").val(h.SVCTLayer);var j=o.$("#video_compression0");a.inArray(h.Compression,A)>-1?("Baseline"==h.Profile&&j.val(h.Compression+"B"),"High"==h.Profile&&j.val(h.Compression+"H"),"Main"==h.Profile&&j.val(h.Compression)):j.val(h.Compression),v&&o.renderSvc(h.Compression,0),l&&m&&o.renderSVAC(h.Compression,0,h.SVCTLayer),j[0].selectedIndex<=0&&(j[0].selectedIndex=0),o.$("#video_resolution0")[0].selectedIndex<=0&&(o.$("#video_resolution0")[0].selectedIndex=0);var q=o.$("#video_bitctrl0");if("MJPG"==j.val())q.val("CBR").change(),o.disabled(q,!0),o.$("#video_showQuality0").addClass("fn-hide"),o.$("#video_showGop0").addClass("fn-hide");else if(o.disabled(q,!1),q.val(h.BitRateControl).change(),o.$("#video_showQuality0").toggleClass("fn-hide","CBR"==h.BitRateControl),z&&1===z[0]){var r=p[0].Enable?"on":"off";if(o.$("#video_sencode0").val(r),j.children().is('option[value="MJPG"]')){var s=j.find('option[value="MJPG"]');"on"===n&&s.remove()}o.$("#video_showGop0").toggleClass("fn-hide","on"===r)}else o.$("#video_showGop0").removeClass("fn-hide");o.$("#video_fps0")[0].value=h.FPS;var t=o.$("#video_fps0 option").length;if(h.FPS>t&&(o.$("#video_fps0 option:last").prop("selected",!0),o.$("#video_gop0").val(x?2*t:12)),x){var u=o.$("#video_fps0").val()-0;o.$("#video_gop0_range").text("("+u+"~150)"),o.$("#video_gop0").numberfield("min",u)}else o.$("#video_gop0_range").text("(12~150)"),o.$("#video_gop0").numberfield("min",12);o.$("#video_gop0").attr("maxVal",150);var w=0===e,y=h.BitRate,B=k[c].MainFormat[d].Video.BitRateSuggested;f&&0===e&&B&&0!==B&&(y=B);var C=o.getSuggestBitRate(k[c].MainFormat[d].Video.BitRateOptions,y,w);o.putBitRateValue(0,C)},_putvalueExtr:function(b,c,d,e,f){if(!(webApp.MaxExtraStream<1)){var g=b[c].ExtraFormat[d],h=g.Video;o.$("#video_subStream_enable").prop("checked",g.VideoEnable);var i=getFrame(h.Width,h.Height);o.$("#video_resolution1")[0].value=i,o.$("#video_quality1").val(h.Quality),o.$("#video_gop1").val(h.GOP),v>0&&o.$("#video_svc1").val(h.SVCTLayer);var j=o.$("#video_compression1");a.inArray(h.Compression,A)>-1?("Baseline"==h.Profile&&j.val(h.Compression+"B"),"High"==h.Profile&&j.val(h.Compression+"H"),"Main"==h.Profile&&j.val(h.Compression)):j.val(h.Compression),v&&o.renderSvc(h.Compression,1),j[0].selectedIndex<=0&&(j[0].selectedIndex=0),o.$("#video_resolution1")[0].selectedIndex<=0&&(o.$("#video_resolution1")[0].selectedIndex=0);var l=o.$("#video_bitctrl1");"MJPG"==j.val()?(l.val("CBR").change(),o.disabled(l,!0),o.$("#video_showQuality1").addClass("fn-hide"),o.$("#video_showGop1").css("display","none")):(o.$("#video_showGop1").css("display","block"),o.disabled(l,!1),l.val(h.BitRateControl).change(),o.$("#video_showQuality1").toggleClass("fn-hide","CBR"==h.BitRateControl)),o.$("#video_fps1")[0].value=h.FPS;var m=o.$("#video_fps1 option:first").val(),n=o.$("#video_fps1 option:last").val();if(h.FPS<m){o.$("#video_fps1").val(m);var p=x?2*(m-0):12;o.$("#video_gop1").val(p)}else if(h.FPS>n){o.$("#video_fps1").val(n);var p=x?2*(n-0):12;o.$("#video_gop1").val(p)}if(x){var q=o.$("#video_fps1").val()-0;o.$("#video_gop1_range").text("("+q+"~150)"),o.$("#video_gop1").numberfield("min",q)}else o.$("#video_gop1_range").text("(12~150)"),o.$("#video_gop1").numberfield("min",12);o.$("#video_fps1").attr("maxVal",150);var r=1===e,s=h.BitRate,t=k[c].ExtraFormat[d].Video.BitRateSuggested;f&&1===e&&t&&0!==t&&(s=t);var u=o.getSuggestBitRate(k[c].ExtraFormat[d].Video.BitRateOptions,s,r);o.putBitRateValue(1,u)}},_putvalueWater:function(a,b){var c=a[b],d=o.$("#video_water_enable");d.prop("checked",c.Enable),o.$("#video_water_show").toggleClass("fn-hide",!c.Enable),o.$("#video_waterString").val(c.String)},renderSvc:function(b,c){0===c?p&&p[0].Enable?o.$("#video_mainSvc").addClass("fn-hide"):a.inArray(b,w)<0?o.$("#video_mainSvc").addClass("fn-hide"):o.$("#video_mainSvc").removeClass("fn-hide"):o.$("#video_extrSvc").toggleClass("fn-hide",a.inArray(b,w)<0)},renderSVAC:function(a,b,c){if("SVAC"===a){o.$("#video_mainSvac"+b).show();var d=l[s][b],e=m[s];o.$("#video_svac_svc"+b).val(2===c?c:1),o.$("#video_svcPwd_enable"+b).prop("checked",d.EncryptEnable),o.$("#svcPsd"+b).val(d.Key),o.$("#video_encodeAuth_enable"+b).prop("checked",e.Enable),o.disabled(o.$("#svcPsd"+b),!d.EncryptEnable)}else o.$("#video_mainSvac"+b).hide()},renderBitRate:function(b,c){var d="";a.each(c,function(a,b){d+='<option value="'+b+'">'+b+"</option>"}),d+='<option value="customize" t="w_Customize">Customized</option>',b="element"==$type(b)?b:a(b),b.html(d).translation(),b.data("BitRateList",c.join(","))},getSuggestBitRate:function(a,b,c){var d=o.getBitRateList(a),e=((a[0]+a[1])/2).toInt();if(b>=a[0]&&b<=a[1])return b;for(var f=0;f<d.length;f++)if(d[f]>=e)return d[f];return c?e:d[f-1]},putBitRateValue:function(b,c){var d=o.$("#video_bitrate"+b),e=o.$("#video_customwrap"+b),f=o.$("#video_custom"+b);d.val(c);var g=d.data("BitRateList").split(",");a.inArray(c.toString(),g)>-1?e.addClass("fn-hide"):(d.val("customize"),e.removeClass("fn-hide"),f.val(c))},getBitRateList:function(b){var c=a.grep(t,function(a){return a>=b[0]&&a<=b[1]});return c.sort(function(a,b){return a-b})},_saveEncode:function(b){var c=g[b].MainFormat[q];if(o._saveEncodeByType(c,0),webApp.MaxExtraStream>0){var d=g[b].ExtraFormat,e=d[r];o._saveEncodeByType(e,1),o.$("#video_subStream_enable").prop("checked")?e.VideoEnable=!0:(e.VideoEnable=!1,e.AudioEnable=!1)}var f=c.Video.Width,h=c.Video.Height;"ExtraFormat"==i.SnapFormatAs?(f=d[0].Video.Width,h=d[0].Video.Height):"Extra2Format"==i.SnapFormatAs?(f=d[1].Video.Width,h=d[1].Video.Height):"Extra3Format"==i.SnapFormatAs&&(f=d[2].Video.Width,h=d[2].Video.Height);var j=g[b].SnapFormat;a.each(j,function(a,b){b.Video.Width=f,b.Video.Height=h})},_saveEncodeByType:function(a,b){var c=o.$("#video_compression"+b).val(),d=null;"H.264"==c?d="Main":"H.264B"==c?(d="Baseline",c="H.264"):"H.264H"==c&&(d="High",c="H.264"),"H.265"==c?d="Main":"H.265B"==c?(d="Baseline",c="H.265"):"H.265H"==c&&(d="High",c="H.265"),a.Video.Compression=c,null!==d&&(a.Video.Profile=d);var e=getWidthH(o.$("#video_resolution"+b).val()).split("*");a.Video.Width=e[0]-0,a.Video.Height=e[1]-0,v>0&&(a.Video.SVCTLayer=o.$("#video_svc"+b).val()-0),a.Video.FPS=o.$("#video_fps"+b).val()-0,a.Video.BitRateControl=o.$("#video_bitctrl"+b).val(),a.Video.Quality=o.$("#video_quality"+b).val()-0,a.Video.BitRate="customize"==o.$("#video_bitrate"+b).val()?o.$("#video_custom"+b).val()-0:o.$("#video_bitrate"+b).val()-0,a.Video.GOP=o.$("#video_gop"+b).val()-0},saveSVAC:function(){l[s][0].EncryptEnable=o.$("#video_svcPwd_enable0").prop("checked"),l[s][0].Key=o.$("#svcPsd0").val(),m[s].Enable=o.$("#video_encodeAuth_enable0").prop("checked"),g[s].MainFormat[0].Video.SVCTLayer=o.$("#video_svac_svc0").val()-0},onSave:function(){var b=function(b){var c=o.$("#video_resolution0").data("rotate");if(c){var d=o.$("#video_resolution0 option:selected").attr("realvalue");if(a.inArray(d,o.$("#video_resolution0").data("limitR"))<0){var e="";return"SimpChinese"!=Site.currentLanguage&&(e=1==c?"w_clockwise90Ex":"w_clockwise90Ex2"),o.tip("error",tl("noResolution")+tl(e)),!1}}var i=o.$("#video_water_enable").prop("checked");h[s].Enable=i,i&&(h[s].String=o.$("#video_waterString").val()),o._saveEncode(s),o._checkBitRate();var k=["Encode","VideoWaterMark"],n=[g,h];z&&1===z[0]&&(k.push("SmartEncode"),n.push(p)),"SVAC"===o.$("#video_compression0").val()&&(o.saveSVAC(),k.push("EncodeEncrypt","EncodeAuth"),n.push(l,m)),0!==q||isEnable("is_show_mainStreamType")||(g[s].MainFormat[1].Video=g[s].MainFormat[2].Video=g[s].MainFormat[0].Video),f.ConfigManager.setConfig(k,n).done(function(c){var d=0;if(a.each(c,function(b,c){c&&!c.result&&(d=2,a.each(c.params.options,function(a,b){return"CapsNotSupport"==b?(d=1,!1):void 0}))}),1==d)o.tip("error","Rorateresolutiong Saving failure");else if(2==d)o.tip("error","Saving failure");else{var e=g[s].MainFormat[0].Video;"SVAC"==e.Compression&&(l.EncryptEnable&&plugin.SetDecodeKey(l.Key),!(e.SVCTLayer-1)&&plugin.ChooseFrame(0)),webApp.isNeedReboot(c)&&webApp.reboot("w_Rebooting..."),f.ConfigManager.getConfig("Encode").done(function(c){g=c,j=a.extend(!0,{},g),o._putJsonEncode(g),b&&f.MagicBox.reboot()}),o.tip("success","Succeed in saving configure")}})};z&&1===z[0]&&void 0!==n&&o.$("#video_sencode0").val()!==n?a.confirm(tl("SmartEncode"),tl("w_rebootconfirm"),function(){b(!0)}):b(!1)},onRefresh:function(){f.ConfigManager.getConfig(["Encode","VideoWaterMark","EncodeEncrypt","EncodeAuth"]).done(function(a){g=a[0].params.table,h=a[1].params.table,l=a[2].result&&a[2].params.table,m=a[3].result&&a[3].params.table,o._putvalueWater(h,s),o._putJsonEncode(g),o.tip("success","Operateingsuccess")}).fail(function(){o.tip("error","Operateingfailure")})},onDefault:function(){f.ConfigManager.getDefault(["Encode","VideoWaterMark","EncodeEncrypt","EncodeAuth"]).done(function(b){var c=b[0].params.table;h=b[1].params.table,l=b[2].result&&b[2].params.table,m=b[3].result&&b[3].params.table;var d=g[s].MainFormat,e=g[s].ExtraFormat;a.each(c[s].MainFormat,function(b,c){d[b]&&(d[b].Video=a.extend(!0,{},c.Video))}),a.each(c[s].ExtraFormat,function(b,c){e[b]&&(e[b].Video=a.extend(!0,{},c.Video),e[b].VideoEnable=c.VideoEnable)}),o._putvalueWater(h,s),o._getCapsConfig(),f.Encode.getConfigCaps(0,g).done(function(a){k=a,f.Encode.getSmartCaps(y,s).done(function(a){z=a,f.ConfigManager.getDefault("SmartEncode").done(function(a){p=a,o._initPage(!0),o._putvalue()})}).fail(function(){o._initPage(),o._putvalue()})}),o.tip("success","Defaultsuccess")}).fail(function(){o.tip("error","Defaultfailure")})},_checkBitRate:function(){var b=g[s].ExtraFormat;a.each(k[s].ExtraFormat,function(a,c){b[a].Video.BitRate=o.getSuggestBitRate(c.Video.BitRateOptions,b[a].Video.BitRate)})},_putJsonEncode:function(a){o._getCapsConfig(),f.Encode.getConfigCaps(0,a).done(function(a){k=a,f.Encode.getSmartCaps(y,s).done(function(a){z=a,f.ConfigManager.getConfig("SmartEncode").done(function(a){p=a,o._initPage(),o._putvalue()})}).fail(function(){o._initPage(),o._putvalue()})})},onRefreshEncodeCap:function(b){var c=b.target.id,d=c.substr(0,c.length-1),e=c.substr(c.length-1,1)-0;switch(d){case"video_compression":o._refreshEncodeCap(e,!0);break;case"video_resolution":o._refreshEncodeCap(e);break;case"video_fps":var f=x?2*(a("#"+c).val()-0):12;a("#video_gop"+e).val(f),o._refreshEncodeCap(e)}},onSelectBitRate:function(b){var c=b.target.id,d=c.substr(c.length-1,1)-0,e=o.$("#video_customwrap"+d),f=o.$("#video_custom"+d);if("customize"==o.$("#"+c).val()){e.removeClass("fn-hide");var g=a("#video_bitrefer"+d).text().split("-"),h=f.val()-0;(h<g[0]||h>g[1])&&f.val((g[0]+g[1])/2)}else e.addClass("fn-hide")},onSelectBitctrl:function(a){var b=a.target.id,c=b.substr(b.length-1,1)-0,d=a.target.value,e="VBR"===d?"streamLimit":"w_Code Stream";o.$("#video_showQuality"+c).toggleClass("fn-hide","CBR"==d),0===c&&o.$("#video_bitrate0").parent().prev("label").attr("t",e).parent().translation(),1===c&&o.$("#video_bitrate1").parent().prev("label").attr("t",e).parent().translation()},_refreshEncodeCap:function(b,c){o._saveEncode(s,!0);var d=a.map(g,function(b){return a.extend(!0,{},b)});isEnable("is_show_mainStreamType")||(d[s].MainFormat[1].Video=d[s].MainFormat[2].Video=d[s].MainFormat[0].Video);var e=o.$("#video_compression"+b).val(),h=0;"H.264"===e.slice(0,5)?e="H.264":"H.265"===e.slice(0,5)&&(e="H.265"),0===b?h=0:0!==b&&"0"===o.$("#video_extraAudioList").val()||0!==b?h=1:0!==b&&"1"===o.$("#video_extraAudioList").val()&&(h=2),webApp.GongAnDetect&&("2"===o.$("#video_extraAudioList").val()&&(h=1),"3"===o.$("#video_extraAudioList").val()&&(h=2)),y[h].Compression=e,f.Encode.getConfigCaps(0,d).done(function(d){null!=a("ENCODECFG")&&(k=d,f.Encode.getSmartCaps(y,s).done(function(a){z=a}).always(function(){o._initPage(!0),o._putvalue(b,c)}))})},onSelectExtr:function(a){o._saveEncode(s),r=a.target.value-0,2===r&&webApp.GongAnDetect&&(r=0),3===r&&webApp.GongAnDetect&&(r=1);var b=k[s].ExtraFormat[r];o._putEncodeCap(b,1),o._putvalueExtr(g,s,r)},onClickWater:function(b){var c=a(b.target).prop("checked");o.$("#video_water_show").toggleClass("fn-hide",!c)},onSelectMain:function(a){o._saveEncode(s),q=a.target.value-0;var b=k[s].MainFormat[q];o._putEncodeCap(b,0),o._putvalueMain(g,s,q)},onClickPassword:function(a){var b=o.$(a.target).prop("checked");o.disabled(o.$("#svcPsd0"),!b)}})}),define("enc_snap",function(require,b,c){var d,e,f=require("jsCore/pageBase"),g=require("jsCore/rpc"),h=require("jsCore/ability"),i=require("common/common"),j=null,k=0,l=!1,m=0,n=null;c.exports=f.extend({init:function(){j=this,j.$("#snapSpeed_customized").numberfield({max:5e4,min:1,allowNegative:!1,allowDecimal:!1}),webApp.CHANNEL_NUMBER>1&&(j.$("#enc_snap_channel").parent().removeClass("fn-hide"),j.$("#enc_snap_channel").parent().next("div").removeClass("fn-hide"),n=a("#enc_snap_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){m=b.ch,j._putvalueSnap(d,m,k)}}),n.iconSelect("index",m)),h.get("SnapshotInterval").done(function(a){a&&(j.$("#snapSpeed_customized").numberfield("max",a),j.$("#snapinterval").text("(1-"+a+")"))}),j.$('input[name= "snap_selSnapFormatsAs"]').click(j._selSnapFormatsAs),j.render()},render:function(){k=0,g.ConfigManager.getConfig(["Encode","MediaGlobal"]).done(function(a){d=a[0].params.table,e=a[1].params.table,e.SnapFormatAs&&isEnable("is_has_SnapFormatAs")?(l=!0,j.$("#snap_showSnapFormatAs").removeClass("fn-hide")):j.$("#snap_showSnapFormatAs").addClass("fn-hide"),j._putvalueSnap(d,m,k)})},_putvalueSnap:function(a,b,c,d){j.$("#snap_snaptype").val(c);var f=j.$("#snap_resolution"),g=a[b].SnapFormat[c];if(!d){var h=getFrame(g.Video.Width,g.Video.Height),i=h;"5_1M"===h&&(i="5M"),f.val(i+" ("+getWidthH(h)+")")}j.disabled(f),l&&j.$("input[value="+e.SnapFormatAs+"]").prop("checked",!0);var k=a[0].ExtraFormat[0].VideoEnable;j.disabled(j.$("#snapSub_enable"),!k),j.$("#snap_imgQuality").val(g.Video.Quality);var m=(1/g.Video.FPS).round();m>7?(j.$("#snap_snapSpeed").val("Customized"),j.$("#snapSpeed_customized_wrap").removeClass("fn-hide")):(j.$("#snap_snapSpeed").val("-"+m),j.$("#snapSpeed_customized_wrap").addClass("fn-hide")),j.$("#snapSpeed_customized").val(m)},_saveSnap:function(){var b=d[m],c=b.MainFormat[0].Video,f=b.SnapFormat;l&&(j.$("#snapSub_enable").prop("checked")?(c=b.ExtraFormat[0].Video,e.SnapFormatAs="ExtraFormat"):j.$("#snapMain_enable").prop("checked")&&(e.SnapFormatAs="MainFormat"));var g=c.Width,h=c.Height;a.each(f,function(a,b){b.Video.Width=g,b.Video.Height=h}),f[k].Video.Quality=j.$("#snap_imgQuality").val()-0,f[k].Video.FPS=j._getSnapSpeed()},_getSnapSpeed:function(){var a=j.$("#snap_snapSpeed"),b=1;if("Customized"==a.val()){var c=j.$("#snapSpeed_customized");b=1/(c.val()-0)}else{var d=a.val()-0;b=0>d?-1/d:d}return b},onDefault:function(){g.ConfigManager.getDefault(["Encode","MediaGlobal"]).done(function(b){var c=b[0].params.table,f=b[1].params.table;d[m].SnapFormat=a.map(c[m].SnapFormat,function(b){return a.extend(!0,{},b)}),e.SnapFormatAs=f.SnapFormatAs,j._putvalueSnap(d,m,k,!0),j.tip("success","Defaultsuccess")}).fail(function(){j.tip("error","Defaultfailure")})},onRefresh:function(){g.ConfigManager.getConfig(["Encode","MediaGlobal"]).done(function(a){d=a[0].params.table,e=a[1].params.table,j._putvalueSnap(d,m,k),j.tip("success","Operateingsuccess")}).fail(function(){j.tip("error","Operateingfailure")})},onSave:function(){j._saveSnap(),g.ConfigManager.setConfig(["Encode","MediaGlobal"],[d,e]).done(function(a){i.chkMutilCallRet(a)?j.tip("success","Succeed in saving configure"):j.tip("error","Saving failure")})},onChangeSnap:function(a){j._saveSnap(),k=a.target.value-0,j._putvalueSnap(d,m,k)},onChangeSpeed:function(a){var b=a.target.value;"Customized"==b?j.$("#snapSpeed_customized_wrap").removeClass("fn-hide"):j.$("#snapSpeed_customized_wrap").addClass("fn-hide")},_selSnapFormatsAs:function(b){var c=a(b.target).val(),e=d[m].MainFormat[0].Video;"ExtraFormat"==c&&(e=d[m].ExtraFormat[0].Video);var f=getFrame(e.Width,e.Height),g=f;"5_1M"===f&&(g="5M"),j.$("#snap_resolution").val(g+" ("+getWidthH(f)+")")}})}),define("enc_osd",function(require,b,c){function d(a,b,c,d){a=a||[0,0,0,0],c=(y*c).toInt(),d=(z*d).toInt();var e=a[0]+c>8191?8191-c:a[0],f=a[1]+d>8191?8191-d:a[1];plugin.SetRegionNum(0),plugin.SetRegionNum(1),plugin.SetRegionAttributeByIndex(0,b,1,0,0,0),setTimeout(function(){plugin.SetSelRegionByIndex(0,e,f,e+c,f+d)},0)}function e(a){k[C].CustomTitle[1].FrontColor=a,k[C].TimeTitle.FrontColor=a,k[C].ChannelTitle.FrontColor=a,k[C].PTZPreset&&(k[C].PTZPreset.FrontColor=a),k[C].Temperature&&(k[C].Temperature.FrontColor=a),k[C].PTZCoordinates&&(k[C].PTZCoordinates.FrontColor=a),k[C].PTZZoom&&(k[C].PTZZoom.FrontColor=a),k[C].PTZOSDMenu&&(k[C].PTZOSDMenu.FrontColor=a),k[C].PTZOSDMenuViaApp&&(k[C].PTZOSDMenuViaApp.FrontColor=a),k[C].PTZDirection&&(k[C].PTZDirection.FrontColor=a),k[C].GPSTitle&&(k[C].GPSTitle.FrontColor=a),k[C].VoltageStatus&&(k[C].VoltageStatus.FrontColor=a),k[C].PtzPattern&&(k[C].PtzPattern.FrontColor=a),k[C].PtzRS485Detect&&(k[C].PtzRS485Detect.FrontColor=a),v&&(o.FrontColor=a),k[C].GPSTitle&&(k[C].GPSTitle.FrontColor=a)}function f(b,c,d){function e(){for(var b,e=a(this).val(),f=0,g=0,h=e.length;h>g&&(b=e.charCodeAt(g),f+=127>=b?c.asciiByte||1:c.notAsciiByte||3,!(f>c.maxByte));g++);f>c.maxByte&&(a(this).val(e.slice(0,g)),d&&d())}c=c||{},c.maxlength&&b.attr("maxlength",c.maxlength),b.on("keyup",e),b.on("blur",e)}var g=require("jsCore/pageBase"),h=require("jsCore/rpc"),i=require("jsCore/ability"),j=require("common/common"),k={},l={},m={},n={},o={},p={},q={},r={},s=!1,t=!1,u=!1,v=!1,w=!1,x={},y=16.382,z=8191/374,A="/current_config/",B=null,C=0,D=!0;c.exports=g.extend({init:function(){B=this,i.get("PtzFunctionMenu").done(function(a){a&&a.Support&&(s=!0,B.$("#osd_preset").removeClass("fn-hide"))}),h.FaceBoard.getCaps().done(function(b){var c=b.Temperatures||[],d=b.OSDTemperatureUnit||[];if(t=c.length?!0:!1,u=d.length?!0:!1,t&&B.$("#osd_temperature").removeClass("fn-hide"),u){B.$("#osd_TempUnit_wrap").removeClass("fn-hide");var e={Centigrade:"℃",Fahrenheit:"℉",Kelvin:"K"},f="";a.each(d,function(a,b){f+='<option value= "'+b+'">'+e[b]+"</option>"}),B.$("#osd_TempUnit").html(f)}}),isEnable("is_show_image")&&B.$('[data-for="osd_image"]').removeClass("fn-hide"),isEnable("is_show_fontSize")&&(B.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),B.$("#osd_fontsGrade").removeClass("fn-hide"),x.grade=!0),i.get("FontColour").done(function(a){a&&a.Support&&(x.color=!0,B.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),B.$("#osd_fontColor").removeClass("fn-hide"),B.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation())}),i.get("FontBorder").done(function(a){a&&a.Support&&(x.border=!0,B.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),B.$("#osd_fontBorder_wrap").removeClass("fn-hide"),B.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation())}),i.get("FontSize").done(function(a){a&&a.Support&&(B.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),a.Type.contains("Grade")&&(x.grade=!0,B.$("#osd_fontsGrade").removeClass("fn-hide")),a.Type.contains("Pixel")&&(x.pixel=!0,B.$("#osd_fontsPixel").removeClass("fn-hide"),x.grade=!1,B.$("#osd_fontsGrade").addClass("fn-hide"),B.$('[data-for = "osd_fontSetting"] span').attr("t","font;title::font").parent().translation()))}),h.OSDManager.getCaps().done(function(a){v=a.OSDSysAbnormal&&a.OSDSysAbnormal.Support,x.rowHeight=a.OSDLineSpacing&&a.OSDLineSpacing.Support,v&&B.$('[data-for="osd_abnormal"]').removeClass("fn-hide"),x.rowHeight&&(B.$('[data-for="osd_fontSetting"]').removeClass("fn-hide"),B.$("#osd_fontsHeight").removeClass("fn-hide"))}),a.when(i.get("IVSCaps"),i.is("DSPConflict")).then(function(b,c){w=webApp.IsIPCIntel&&b&&-1!==a.inArray("NumberStat",b.SupportedScene),!c&&w&&B.$('[data-for="osd_flowrate"]').removeClass("fn-hide")}),webApp.DeviceType.indexOf("SD")>-1?(B.$('[data-for="osd_covers"]').remove(),B.$('[data-page="osd_covers"]').remove(),B.$("#osd_ipc_left_con").addClass("fn-hide"),isEnable("is_show_LocationInfo")||B.$("#osd_location").addClass("fn-hide")):(B.$('[data-for = "osd_osdcombination"] span').attr("t","w_location;title::w_location"),B.$('[data-for = "osd_osdcombination"]').attr("isLocaltion","true").translation(),(!isEnable("is_show_location")||isEnable("is_8M_Flash"))&&B.$('[data-for = "osd_osdcombination"]').addClass("fn-hide")),isEnable("is_8M_Flash")&&(B.$('[data-for = "osd_fontSetting"]').addClass("fn-hide"),B.$('[data-for = "osd_image"]').addClass("fn-hide")),i.get("IsGpsInfoOsd").done(function(a){a&&B.$('[data-for = "osd_GPS"]').removeClass("fn-hide")}),i.get("PTZCaps",!0).done(function(a){a&&(p.PrivacyMasking=a.PrivacyMasking&&a.PrivacyMasking.Support,p.PtzPatternOSD=!!a.SupportPtzPatternOSD,p.PtzRS485DetectOSD=!!a.SupportPtzRS485DetectOSD,p.Zoom=!(a.Zoom===!1),p.Focus=!(a.Focus===!1),p.Iris=!(a.Iris===!1),B.$("#osd_PTZPattern").toggleClass("fn-hide",!p.PtzPatternOSD),B.$("#osd_PTZRS485").toggleClass("fn-hide",!p.PtzRS485DetectOSD),B.$("#osd_zoom_wrap").toggleClass("fn-hide",!p.Zoom),B.$("#osd_focus_wrap").toggleClass("fn-hide",!p.Zoom),B.$("#osd_iris_wrap").toggleClass("fn-hide",!p.Iris),B.$('[data-for = "osd_privateMask"]').toggleClass("fn-hide",!p.PrivacyMasking&&login.chkAuthority("MPTZ")),a.SDMeasureDistance&&a.SDMeasureDistance.Support&&(B.$('[data-for = "osd_SDMeasureDistance"]').removeClass("fn-hide"),r=a.SDMeasureDistance))}).always(function(){B.$('[data-for = "osd_privateMask"]').hasClass("fn-hide")&&(B.$('[data-for = "osd_privateMask"]').remove(),B.$('[data-page="osd_privateMask"]').remove()),require.async("jsCore/pageTab",function(a){B.$("#osd_content").data("osdTab",new a({element:B.$("#osd_content")}))}),B.render()}),webApp.GongAnDetect&&a("#font_size_largest").show(),B.bind()},bind:function(){B.$("#osd_sd_boatX").children("div[class^=ui-boat-box]").mouseover(function(b){var c=a(b.target).attr("data-for");c&&B.$("#osd_sd_boatX").removeClass().addClass("ui-boat-current ui-boat-current-"+c.toLowerCase())}),B.$("#osd_sd_boatX").mouseout(function(){a(this).removeClass().addClass("ui-boat-current")}),B.$("#osd_sd_boatX div, #osd_sd_zoomfucusiris_wrap .ptzcontrol").mousedown(function(){var b=a(this).attr("data-for");if(b){var c=B.$("#osd_sd_footStep").val()-0;h.PTZ.start(b,c,0,0)}plugin.SetRegionNum(0).done(function(){B.$("#video_privmask_draw").removeClass("ui-button-special-hover")})}).mouseup(function(){var b=a(this).attr("data-for");if(b){var c=B.$("#osd_sd_footStep").val()-0;h.PTZ.stop(b,c,0,0)}}).mouseout(function(){var b=a(this).attr("data-for");if(b){var c=B.$("#osd_sd_footStep").val()-0;h.PTZ.stop(b,c,0,0)}})},render:function(){D=!0,plugin.cover("#video_OSD_node",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(1),plugin.open(),a&&B.$("#video_OSD_refresh").click()});var b=i.get("PTZCaps",!0).done(function(a){a&&(p.PrivacyMasking=a.PrivacyMasking&&a.PrivacyMasking.Support,p.PTZZoom=!!a.SupportPTZZoom,p.Coordinates=!!a.SupportPTZCoordinates,p.DirectionDisplay=!!a.DirectionDisplay,p.PtzPatternOSD=!!a.SupportPtzPatternOSD,p.PtzRS485DetectOSD=!!a.SupportPtzRS485DetectOSD,p.Zoom=!(a.Zoom===!1),p.Focus=!(a.Focus===!1),p.Iris=!(a.Iris===!1))}),c=h.ConfigManager.getConfig(["VideoWidget","ChannelTitle","VideoWidgetNumberStat","OSDSysAbnormal","VideoWidget2","SDMeasureDistance"]).done(function(a){k=a[0].params.table,m=a[1].params.table,a[2].result&&(n=a[2].params.table),a[3].result&&(o=a[3].params.table),a[4].result&&(l=a[4].params.table),a[5].result&&(q=a[5].params.table)});a.when(b,c,i.get("OSDCustom")).done(function(){D&&(B._displayByPTZCaps(),B.$("#osd_content").data("osdTab").render())})},leave:function(){D=!1,plugin.hide(),plugin.SetRegionNum(0)},_displayByPTZCaps:function(){B.$("#osd_coordinates").toggleClass("fn-hide",!p.Coordinates),B.$("#osd_PTZZoom").toggleClass("fn-hide",!p.PTZZoom),B.$("#osd_direction").toggleClass("fn-hide",!p.DirectionDisplay)},onSave:function(){B.$("#osd_content").data("osdTab").current.save();var a=["ChannelTitle","VideoWidget"],b=[m,k];w&&(a.push("VideoWidgetNumberStat"),b.push(n)),x.rowHeight&&(a.push("VideoWidget2"),b.push(l)),v&&(a.push("OSDSysAbnormal"),b.push(o)),r&&r.Support&&(a.push("SDMeasureDistance"),b.push(q)),h.ConfigManager.setConfig(a,b).done(function(a){j.chkMutilCallRet(a)?B.$(".u-tip:first").tip("success",tl("Succeed in saving configure")):B.$(".u-tip:first").tip("error",tl("Saving failure"))})},onRefresh:function(){h.ConfigManager.getConfig(["VideoWidget","ChannelTitle","VideoWidgetNumberStat","OSDSysAbnormal","VideoWidget2","SDMeasureDistance"]).done(function(a){k=a[0].params.table,m=a[1].params.table,a[2].result&&(n=a[2].params.table),a[3].result&&(o=a[3].params.table),a[4].result&&(l=a[4].params.table),a[5].result&&(q=a[5].params.table),B.$("#osd_content").data("osdTab").render(),B.$(".u-tip:first").tip("success",tl("Operateingsuccess"))}).fail(function(){B.$(".u-tip:first").tip("error",tl("Operateingfailure"))})},onDefault:function(){h.ConfigManager.getDefault(["VideoWidget","ChannelTitle","VideoWidgetNumberStat","OSDSysAbnormal","VideoWidget2","SDMeasureDistance"]).done(function(a){k=a[0].params.table,m=a[1].params.table,a[2].result&&(n=a[2].params.table),a[3].result&&(o=a[3].params.table),a[4].result&&(l=a[4].params.table),a[5].result&&(q=a[5].params.table),B.$("#osd_content").data("osdTab").render(),B.$(".u-tip:first").tip("success",tl("Defaultsuccess"))
}).fail(function(){B.$(".u-tip:first").tip("error",tl("Defaultfailure"))})}}),define("osd_covers",function(require,b,c){var d=null;c.exports=g.extend({init:function(){d=this,a("#page_encodeConfig #OSD_delete_all_covers").click(function(){d._clearCover()}),a("#page_encodeConfig #OSD_delete_selected_cover").click(function(){d._delCover()}),d.render()},render:function(){var b=k[C]&&k[C].Covers||[];a("#page_encodeConfig #osd_ipc_left_con").removeClass("fn-hide"),plugin.addEvent("RegionChanged",function(a,c,d,e,f){var g=getDefaultRect(c,d,e,f);g[0]==g[2]||g[1]==g[3]?b[a].Rect=[0,0,0,0]:(b[a]||(b[a]={BackColor:[0,0,0,128],EncodeBlend:!1,FrontColor:[255,255,255,0],PreviewBlend:!1,Rect:[0,0,0,0]}),b[a].Rect=g)}),b[0]&&b[0].EncodeBlend?d.$("#osd_covers_enable_on").prop("checked",!0):d.$("#osd_covers_enable_off").prop("checked",!0),plugin.SetRegionNum(0),plugin.SetRegionNum(-4),webApp.GongAnDetect&&plugin.SetRegionNum(-8),a.each(b,function(a,b){var c=b.Rect[0],d=b.Rect[1],e=b.Rect[2],f=b.Rect[3];c!=e&&d!=f&&plugin.SetSelRegionByIndex(a,c,d,e,f)})},leave:function(){a("#page_encodeConfig #osd_ipc_left_con").addClass("fn-hide"),plugin.addEvent("RegionChanged",null),d.save()},save:function(){var b=d.$("#osd_covers_enable_on").prop("checked");a.each(k[C].Covers,function(a,c){c.EncodeBlend=b})},_clearCover:function(){plugin.DelSelReg(-2),a.each(k[C].Covers,function(a,b){b.Rect=[0,0,0,0]})},_delCover:function(){plugin.DelSelReg(-1)}})}),define("osd_privateMask",function(require,b,c){var d=null,e=0,f=null;c.exports=g.extend({init:function(){d=this,i.get("PTZCaps").done(function(a){var b=a&&a.PrivacyMasking;b&&(b.SetColorSupport&&d.initColor(b.SetColorSupport,b.SetColorIndependent),b.SupportType&&d.initShape(b.SupportType),b.SetMosaicSupport&&d.initMosaic(b.SetMosaicSupport,b.SupportMosaicType)),d.render()}),d.$("#osd_pr_color span").on("click",function(){d.$(".border-white").removeClass("border-white"),a(this).addClass("border-white")})},render:function(){plugin.SetRegionNum(0),"New"==d.ocxEntry?plugin.addEvent("VideoAnalyzeConfig",function(a){config=JSON.decode(a);var b=config.EventParam.ShapeState;b&&3==b&&d._ocxEventDone(config.EventParam.ShapeID)}):plugin.addEvent("RegionChanged",function(a,b,c,e,f){d.onOcxDrawRegion(b,c,e,f)}),a("#osd_sd_save_el").addClass("fn-hide"),a("#osd_sd_left_con").removeClass("fn-hide"),d.getPrivacyMaskingList(),d.switchOcxPrivacyMasking(!1)},leave:function(){d._ocxEnale(!1),plugin.addEvent("VideoAnalyzeConfig",null),plugin.addEvent("RegionChanged",null),a("#osd_sd_save_el").removeClass("fn-hide"),a("#osd_sd_left_con").addClass("fn-hide")},renderMaskList:function(){var b=a("#video_privmask_number"),c="";a.each(privacyMasking,function(a,b){c+="<option value="+a+' class="'+(b.Enable?"":"fn-gray")+'">'+(a+1)+"</option>"}),b.html(c),b.val(e)},onChangeMask:function(){d.switchOcxPrivacyMasking(!1),a("#video_privmask_draw").removeClass("ui-button-special-hover"),e=a("#video_privmask_number").val(),d.MosaicSupport&&(a("#osd_pr_Mosaic").val(privacyMasking[e].Mosaic||0),d.onMosaicChange())},onShapeChange:function(){d._ocxClear()},_getOcxData:function(a){if(a.Polygon)privacyMasking[e].ShapType="Polygon",privacyMasking[e].Polygon=a.Polygon;else{privacyMasking[e].ShapType="Rect";var b=a.Rect;privacyMasking[e].Rect=[b[0][0],b[0][1],b[1][0],b[1][1]]}d._saveData()},_saveData:function(){f.done(function(a){privacyMasking[e].Postion=a.Postion}),d.setMaskColor(),d.MosaicSupport&&(privacyMasking[e].Mosaic=a("#osd_pr_Mosaic").val()-0),setTimeout(d._ocxClear,500),d.savePrivMaskConfig(!0),d.renderMaskList()},initColor:function(b,c){1==b&&(d.colorSupport=!0,a("#osd_pr_colorWrap").removeClass("fn-hide"),1==c?d.colorIndependent=!0:a("#osd_pr_colorWrap").insertBefore("#osd_pr_number_wrap"))},setMaskColor:function(){if(1==d.colorSupport){var b=d.$(".border-white").attr("data-color"),c=d.getColorRGB(b);d.colorIndependent?privacyMasking[e].Color=c:a.each(privacyMasking,function(a,b){b.Enable&&(b.Color=c)})}},getColorRGB:function(a){var b={red:[255,0,0,255],orange:[255,150,0,255],yellow:[255,255,0,255],green:[93,214,33,255],blueGreen:[25,233,233,255],blue:[0,60,255,255],purple:[200,0,255,255],black:[0,0,0,255]};return b[a]},initShape:function(b){if(-1!==a.inArray("Polygon",b)){d.ocxEntry="New";for(var c="",e=0;e<b.length;e++)switch(b[e]){case"Rect":c+='<option t="rectangle" value="Rect">'+tl("rectangle")+"</option>";break;case"Polygon":c+='<option t="polygon" value="Polygon">'+tl("polygon")+"</option>";break;default:c+='<option t="Unknown" value="'+b[e]+'">'+tl("Unknown")+"</option>"}a("#osd_pr_ShapType").html(c),a("#osd_pr_shapeWrap").removeClass("fn-hide")}},initMosaic:function(b,c){if(1==b){d.MosaicSupport=!0,d.MosaicSupportType=c||[24];for(var e='<option value="0" t="colorLunp">'+tl("colorLunp")+"</option>",f=0;f<d.MosaicSupportType.length;f++){var g=d.MosaicSupportType[f],h="mosaic+("+g+"x"+g+")";e+='<option value="'+g+'" t="'+h+'"></option>'}a("#osd_pr_Mosaic").html(e).translation(),a("#osd_pr_mosWrap").removeClass("fn-hide")}},onMosaicChange:function(){a("#osd_pr_Mosaic").val()-0!==0?a("#osd_pr_colorWrap").addClass("fn-hide"):d.colorSupport&&a("#osd_pr_colorWrap").removeClass("fn-hide")},onDrawClick:function(){a("#video_privmask_draw").hasClass("ui-button-special-hover")?d.switchOcxPrivacyMasking(!1):(privacyMasking[e].Enable=!0,d.switchOcxPrivacyMasking(!0),f=h.PTZ.getStatus().fail(function(){d.tip("error","Operateingfailure")}))},onDelClick:function(){d.switchOcxPrivacyMasking(!1),privacyMasking[e].Enable=!1,privacyMasking[e].Rect=[0,0,0,0],privacyMasking[e].Polygon=[],d.savePrivMaskConfig(!0),d.renderMaskList()},onCleanClick:function(){plugin.hide(),a.confirm(tl("Ok"),tl("w_clearPrivacyMaskConfirm"),function(){d.switchOcxPrivacyMasking(!1);for(var a=0;a<privacyMasking.length;a++)privacyMasking[a].Enable=!1,privacyMasking[a].Rect=[0,0,0,0],privacyMasking[a].Polygon=[];d.savePrivMaskConfig(!0),d.renderMaskList(),plugin.cover("#video_OSD_node")},function(){plugin.cover("#video_OSD_node")})},onGotoClick:function(){if(privacyMasking[e].Enable){var a=privacyMasking[e].Postion;h.PTZ.moveAbsolutely(a,null)}},onOcxDrawRegion:function(a,b,c,f){(0!=a||0!=b||0!=f||0!=c)&&(privacyMasking[e].Rect=[a,b,c,f],d._saveData())},savePrivMaskConfig:function(a){h.ConfigManager.setConfig("PrivacyMasking",[privacyMasking]).done(function(){a&&d.tip("success","Operateingsuccess")}).fail(function(){d.tip("error","Operateingfailure")})},getPrivacyMaskingList:function(){h.ConfigManager.getConfig("PrivacyMasking").done(function(a){privacyMasking=a[0],d.renderMaskList()}).fail(function(){d.tip("error","Operateingfailure")})},_ocxEnale:function(a){"New"==d.ocxEntry?plugin.EnableVideoAnalyseModule(a):plugin.SetRegionNum(0==a?0:1)},_ocxCreateMainVideoAnalyseShape:function(b){if("New"==d.ocxEntry){var c=a("#osd_pr_ShapType").val();d.shapeID=plugin.CreateMainVideoAnalyseShape(0,"PrivacyMask",c,c,"","Convex")}else plugin.SetRegionNum(1==b?1:0)},_ocxClear:function(){"New"==d.ocxEntry?(plugin.DeleteAllVideoAnalyseShape(),d._ocxCreateMainVideoAnalyseShape()):(plugin.SetRegionNum(0),plugin.SetRegionNum(1))},_ocxGetDate:function(a){return plugin.GetVideoAnalyseShapeConfigData(a)},_ocxEventDone:function(a){d.shapeID=a,d._ocxGetDate(a).done(function(a){var b=JSON.decode(a);d._getOcxData(b)})},switchOcxPrivacyMasking:function(b){d._ocxEnale(b),d._ocxCreateMainVideoAnalyseShape(b),b?a("#video_privmask_draw").addClass("ui-button-special-hover"):a("#video_privmask_draw").removeClass("ui-button-special-hover")}})}),define("osd_channel",function(require,a,b){var c=null;b.exports=g.extend({init:function(){c=this,c.$("#osd_channel_title").textfield({validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}),f(c.$("#osd_channel_title"),{maxByte:63,asciiByte:2,notAsciiByte:3}),c.render()},render:function(){if(k[C]){var a=k[C].ChannelTitle||{};plugin.addEvent("RegionChanged",function(b,c,d,e,f){var g=getDefaultRect(c,d,e,f);a.Rect=g}),a.EncodeBlend?c.$("#osd_channel_enable_on").prop("checked",!0):c.$("#osd_channel_enable_off").prop("checked",!0),c.$("#osd_channel_title").textfield("value",m[C].Name||""),d(a.Rect,tl("w_ChannelTitle"),100,20)}},leave:function(){plugin.addEvent("RegionChanged",null),c.save()},save:function(){k[C].ChannelTitle.EncodeBlend=c.$("#osd_channel_enable_on").prop("checked"),m[C].Name=c.$("#osd_channel_title").textfield("value")}})}),define("osd_time",function(require,a,b){var c=null;b.exports=g.extend({init:function(){c=this,c.render()},render:function(){var a=k[C].TimeTitle||{};plugin.addEvent("RegionChanged",function(b,c,d,e,f){var g=getDefaultRect(c,d,e,f);a.Rect=g}),a.EncodeBlend?c.$("#osd_time_enable_on").prop("checked",!0):c.$("#osd_time_enable_off").prop("checked",!0),c.$("#osd_time_show_week").prop("checked",a.ShowWeek),d(a.Rect,tl("w_TimeTitle"),160,20)},leave:function(){plugin.addEvent("RegionChanged",null),c.save()},save:function(){k[C].TimeTitle.EncodeBlend=c.$("#osd_time_enable_on").prop("checked"),k[C].TimeTitle.ShowWeek=c.$("#osd_time_show_week").prop("checked")}})}),define("osd_osdcombination",function(require,b,c){var e=this,j=!1;c.exports=g.extend({init:function(){j=!!a('[data-for = "osd_osdcombination"]').attr("isLocaltion"),e=this,e.bind(),i.get("OSDCustom").done(function(b){var c=5;b&&b.Geography&&b.Geography.Support&&(c=b.Geography.TitleLine),webApp.GongAnDetect&&(c=8),e.$("#osd_location_info").empty();for(var d=0;c>d;d++)a('<input type="text" class="ui-input fn-marb1" id="osd_location_info_'+d+'"/>').textfield({validReg:/^[^'"\|\&]+$/,errorHandle:"prevent"}).appendTo(e.$("#osd_location_info"));f(e.$("#osd_location_info input"),{maxByte:45,asciiByte:2,notAsciiByte:3}),e.render()}),j&&e.$('[t="w_location;title::w_location"]').addClass("fn-hide")},bind:function(){e.$('[type ="radio"]').click(function(){if("on"==a(this).val()&&k[C].PictureTitle.EncodeBlend){var b=a(this).attr("id"),c=b.replace("_on","_off");plugin.hide();var d=tl("w_osd_picture_overlay_will_be_disabled");j&&(d=tl("w_picture_overlay_will_be_disabled")),a.confirm(tl("Ok"),d,function(){a("#page_encodeConfig #osd_image_enable_off").prop("checked",!0),k[C].PictureTitle.EncodeBlend=!1,e.$("#"+b).prop("checked",!0),plugin.cover("#video_OSD_node")},function(){e.$("#"+c).prop("checked",!0),plugin.cover("#video_OSD_node")})}}),e.$('[name="osd_temperature_enable"]').click(function(){"on"==a(this).val()?e.$("#osd_TempUnit_wrap").removeClass("fn-hide"):e.$("#osd_TempUnit_wrap").addClass("fn-hide")}),e.$('[name = "osd_direction_enable"]').unbind().click(function(){"on"==a(this).val()?k[C].PictureTitle.EncodeBlend?(plugin.hide(),a.confirm(tl("Ok"),tl("w_osd_picture_overlay_will_be_disabled"),function(){e.$("#dirSetting").removeClass("fn-hide"),a("#page_encodeConfig #osd_sd_left_con").removeClass("fn-hide"),a("#page_encodeConfig #osd_image_enable_off").prop("checked",!0),k[C].PictureTitle.EncodeBlend=!1,e.$("#osd_direction_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node")},function(){plugin.cover("#video_OSD_node"),e.$("#osd_direction_enable_off").prop("checked",!0)})):(e.$("#dirSetting").removeClass("fn-hide"),a("#page_encodeConfig #osd_sd_left_con").removeClass("fn-hide")):(e.$("#dirSetting").addClass("fn-hide"),a("#page_encodeConfig #osd_sd_left_con").addClass("fn-hide"))}),e.$("#osd_dirSetting_btn").click(e._setNorth)},render:function(){plugin.addEvent("RegionChanged",function(b,c,d,e,f){var g=getDefaultRect(c,d,e,f);if(j)k[C].CustomTitle[1].Rect=g;else{var h=a.extend([],g),i=a.extend([],g),l=a.extend([],g),m=550,n=(20*z).round();h[3]=g[1]+n,i[1]=g[1]+m,i[3]=g[1]+m+n,isEnable("is_show_LocationInfo")&&(l[1]=g[1]+2*m),s&&(k[C].PTZPreset.Rect=h),t&&(k[C].Temperature.Rect=i),p.Coordinates&&(k[C].PTZCoordinates.Rect=i),p.PTZZoom&&(k[C].PTZZoom.Rect=i),p.DirectionDisplay&&(k[C].PTZDirection.Rect=i),k[C].CustomTitle[1].Rect=l}});var b=k[C].CustomTitle[1]||{};b.EncodeBlend?e.$("#osd_location_enable_on").prop("checked",!0):e.$("#osd_location_enable_off").prop("checked",!0),e._setLocationInfo(b.Text||""),e.$("#osd_location_textalign").val("TextAlign"in b?b.TextAlign:2);var c=k[C].PTZPreset||{};c.EncodeBlend?e.$("#osd_preset_enable_on").prop("checked",!0):e.$("#osd_preset_enable_off").prop("checked",!0);var f=k[C].Temperature||{};f.EncodeBlend?(e.$("#osd_temperature_enable_on").prop("checked",!0),e.$("#osd_TempUnit_wrap").removeClass("fn-hide")):(e.$("#osd_temperature_enable_off").prop("checked",!0),e.$("#osd_TempUnit_wrap").addClass("fn-hide")),u&&e.$("#osd_TempUnit").val(f.TemperatureUnit);var g=k[C].PTZCoordinates||{};g.EncodeBlend?e.$("#osd_coordinates_enable_on").prop("checked",!0):e.$("#osd_coordinates_enable_off").prop("checked",!0);var h=k[C].PTZZoom||{};h.EncodeBlend?e.$("#osd_PTZZoom_enable_on").prop("checked",!0):e.$("#osd_PTZZoom_enable_off").prop("checked",!0);var i=k[C].PTZDirection||{};i.EncodeBlend?(e.$("#osd_direction_enable_on").prop("checked",!0),e.$("#dirSetting").removeClass("fn-hide"),a("#page_encodeConfig #osd_sd_left_con").removeClass("fn-hide")):(e.$("#osd_direction_enable_off").prop("checked",!0),e.$("#dirSetting").addClass("fn-hide"));var l=k[C].PtzPattern||{};l.EncodeBlend?e.$("#osd_PTZPattern_enable_on").prop("checked",!0):e.$("#osd_PTZPattern_enable_off").prop("checked",!0);var m=k[C].PtzRS485Detect||{};m.EncodeBlend?e.$("#osd_PTZRS485_enable_on").prop("checked",!0):e.$("#osd_PTZRS485_enable_off").prop("checked",!0);var n,o=200,q="w_osdcombination";j?(n=(k[C].CustomTitle[1]||{}).Rect,o=20,q="w_location"):n=(k[C].PTZPreset||{}).Rect,d(n,tl(q),160,o)},leave:function(){e.save(),a("#page_encodeConfig #osd_sd_left_con").addClass("fn-hide"),plugin.addEvent("RegionChanged",null)},save:function(){k[C].CustomTitle[1].Text=e._getLocationInfo(),k[C].CustomTitle[1].EncodeBlend=e.$("#osd_location_enable_on").prop("checked"),k[C].CustomTitle[1].PreviewBlend=e.$("#osd_location_enable_on").prop("checked"),k[C].CustomTitle[1].BackColor=[0,0,0,128],k[C].CustomTitle[1].TextAlign=e.$("#osd_location_textalign").val()-0,s&&(k[C].PTZPreset.EncodeBlend=e.$("#osd_preset_enable_on").prop("checked")),t&&(k[C].Temperature.EncodeBlend=e.$("#osd_temperature_enable_on").prop("checked"),u&&(k[C].Temperature.TemperatureUnit=e.$("#osd_TempUnit").val())),p.Coordinates&&(k[C].PTZCoordinates.EncodeBlend=e.$("#osd_coordinates_enable_on").prop("checked")),p.PTZZoom&&(k[C].PTZZoom.EncodeBlend=e.$("#osd_PTZZoom_enable_on").prop("checked")),p.DirectionDisplay&&(k[C].PTZDirection.EncodeBlend=e.$("#osd_direction_enable_on").prop("checked")),p.PtzPatternOSD&&(k[C].PtzPattern.EncodeBlend=e.$("#osd_PTZPattern_enable_on").prop("checked")),p.PtzRS485DetectOSD&&(k[C].PtzRS485Detect.EncodeBlend=e.$("#osd_PTZRS485_enable_on").prop("checked"))},_getLocationInfo:function(){var b=[];return e.$('[id ^="osd_location_info_"]').each(function(c,d){b.push(a(d).val())}),b.join("|")},_setLocationInfo:function(b){if(""==b)e.$('[id ^="osd_location_info_"]').each(function(b,c){a(c).val("")});else{var c=b.split("|");a.each(c,function(a,b){e.$("#osd_location_info_"+a).val(b)})}},_setNorth:function(){h.PTZ.setDirection("North").done(function(){a('#page_encodeConfig [data-page="enc_osd"]').children(".u-tip").tip("success","Succeed in saving configure")})}})}),define("osd_fontSetting",function(require,b,c){var d=null,f=null,h="ffffff",j=null;c.exports=g.extend({init:function(){j=this,require.async("jsCore/modules/jscolor",function(){jscolor.init(),d=j.$('[data-pick="jsColor"]')[0],j.bind(),f=new jscolor.color(d,{positionID:"fontAll",positionNew:{left:"0px",top:"42px"},pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight",pickerFaceColor:"#C0C0C0",pickerBorderColor:"ThreeDHighlight ThreeDShadow #C0C0C0 ThreeDHighlight"}),j.render()})},bind:function(){j.$("#fontAll").delegate("[data-show]","click",function(){var b=a(this).attr("data-show"),c=j.$("[data-name ="+b+"]");if(!c.hasClass("fn-hide"))return j._changeArrow("up"),void c.addClass("fn-hide");switch(j._changeArrow("down"),c.removeClass("fn-hide"),b){case"pick1":j._hidePick2();break;case"pick2":j._hidePick1(!1),j._setPickColorStr(h),d.value=h,d.focus()}}),j.$("#fontAll").delegate("[data-hide]","click",function(){j._hidePick1();var b=a(this).attr("data-value");j._renderDom(b)}),j.$("#fontAll").delegate("[data-btn]","click",function(){var b=a(this).attr("data-btn");if("ok"==b){var c=d.value;j._renderDom(c)}j._hidePick2(),j._hidePick1()}),a("#page_encodeConfig").click(function(b){var c=a('div[data-name="pick1"]').hasClass("fn-hide");c||b.target.hasClass("showPick1")||j._hidePick1()})},render:function(){if(plugin.SetRegionNum(0),void 0!==k[C].FontSizeScale)switch(k[C].FontSizeScale){case.7:j.$("#fontSizeSmall").prop("checked",!0);break;case 1.1:case 1.2:j.$("#fontSizeLarge").prop("checked",!0);break;case 1.3:j.$("#fontSizeLargest").prop("checked",!0);break;default:j.$("#fontSizeMiddle").prop("checked",!0)}j.$("#osd_fontSize").val(k[C].FontSize),j.$("#osd_FontBorder").prop("checked",k[C].FontBorder),x.rowHeight&&j.$("#osd_fontHeight").val(l[C].OSDLineSpacing);var a=k[C].ChannelTitle.FrontColor,b=j._getColorStr(a);j._renderDom(b),j._hidePick1(),j._hidePick2()},leave:function(){j.save()},save:function(){if(x.color){var b=j._getColor();e(b)}x.grade&&i.get("FontSize").done(function(b){var c=[.7,1,1.1],d=j.$('[name="font-size"]:checked').val()-0;b&&b.GradeRange?a.each(c,function(a){c[a]===d&&(k[C].FontSizeScale=b.GradeRange[a])}):k[C].FontSizeScale=d}),x.pixel&&(k[C].FontSize=j.$("#osd_fontSize").val()-0),x.border&&(k[C].FontBorder=j.$("#osd_FontBorder").prop("checked")),x.rowHeight&&(l[C].OSDLineSpacing=j.$("#osd_fontHeight").val()-0)},_getColorStr:function(a){var b="",c=parseInt(a[0]).toString(16).toUpperCase(),d=parseInt(a[1]).toString(16).toUpperCase(),e=parseInt(a[2]).toString(16).toUpperCase();return 1==c.length&&(c="0"+c),1==d.length&&(d="0"+d),1==e.length&&(e="0"+e),b=c+d+e},_changeArrow:function(a){var b=j.$('span[data-arrow="fontColor"]');switch(a){case"up":b.removeClass("triangleUp"),b.addClass("triangleDown");break;case"down":b.removeClass("triangleDown"),b.addClass("triangleUp")}},_hidePick1:function(a){$$('div[data-name="pick1"]').addClass("fn-hide"),a!==!1&&j._changeArrow("up")},_hidePick2:function(){f.hidePicker(),a('div[data-name="pick2"]').addClass("fn-hide")},_setPickColorStr:function(a){f.fromString(a,!0)},_renderDom:function(b){h=b,a('span[data-name="text"]').css({"border-bottom":"2px solid #"+b,color:"#"+b}),fontColor=j._getColor()},_getColor:function(){return j._getColorRGB(h)},_getColorRGB:function(a){var b=[],c="0x"+a;return b[0]=c>>16&255,b[1]=c>>8&255,b[2]=255&c,b[3]=0,b}})}),define("osd_image",function(require,b,c){var e=null,f=null,i={"File Transmit Error":"w_File Transmit Error","File too large":"w_PicFileTooLarge","File length error":"w_File length error","File write error":"w_File write error",PicTypeNotSupport:"w_PicTypeNotSupport",BPPTypeNotSupport:"w_BPPTypeNotSupport",ResolutionNotSupport:"w_ResolutionNotSupport",PicNotExist:"w_PicNotExist",FileOperateError:"w_FileOperateError",PicFileTooLarge:"w_PicFileTooLarge"};c.exports=g.extend({init:function(){e=this,f=a("#enc_osd_tip"),e.render(),e.$('[name = "osd_image_enable"]').click(function(){if("on"==a(this).val())if(webApp.DeviceType.indexOf("SD")>-1){var b=e._getOSDInfo();b&&(plugin.hide(),a.confirm(tl("Ok"),tl("w_osd_location_function_will_be_disabled"),function(){a('#osd_osdcombination [type="radio"][value="on"]').prop("checked",!1),e.$("#osd_image_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),k[C].CustomTitle[1].EncodeBlend=!1,k[C].CustomTitle[1].PreviewBlend=!1,s&&(k[C].PTZPreset.EncodeBlend=!1),t&&(k[C].Temperature.EncodeBlend=!1),p.Coordinates&&(k[C].PTZCoordinates.EncodeBlend=!1),p.PTZZoom&&(k[C].PTZZoom.EncodeBlend=!1),p.DirectionDisplay&&(k[C].PTZDirection.EncodeBlend=!1),p.PtzPatternOSD&&(k[C].PtzPattern.EncodeBlend=!1),p.PtzRS485DetectOSD&&(k[C].PtzRS485Detect.EncodeBlend=!1)},function(){plugin.cover("#video_OSD_node"),e.$("#osd_image_enable_off").prop("checked",!0)}))}else k[C].CustomTitle[1].EncodeBlend&&(plugin.hide(),a.confirm(tl("Ok"),tl("w_location_function_will_be_disabled"),function(){a("#osd_location_enable_off").prop("checked",!0),e.$("#osd_image_enable_on").prop("checked",!0),plugin.cover("#video_OSD_node"),k[C].CustomTitle[1].EncodeBlend=!1,k[C].CustomTitle[1].PreviewBlend=!1},function(){plugin.cover("#video_OSD_node"),e.$("#osd_image_enable_off").prop("checked",!0)}))})},render:function(){plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e);k[C].PictureTitle.Rect=f});var b=k[C].PictureTitle||{};if(b.EncodeBlend?e.$("#osd_image_enable_on").prop("checked",!0):e.$("#osd_image_enable_off").prop("checked",!0),b.Name){var c="url("+A+b.Name+"?"+Date.now()+")";a(".osd-image-preview").css("background-image",c)}e._getImgRect()},_getImgRect:function(){var a=k[C].PictureTitle,b=a.Width||80,c=a.Height||80,e={x:Video.resolution.x,y:Video.resolution.y},b=(e.x/1920*b).ceil(),c=(e.y/1080*c).ceil();b=(8*b+7)/8,b=b%32?32-b%32+b:b,c=c%4?4-c%4+c:c,b=(500/e.x*b).ceil()+2,c=(374/e.y*c).ceil()+2,b=Math.max(b,16),c=Math.max(c,16),d(a.Rect||[0,0,0,0],"",b,c)},leave:function(){e.save(),plugin.addEvent("RegionChanged",null)},save:function(){k[C].PictureTitle.EncodeBlend=e.$("#osd_image_enable_on").prop("checked")},imageFileUploadFinish:function(a){a.result?e.updateOverlayPicture():f.tip("warning",tl(i[a.errorCode]))},updateOverlayPicture:function(){h.Encode.updateOverlayPicture([{Name:"osd.bmp"}]).done(function(a){var b=a[0];if(""==b.Error){var c=b.Path.lastIndexOf("/"),d=b.Path.substring(c+1);k[C].PictureTitle.Name=d,k[C].PictureTitle.Width=b.Width,k[C].PictureTitle.Height=b.Height,h.ConfigManager.setConfig("VideoWidget",k).done(function(){var a=k[C].PictureTitle||{};if(a.Name){var b="url("+A+a.Name+"?"+Date.now()+")";e.$(".osd-image-preview").css("background-image",b)}e._getImgRect()}).fail(function(){f.tip("error","Saving failure")})}else f.tip("warning",tl(i[b.Error]))})},onFileChange:function(a){var b=0;if(a.value.test(/.bmp$/i)){try{b=a.files[0].size}catch(c){}b>16384?f.tip("warning",tl("w_PicFileTooLarge")):e.$("#osd_image_submit").trigger("click")}else f.tip("warning",tl("w_PicTypeNotSupport"));a.outerHTML=a.outerHTML},_getOSDInfo:function(){var a={PTZPreset:s,Temperature:t,PTZCoordinates:p.Coordinates,PTZZoom:p.PTZZoom,PTZDirection:p.DirectionDisplay,PtzPattern:p.PtzPatternOSD,PtzRS485Detect:p.PtzRS485DetectOSD};if(k[C].CustomTitle[1].EncodeBlend)return!0;for(var b in a)if(a[b]&&k[C][b].EncodeBlend)return!0;return!1}}),window.OSDImageUploadFinish=function(a){e.imageFileUploadFinish(a)},window.onOSDFileChange=function(a){e.onFileChange(a)}}),define("osd_flowrate",function(require,a,b){var c=null;b.exports=g.extend({init:function(){c=this,c.render()},render:function(){plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e);n[C].Rect=f});var a=n[C]||{};a.EncodeBlend?c.$("#osd_flowrate_enable_on").prop("checked",!0):c.$("#osd_flowrate_enable_off").prop("checked",!0),c.$("#osd_show_enter").prop("checked",a.ShowEnterNum),c.$("#osd_show_exit").prop("checked",a.ShowExitNum),c.$("#osd_flowrate_textalign").val("TextAlign"in a?a.TextAlign:2),d(a.Rect,tl("w_flowrate"),120,20)},leave:function(){c.save(),plugin.addEvent("RegionChanged",null)},save:function(){n[C].EncodeBlend=c.$("#osd_flowrate_enable_on").prop("checked"),n[C].ShowEnterNum=c.$("#osd_show_enter").prop("checked"),n[C].ShowExitNum=c.$("#osd_show_exit").prop("checked"),n[C].TextAlign=c.$("#osd_flowrate_textalign").val()-0}})}),define("osd_abnormal",function(require,a,b){var c=null;b.exports=g.extend({init:function(){c=this,c.render()},render:function(){plugin.addEvent("RegionChanged",function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e);o.Rect=f}),o.EncodeBlend?c.$("#osd_abnormal_enable_on").prop("checked",!0):c.$("#osd_abnormal_enable_off").prop("checked",!0),d(o.Rect,tl("OSDSysAbnormal"),100,20)},leave:function(){c.save(),plugin.addEvent("RegionChanged",null)},save:function(){o.EncodeBlend=c.$("#osd_abnormal_enable_on").prop("checked")}})}),define("osd_GPS",function(require,a,b){var c=null;b.exports=g.extend({init:function(){c=this,c.render()},render:function(){plugin.SetRegionNum(0);var a=k[C].GPSTitle||{};a.EncodeBlend?c.$("#osd_GPS_enable_on").prop("checked",!0):c.$("#osd_GPS_enable_off").prop("checked",!0)},leave:function(){c.save()},save:function(){k[C].GPSTitle.EncodeBlend=c.$("#osd_GPS_enable_on").prop("checked")}})}),define("osd_SDMeasureDistance",function(require,a,b){var c,d,e=null;b.exports=g.extend({init:function(){e=this,c=e.$("#osd_sd_height").numberfield({min:0,max:4294967296,allowNegative:!1,allowDecimal:!0,decimalPrecision:1}),d=e.$("#osd_sd_displayDuration").numberfield(),r&&(d=e.$("#osd_sd_displayDuration").numberfield({min:r.DisplayDurationRange[0],max:r.DisplayDurationRange[1],allowNegative:!1,allowDecimal:!1}),e.$("#osd_sd_displayDuration_minTip").text(r.DisplayDurationRange[0]),e.$("#osd_sd_displayDuration_maxTip").text(r.DisplayDurationRange[1])),e.render()},render:function(){var a=(q[C].SDHeight/100).toFixed(1)-0||0,b=q[C].DisplayDuration||2;c.numberfield("value",a),d.numberfield("value",b)},leave:function(){e.save()},save:function(){q[C].SDHeight=parseInt(100*c.numberfield("value")),q[C].DisplayDuration=d.numberfield("value")}})})}),define("enc_inter",function(require,c,d){var e=require("jsCore/pageBase"),f=require("jsCore/rpc"),g=null,h=null,i=0,j=0,k=null;d.exports=e.extend({init:function(){g=this,webApp.CHANNEL_NUMBER>1&&(g.$("#enc_inter_channel").parent().removeClass("fn-hide"),g.$("#enc_inter_channel").parent().next("div").removeClass("fn-hide"),k=a("#enc_inter_channel").iconSelect({channelNumber:webApp.CHANNEL_NUMBER,allEnable:!1,change:function(a,b){j=b.ch,g.openVideo(),g._renderElement()}}),k.iconSelect("index",j)),i=b.MaxROICount,g.$("#inter_clear").on("click",function(){plugin.DelSelReg(-2),h[0].Regions=[]}),g.$("#inter_del").on("click",function(){plugin.DelSelReg(-1)}),g.render()},render:function(){g.openVideo(),plugin.addEvent("RegionChanged",function(a,b,c,d,e){g._postInterWindow(a,b,c,d,e)}),f.ConfigManager.getConfig("VideoEncodeROI").done(function(a){h=a,g._renderElement()})},leave:function(){plugin.addEvent("RegionChanged",null),plugin.SetRegionNum(0),plugin.hide()},openVideo:function(){plugin.cover("#inter_node",function(a){plugin.SetRegionNum(0),plugin.SetModuleMode(1),webApp.DeviceType.contains("TPC")?(plugin.SetVisibleVideoWnd(1,j),login.chkAuthority("Monitor_0"+(j+1))&&plugin.open(plugin.stream,j,1),!login.chkAuthority("Monitor_0"+(j+1))&&plugin.SetVideoWndTip(j,tl("noVideoAuthoity"))):plugin.open(),a&&g._renderElement()})},_renderElement:function(){var a=h[j];a.Main?g.$("#inter_enable_on").prop("checked",!0):g.$("#inter_enable_off").prop("checked",!0),g.$("#inter_ImgQuality").val(a.Quality),g._areaCoverInter()},_areaCoverInter:function(){var a=[];plugin.SetRegionNum(i),h[j].Regions?a=h[j].Regions:h[j].Regions=[];for(var b=a.length,c=0;b>c;c++){var d=a[c][0],e=a[c][1],f=a[c][2],g=a[c][3];d!=f&&e!=g&&plugin.SetSelRegionByIndex(c,d,e,f,g)}},_postInterWindow:function(a,b,c,d,e){var f=getDefaultRect(b,c,d,e),b=f[0],c=f[1],d=f[2],e=f[3],g=h[j].Regions;g[a]=[b,c,d,e],(d==b||c==e)&&(g[a]=[0,0,0,0])},onDefault:function(){f.ConfigManager.getDefault("VideoEncodeROI").done(function(a){var b=h[j].DynamicTrack;h=a,h[j].DynamicTrack=b,g._renderElement(),g.tip("success","Defaultsuccess")}).fail(function(){g.tip("error","Defaultfailure")})},onRefresh:function(){f.ConfigManager.getConfig("VideoEncodeROI").done(function(a){h=a,g._renderElement(),g.tip("success","Operateingsuccess")}).fail(function(){g.tip("error","Operateingfailure")})},onSave:function(){var a=h[j];a.Main=g.$("#inter_enable_on").prop("checked"),a.Quality=g.$("#inter_ImgQuality").val()-0;for(var b=a.Regions.length;b--;)"0,0,0,0"==a.Regions[b]&&a.Regions.splice(b,1);f.ConfigManager.setConfig("VideoEncodeROI",h).done(function(){g.tip("success","Succeed in saving configure")}).fail(function(){g.tip("error","Saving failure")})}})}),define("enc_path",function(require,b,c){var d=require("jsCore/pageBase"),e=(require("jsCore/rpc"),null),f=["LiveSnapshot","LiveRecord","PlaybackSnapshot","PlaybackRecord","VideoClips"];c.exports=d.extend({init:function(){e=this,webApp.IsLocalStore||e.$(".need-sd-card").addClass("fn-hide"),e.render()},render:function(){a.each(f,function(a,b){plugin.GetConfigPath(b).done(function(a){e.$("#path_"+b).val(a)})})},onChoosePath:function(b){var c=a(b.target).attr("data-target");plugin.ShowFileBrowse().done(function(a){c&&e.$("#path_"+c).val(a)})},onDefault:function(){a.each(f,function(a,b){plugin.GetDefaultConfigPath(b).done(function(a){e.$("#path_"+b).val(a)})}),e.tip("success","Defaultsuccess")},onSave:function(){a.each(f,function(a,b){plugin.SetConfigPath(b,e.$("#path_"+b).val())}),e.tip("success","Succeed in saving configure")}})}),define("enc_encrypt",function(require,b,c){var d=require("jsCore/pageBase"),e=require("jsCore/rpc"),f=require("common/common"),g=f.Check,h=null,i=null,j=0,k=null;c.exports=d.extend({init:function(){h=this,$port1=h.$("#encrypt_port").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),$port2=h.$("#encrypt_port2").numberfield({min:1,max:65535,allowDecimal:!1,allowNegative:!1}),k=a.validator([{element:"#encrypt_serverip",check:function(a){return a?g.ip(a)||g.ipv6(a):!0},errorMsg:[tl("w_server_ip_error")],events:"blur"},{element:"#encrypt_serverip2",check:function(a){return a?g.ip(a)||g.ipv6(a):!0},errorMsg:[tl("w_server_ip_error")],events:"blur"}]),h.render()},render:function(a){e.ConfigManager.getConfig("NetSerEncrypt").done(function(b){i=b,h._renderElement(),a&&h.tip("success","Operateingsuccess")}).fail(function(){h.tip("error","Operateingfailure")})},_renderElement:function(){var a=i[j][0];h.$("#encrypt_deviceid").val(a.NetID),h.$("#encrypt_serverip").val(a.Address),h.$("#encrypt_port").val(a.Port),h.$("#encrypt_serverip2").val(a.BakAddress),h.$("#encrypt_port2").val(a.BakPort),k.validate()},onDefault:function(){e.ConfigManager.getDefault("NetSerEncrypt").done(function(a){i=a,h._renderElement(),h.tip("success","Defaultsuccess")}).fail(function(){h.tip("error","Defaultfailure")})},onRefresh:function(){h.render(!0)},onSave:function(){var a=i[j][0];a.NetID=h.$("#encrypt_deviceid").val(),a.Address=h.$("#encrypt_serverip").val(),a.Port=$port1.numberfield("value"),a.BakAddress=h.$("#encrypt_serverip2").val(),a.BakPort=$port2.numberfield("value"),k.isInvalid()||e.ConfigManager.setConfig("NetSerEncrypt",i).done(function(){var b=a.Address||a.BakAddress,c=(a.Port||a.BakPort)-0;plugin.SetDecodeKeyEx(0,b,c,a.NetID,""),h.tip("success","Succeed in saving configure")}).fail(function(){h.tip("error","Saving failure")})}})})}(jQuery);