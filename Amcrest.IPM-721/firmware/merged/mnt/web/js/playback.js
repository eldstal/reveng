!function(a){var b="EventType",c={A:"#D51111",F:"#00FFF7",M:"#DAE613",R:"#42D017"};define(function(require,d,e){function f(a){var b=a.match(/(\/[^\/]*)/g).pop().slice(1),c=b.substring(0,b.lastIndexOf(".")+1)+G.$("#pla_format input:checked").val();return c}function g(b){var c,d=G.$("#pla_play_tip"),e=G.$("[btn-for=onPlay]");16===b?c="8X":8===b?c="6X":b>1?c=b+"X":b>0&&1>b?c="1/"+1/b+"X":1===b?c="Play":-1===b?c="Pause":(0===b||-2===b)&&(c="Stop",C.timeslider("value",a.pad(K,2)+"000000")),O=b,d.text(tl(c)),e.toggleClass("pause",1===b).attr("title",tl(1===b?"Pause":"Play")),G.disabled("[btn-for=onEnlarge]",0===b||-2===b),G.disabled("[btn-for=onCutRegion]",0===b||-2===b),G.disabled("[btn-for=onSlow],[btn-for=onFast]",-1===b||0===b||-2==b),G.disabled("[btn-for=onNextFrame]",0===b||-2===b)}function h(a){w.DownloadByFile(a,"PlaybackRecord",f(a.FilePath)).done(function(b){b&&(h.flag=a,O=-2,G.disabled('[btn-for="onSearch"],#pla_all,#pla_typechks :checkbox,#pla_format :radio',!0),a.Process=0,B.table("refresh"),w.addEvent("DownloadPos",function(b){a.Process!==b&&(a.Process=b,B.table("refresh")),100===b&&setTimeout(i,1e3)}),w.addEvent("DownLoadError",function(){i(),s(tl("w_noSupportMp4"))}))})}function i(){h.flag&&(w.StopDownload(f(h.flag.FilePath)),O=0,G.disabled('[btn-for="onSearch"],#pla_all,#pla_typechks :checkbox,#pla_format :radio',!1),delete h.flag.Process,B.table("refresh"),w.addEvent("DownloadPos",null),w.addEvent("DownLoadError",null),h.flag=null)}function j(b,c){if(-2===O)return B.table("selectRow",-1),s(tl("w_Can not play record file when download file"));var d=b.StartTime;c&&(d=b.StartTime.split(" ")[0]+" "+c),w.state("partialEnlarged")&&w.state("partialEnlarged",!1),w.PlaybackByFile(b,J,K,d).done(function(c){c?(G.$('[btn-for="onSwitchSound"]').hasClass("play-bottom-iconbg-disabled")||w.PlayOpenSound(J),C.timeslider("value",a.pad(K,2)+d.split(" ")[1].split(":").join("")),g(1),B.find("tbody tr[data-index="+b._index+"]").removeClass("error")):(B.find("tbody tr[data-index="+b._index+"]").addClass("error"),setTimeout(function(){B.table("selectRow",(B.table("getSelectedRow")+1)%N.length)},1e3))})}function k(){-2!==O&&0!==O&&(w.StopPlayBack(J),B.table("selectRow",-1).mouseleave(),w.state("partialEnlarged")&&w.state("partialEnlarged",!1),g(0))}function l(){Q=setInterval(function(){B.table("selectRow",(B.table("getSelectedRow")+1)%N.length)},3e3),G.$("[btn-for=onPlay]").addClass("pause").attr("title",tl("Pause"))}function m(){Q&&(clearInterval(Q),G.$("[btn-for=onPlay]").removeClass("pause").attr("title",tl("Play")))}function n(a){function b(a,b){e===R&&(Math.abs(a-Video.rate)>=1e-4&&(Video.rate=a,r()),A.attr("src",b))}var c=isDDNS()?"http://"+location.hostname+":"+getDDNSMessage().devwebport:"",d=c+"/RPC_Loadfile"+a.FilePath,e=++R;if(void 0===a.ImageRate){var f=new Image;f.src=d,f.onload=function(){a.ImageRate=f.width/f.height,b(a.ImageRate,d)}}else b(a.ImageRate,d)}function o(b){var c=++S,d=a.extend(!0,{Channel:K,Types:[E.val()],Events:"*"},b);u.WorkDirectory.getBitmapEx(G.$("#pla_dataSrc").val(),d).done(function(a){if(c===S)for(var b=a.toString(2),e=b.length;--e;)"1"===b.charAt(b.length-e-1)&&D.calendar("mark",new Date(d.Year,d.Month-1,e))})}function p(b){var c=[],d=[],e=G.$("#pla_recordtype .ui-custom-select-content").empty();if(G.$("#pla_recordtype .ui-custom-select-inputbox").text(""),G.$("#pla_typechks :checkbox:checked:visible").each(function(f,g){var h=G.$(g).prop("id");switch(h){case"pla_normal":a('<li class="ui-custom-select-item" t="w_General"></li>').data("Flags",["Timing"]).appendTo(e),c.push("Timing"),d.push(tl("w_General"));break;case"pla_motion":a('<li class="ui-custom-select-item" t="w_Event"></li>').data("Flags",["Event"]).data("filter","A").appendTo(e),c.push("Event"),d.push(tl("w_Event")),b&&b.EventTypes&&a.isArray(b.EventTypes.M)&&a.each(b.EventTypes.M,function(b,c){a('<li class="ui-custom-select-item" t="'+c+'"></li>').data("Flags",["Event"]).data("Events",[c]).appendTo(e)});break;case"pla_alarm":a('<li class="ui-custom-select-item" t="w_Alarm"></li>').data("Flags",["Event"]).data("filter","M").appendTo(e),c.push("Event"),d.push(tl("w_Alarm"));break;case"pla_manual":a('<li class="ui-custom-select-item" t="w_Manual"></li>').data("Flags",["Manual"]).appendTo(e),c.push("Manual"),d.push(tl("w_Manual"))}}),c.length>1){var f=a('<li class="ui-custom-select-item">'+d.join(", ")+"</li>").data("Flags",c);-1!==a.inArray(tl("w_Event"),d)&&-1===a.inArray(tl("w_Alarm"),d)?f.data("filter","A"):-1!==a.inArray(tl("w_Alarm"),d)&&-1===a.inArray(tl("w_Event"),d)&&f.data("filter","M"),f.prependTo(e)}var g=e.translation().children(":first").addClass("ui-custom-select-item-current");g.length?g.click():D.calendar("select"),b&&b.Support?G.$("#pla_recordtype").show():G.$("#pla_recordtype").hide()}function q(c){function d(){u.MediaFileFind.findNextFile(e,L).done(function(c){T===e&&c.infos&&(a.each(c.infos,function(a,c){var d=c.FilePath.match(/\[[A-Z]\]/)||["[R]"];c[b]=d&&d[0].charAt(1),c[b]!==M&&B.table("add",c,-1)}),"jpg"!==f&&C.timeslider("data",N),c.found===L&&d())})}var e,f=E.val(),g=a.extend(!0,{Channel:K,Dirs:[G.$("#pla_dataSrc").val()],Types:[f],Order:"Ascent",Redundant:"Exclusion",Events:null,Flags:null},c);N.length=0,B.table("dataSource",N),C.timeslider("data",N),A.attr("src","/image/black.png"),"jpg"===f?m():k(),0!==T&&(u.MediaFileFind.close(T),u.MediaFileFind.destroy(T),T=0),void 0!==c&&u.MediaFileFind.create().done(function(a){T=e=a,u.MediaFileFind.findFile(e,g).done(function(){T===e&&d()})})}function r(){var a=Math.max(document.documentElement.clientWidth-30-15-210,750),b=Math.max(document.documentElement.clientHeight-50-37-146,390),c={width:0,height:0};return a/Video.rate<b?(c.width=a,c.height=a/Video.rate-46):(c.width=b*Video.rate,c.height=b-46),c.height<390&&(c.height=390,w.SetShowMode(1)),z.css(c),A.css(c),"jpg"===E.val()||U||w.cover(z),G.$(".playback-right-container").height(c.height-20),B.table("setHeight",Math.min(370,c.height-215)),!1}function s(b){w.hide(),U=!0,a.alert(b,function(){U=!1,"jpg"!==E.val()&&w.cover(z)})}function t(b,c){w.hide(),U=!0,a.confirm(tl("Ok"),b,function(){a.isFunction(c)&&c(),U=!1,"jpg"!==E.val()&&w.cover(z)},function(){U=!1,"jpg"!==E.val()&&w.cover(z)})}var u=require("jsCore/rpc"),v=require("jsCore/ability"),w=require("jsCore/plugin"),x=require("jsCore/rpcLogin"),y=require("jsCore/pageBase");require("widget/js/dui.timeslider"),require("widget/js/dui.slider"),require("widget/js/dui.calendar");var z,A,B,C,D,E,F=require("fisheye"),G=null,H=".playback",I=null,J=0,K=0,L=13,M=null,N=[],O=0,P=null;e.exports=y.extend({init:function(){G=this,I=v.get("QueryDatabase"),z=G.$("#pla_video"),E=G.$("[sel-for=onChangeType]"),A=G.$("#pla_pic").on("click",function(a){var b=G.$(a.target),c=b.width(),d=b.offset().left,e=a.clientX,f=B.table("getSelectedRow");f=c/2>e-d?--f<0?f+N.length:f:++f%N.length,B.table("selectRow",f)}),G.$(".playback-sound-slider").slider({min:0,max:100,value:50,snap:!1,prompt:!1,icons:!1,change:function(a,b){w.PlaySetVolume(J,b.value-100)}}),C=G.$("#pla_timeslider").timeslider({typeKey:b,typeColors:c,channels:[K],complete:function(b,c,d){-1===d?k():(C.data("time",a.pad(b.getHours(),2)+":"+a.pad(b.getMinutes(),2)+":"+a.pad(b.getSeconds(),2)),B.table("selectRow",d),C.data("time",null))}}),B=G.$("#pla_records").table({height:200,pageSize:L,pageable:!0,columns:[{width:"14%",render:function(a){return a._index+1}},{title:tl("w_BeginTime"),width:"29%",render:function(a){return a.StartTime.split(" ")[1]}},{title:tl("File Type"),width:"29%",render:function(a){return'<i class="type-color" style="background-color:'+c[a[b]]+'"></i>'}},{width:"8%",action:"download",render:function(b){return a.isNumeric(b.Process)?'<a data-action="download" class="i-stopdown" style="background-image: url(../image/icons2.png);"></a> ':'<a data-action="download" class="i-download" style="background-image: url(../image/icons2.png);"></a>'},handle:function(b,c){var d=a(c.target),e=d.hasClass("i-stopdown");if(c.stopPropagation(),!x.chkAuthority("Backup"))return s(tl("No right!"));if("jpg"===E.val())d.attr({target:"_download",href:"/RPC_Loadfile"+b.FilePath});else if(e)i();else{if(-2===O)return s(tl("w_Another record file is being downloaded"));if(0!==O)return s(tl("playingNoDownloadRecord"));h(b)}}},{width:"20%",render:function(b){return a.isNumeric(b.Process)?b.Process+"%":""}}],onRowSelect:function(a,b){"jpg"===b.data.Type?n(b.data):j(b.data,C.data("time"))},onRowEnter:function(a,b){G.$("#pla_detail_begin").text(b.data.StartTime),G.$("#pla_detail_end").text(b.data.EndTime),G.$("#pla_detail_size").text((b.data.Length/1024).round()+"(KB)")}}).on("mouseleave",function(){var a=B.table("getSelectedRow");-1!==a?(G.$("#pla_detail_begin").text(N[a].StartTime),G.$("#pla_detail_end").text(N[a].EndTime),G.$("#pla_detail_size").text((N[a].Length/1024).round()+"(KB)")):(G.$("#pla_detail_begin").text(""),G.$("#pla_detail_end").text(""),G.$("#pla_detail_size").text(""))}),B.table("widget").children(":first").off("click","tbody tr").on("dblclick","tbody tr",function(b){return"download"===G.$(b.target).attr("data-action")||"general"!==w.type&&"nacl"!==w.type||B.table("selectRow",a(b.currentTarget).attr("data-index")-0),!1}),G.$("#pla_begin").timefield().timefield("value","00:00:00").find("input").on("blur",function(a){2===G.$(a.target).data("index")&&G.$("#pla_end").find("input:eq(0)").select();var b=G.$("#pla_begin").timefield("value").split(":"),c=G.$("#pla_end").timefield("value").split(":");3600*b[0]+60*b[1]+1*b[2]>3600*c[0]+60*c[1]+1*c[2]&&G.$("#pla_end").timefield("value",b.join(":"))}),G.$("#pla_end").timefield().timefield("value","23:59:59").find("input").on("blur",function(){var a=G.$("#pla_begin").timefield("value").split(":"),b=G.$("#pla_end").timefield("value").split(":");3600*a[0]+60*a[1]+1*a[2]>3600*b[0]+60*b[1]+1*b[2]&&G.$("#pla_begin").timefield("value",b.join(":"))}),D=G.$("#pla_calendar").calendar({maxYear:2037,minYear:2e3,change:function(a,b){o({Year:b.year,Month:b.month})},select:function(b,c){var d=c.year+"-"+a.pad(c.month,2)+"-"+a.pad(c.day,2)+" ",e=G.$("#pla_recordtype .ui-custom-select-item-current");e.length?(M=e.data("filter"),q({StartTime:d+G.$("#pla_begin").timefield("value"),EndTime:d+G.$("#pla_end").timefield("value"),Flags:e.data("Flags"),Events:e.data("Events")})):q()}}),G.$("#pla_recordtype").on("click",".ui-custom-select-input",function(b){var c=G.$(b.currentTarget).toggleClass("ui-custom-select-input-current");return c.hasClass("ui-custom-select-input-current")?(a(document).on("click"+H,function(){a(document).off("click"+H),c.toggleClass("ui-custom-select-input-current"),c.next().hide()}),c.next().show()):(a(document).off("click"+H),c.next().hide()),!1}),G.$("#pla_recordtype").on("click",".ui-custom-select-item",function(a){var b=G.$(a.currentTarget);return b.addClass("ui-custom-select-item-current").siblings().removeClass("ui-custom-select-item-current"),b.parent().hide().prev().removeClass("ui-custom-select-input-current").find(".ui-custom-select-inputbox").text(b.text()),i(),D.calendar("select"),!1}),G.$("#pla_all,#pla_typechks :checkbox").prop("checked",!0),v.get("RecordCaps").done(function(b){b&&a.isArray(b.Format)&&(E.empty(),a.each(b.Format,function(a,b){E.append('<option value="'+b+'" t="'+b+'"></option>')}),E.append('<option value="jpg" t="jpg"></option>')),E.translation()}),P=u.Storage.getDeviceAllInfo().done(function(b){a.isArray(b)&&b.length>1?(G.$("#pla_dataSrc").empty(),a.each(b,function(a,b){b.Detail&&b.Detail[0]&&G.$("#pla_dataSrc").append("<option value="+b.Detail[0].Path+" t=w_sd+"+(a+1)+"></option>")}),G.$("#pla_dataSrc").translation()):a.isArray(b)&&1===b.length&&b[0].Detail&&b[0].Detail[0]&&b[0].Detail[0].Path&&G.$("#pla_dataSrc").empty().append("<option value="+b[0].Detail[0].Path+' t="w_sd"></option>').translation()}),G.$("[btn-for=onCutRegion]").on({mouseover:function(a){var b=G.$(a.target);return 0===O||-2===O?b.attr("title",""):void(b.hasClass("playback-cut-begin-time")?b.addClass("playback-cut-begin-time-hover").attr("title",tl("w_selectStartTime")):b.addClass("playback-cut-end-time-hover").attr("title",tl("w_selectEndTime")))},mouseout:function(a){G.$(a.target).removeClass("playback-cut-begin-time-hover").removeClass("playback-cut-end-time-hover")}}),G.$("#pla_cut_time span:eq(0),#pla_cut_time span:eq(2)").text("00:00:00"),G.$("#pla_cut_time").show(),G.$("#pla_cut_status").hide(),G.$("#pla_percent").width(0),G.$("[btn-for=onCut]").on("mouseover",function(a){var b=G.$(a.target);b.hasClass("playback-cut-download-cancel")?b.attr("title",tl("w_Cancel")):b.attr("title",tl("w_Download"))}).removeClass("playback-cut-download-cancel"),F.bind(G),G.render()},render:function(){a(window).off("resize"+H),a(window).on("resize"+H,r),r(),w.state("recordVideo")&&w.state("recordVideo",!1),G.$("#pla_begin").timefield("value","00:00:00"),G.$("#pla_end").timefield("value","23:59:59"),w.cover(z,function(){w.close(!0),w.SetModuleMode(3),a.browser.ie8&&G.$("[btn-for=onToRecord]").focus()}),a.when(P,v.get("RecordCaps")).always(function(){E.change(),"jpg"!==E.val()&&G.$('[btn-for="onTimeMode"][data-for="24"]').click()}),"jpg"===E.val()&&w.hide(),("qt"===w.type||"vlc"===w.type)&&a("#video").find("qt").hide(),w.addEvent("PlaybackRecordfileFailed",function(){var a=B.table("getSelectedRow");B.find("tbody tr[data-index="+a+"]").addClass("error"),B.table("selectRow",(a+1)%N.length)}),w.addEvent("CurPlayTime",function(a){C.timeslider("value",a)}),w.addEvent("PlayBackOneFileEnd",function(){B.table("selectRow",(B.table("getSelectedRow")+1)%N.length)}),w.addEvent("ResolutionChangePlayBack",r),w.addEvent("FeInstallMode",function(a){F.playbackHasFe(a)})},leave:function(){a(window).off("resize"+H),"qt"===w.type||"vlc"===w.type?a("#video").find("qt").show():w.hide(),w.addEvent("PlaybackRecordfileFailed",null),w.addEvent("CurPlayTime",null),w.addEvent("PlayBackOneFileEnd",null),w.addEvent("ResolutionChangePlayBack",null),w.addEvent("FeInstallMode",null),a("[btn-for=onIVS]").hasClass("play-bottom-iconbg-current")&&(a("[btn-for=onIVS]").removeClass("play-bottom-iconbg-current"),w.SetIVSEnable(!1)),m(),k(),i(),F.fitMode>0&&F.closeFisheEye()},destory:function(){a(window).off("resize"+H),m(),k(),i(),-2===O&&(w.StopDownload(G.$("[btn-for=onCut]").data("savename")),O=0),C.timeslider("destroy")},onToRecord:function(){G.$("#pla_page1").hide(),G.$("#pla_page2").show(),B.table("setHeight",Math.min(370,G.$(".playback-right-container").height()-215))},onToCalendar:function(){G.$("#pla_page2").hide(),G.$("#pla_page1").show(),i()},onTimeMode:function(a){var b=G.$(a.currentTarget),c=60*b.attr("data-for");b.addClass("ui-button-current").siblings().removeClass("ui-button-current"),C.timeslider("total",c)},onSwitchSound:function(a){var b="play-bottom-iconbg-disabled",c=G.$(a.currentTarget);c.hasClass(b)?w.PlayOpenSound(J).done(function(){c.removeClass(b).attr("t","title::w_sound").parent().translation(),G.$(".playback-sound-slider").slider("enable")}):w.PlayStopSound(J).done(function(){c.addClass(b).attr("t","title::Quite").parent().translation()})},onSearch:function(){D.calendar("select")},onChangeSrc:function(){D.calendar("select")},onChangeType:function(b){0!==T&&(u.MediaFileFind.close(T),u.MediaFileFind.destroy(T),T=0);var c=G.$(b.target).val();G.$("#pla_type_tip").attr("t","jpg"===c?"w_SnapType":"Record Type").parent().translation(),"jpg"===c?(G.$(".not-jpg").hide(),G.$("#pla_type_tip").addClass("fn-padl100"),G.$("#pla_format").hide(),A.show(),w.hide(),k()):(G.$(".not-jpg").show("fast",function(){C.timeslider("total",60*G.$(".ui-button-current[btn-for=onTimeMode]").attr("data-for"))}),G.$("#pla_type_tip").removeClass("fn-padl100"),v.get("RecordCaps").done(function(b){b&&-1!==a.inArray("mp4",b.Format)?G.$("#pla_format").hide():G.$("#pla_format").show()}),A.hide(),w.cover(z,function(){w.SetModuleMode(3),a.browser.ie8&&G.$("[btn-for=onToRecord]").focus()}),m()),D.calendar("clearmark");var d=D.calendar("getDay");o({Year:d.year,Month:d.month}),G.$("#pla_all").prop("checked",G.$("#pla_typechks :checkbox:checked:visible").length===G.$("#pla_typechks :checkbox:visible").length),I.done(p)},onPlay:function(a){var b=G.$(a.currentTarget),c=E.val(),d=b.hasClass("pause");"jpg"===c?d?m():l():1===O?w.PausePlayBack(J).done(function(a){a&&g(-1)}):0!==O&&-2!==O?w.ResumePlayBack(J).done(function(a){a&&g(1)}):B.table("selectRow",-1===B.table("getSelectedRow")?0:B.table("getSelectedRow"))},onStop:function(){k()},onNextFrame:function(){w.PlayPreFrame(J).done(function(a){a&&g(-1)})},onSlow:function(){O===1/16?w.ResumePlayBack(J).done(function(a){a&&g(1)}):w.SlowPlayBack(J).done(function(a){a&&g(O/2)})},onFast:function(){16===O?w.ResumePlayBack(J).done(function(a){a&&g(1)}):w.FastPlayBack(J).done(function(a){a&&g(2*O)})},onTypeAll:function(a){G.$("#pla_typechks :checkbox").prop("checked",G.$(a.target).prop("checked")),I.done(p)},onTypeNormal:function(){G.$("#pla_all").prop("checked",G.$("#pla_typechks :checkbox:checked:visible").length===G.$("#pla_typechks :checkbox:visible").length),I.done(p)},onTypeEvent:function(){G.$("#pla_all").prop("checked",G.$("#pla_typechks :checkbox:checked:visible").length===G.$("#pla_typechks :checkbox:visible").length),I.done(p)},onTypeAlarm:function(){G.$("#pla_all").prop("checked",G.$("#pla_typechks :checkbox:checked:visible").length===G.$("#pla_typechks :checkbox:visible").length),I.done(p)},onTypeManual:function(){G.$("#pla_all").prop("checked",G.$("#pla_typechks :checkbox:checked:visible").length===G.$("#pla_typechks :checkbox:visible").length),I.done(p)},onCutRegion:function(b){var c=G.$(b.target),d=G.$("#pla_cut_time span").eq(0),e=G.$("#pla_cut_time span").eq(2),f=d.text(),g=e.text(),h=C.timeslider("value")[K],i=a.pad(h.getHours(),2)+":"+a.pad(h.getMinutes(),2)+":"+a.pad(h.getSeconds(),2);G.$("#pla_cut_time").show(),G.$("#pla_cut_status").hide(),G.$("#pla_percent").width(0),c.hasClass("playback-cut-begin-time")?(c.removeClass("playback-cut-begin-time playback-cut-begin-time-hover").addClass("playback-cut-end-time playback-cut-end-time-hover").attr("title",tl("w_selectEndTime")),f=i):(c.removeClass("playback-cut-end-time playback-cut-end-time-hover").addClass("playback-cut-begin-time playback-cut-begin-time-hover").attr("title",tl("w_selectStartTime")),g=i);var j=f.split(":"),k=g.split(":");if(23==j[0]&&59==j[1]&&j[2]>=54)g="23:59:59";else if(3600*k[0]-3600*j[0]+60*k[1]-60*j[1]+1*k[2]-1*j[2]<5){var l=new Date("2000/1/1 "+f).addSeconds(5);g=a.pad(l.getHours(),2)+":"+a.pad(l.getMinutes(),2)+":"+a.pad(l.getSeconds(),2)}d.text(f),e.text(g)},onCut:function(b){function c(){var a=l.replace(/[-:\s]/g,"")+"-"+m.replace(/[-:\s]/g,"")+"."+G.$("#pla_format input:checked").val();w.DownloadByTime(n,l,m,"VideoClips",a).done(function(b){b?(O=-2,d.data("savename",a).addClass("playback-cut-download-cancel").attr("title",tl("w_Cancel")),e.hide(),f.show().text(tl("w_downloading")),w.addEvent("DownloadPos",function(a){g.width(148*a/100),100===a?(O=0,d.removeClass("playback-cut-download-cancel").attr("title",tl("w_Download")),f.text(tl("Download Completely!")),w.addEvent("DownloadPos",null)):f.text(tl("w_downloading")+"  "+a+"%")}),w.addEvent("DownLoadError",function(){G.$("[btn-for=onCut]").click(),s(tl("w_noSupportMp4"))})):s(tl("w_No Write Right"))})}var d=G.$(b.target),e=G.$("#pla_cut_time"),f=G.$("#pla_cut_status"),g=G.$("#pla_percent"),h=d.hasClass("playback-cut-download-cancel");if(!x.chkAuthority("Backup"))return s(tl("No right!"));if(h)w.StopDownload(d.data("savename")),e.show(),f.hide(),g.width(0),O=0,d.removeClass("playback-cut-download-cancel"),w.addEvent("DownLoadError",null);else{if(-2===O)return s(tl("w_Another record file is being downloaded"));if(!e.is(":visible"))return;var i=D.calendar("getDay"),j=i.year+"-"+a.pad(i.month,2)+"-"+a.pad(i.day,2)+" ",l=j+e.children(":first").text(),m=j+e.children(":last").text();if(l===m)return s(tl("w_Start time and end time could not be the same time"));var n=a.grep(N,function(a){return a.StartTime<m&&a.EndTime>l});if(0===n.length)return s(tl("w_The time period has no record file"));0!==O?t(tl("Can't download file and playback in the Same time, Close the Player?"),function(){k(),c()}):c()}},onSnap:function(){w.CatchPicture(6,"PlaybackSnapshot"),G.$("#snapTip").fadeIn("slow"),G.$("#snapTip").fadeOut("slow"),G.$("#snapTip").text(tl("snap successfully"))},onEnlarge:function(a){v.is("DSPConflict").done(function(b){w.partialEnlarged(G.$(a.target)).done(function(){w.state("partialEnlarged")?(w.addEvent("RButtonDown",function(a){b||!webApp.IsIPCIntel&&!webApp.IsSDIntel||G.$("[btn-for=onIVS]").show().hasClass("play-bottom-iconbg-current")&&w.SetIVSEnable(!0),0===a&&w.state("partialEnlarged",!1)}),b||!webApp.IsIPCIntel&&!webApp.IsSDIntel||G.$("[btn-for=onIVS]").hide().hasClass("play-bottom-iconbg-current")&&w.SetIVSEnable(!1),F.reFishEye()):(w.addEvent("RButtonDown",null),b||!webApp.IsIPCIntel&&!webApp.IsSDIntel||G.$("[btn-for=onIVS]").show().hasClass("play-bottom-iconbg-current")&&w.SetIVSEnable(!0).done(function(a){a||G.$("[btn-for=onIVS]").removeClass("play-bottom-iconbg-current")}))})})},onIVS:function(a){var b=G.$(a.currentTarget);w.SetIVSEnable(!b.hasClass("play-bottom-iconbg-current")).done(function(a){a&&b.toggleClass("play-bottom-iconbg-current")})}});var Q=null,R=0,S=0,T=0,U=!1}),define("fisheye",function(require,b,c){c.exports={me:null,fisheye:null,fitMode:0,MountModeArr:["CeilMode","WallMode","FloorMode","WallMode"],bind:function(a){me=a,fisheye=this,me.$("#onFishEye").on("click",function(){me.$("#playback-fisheye-mode").show()}),me.$("#playback-fisheye-fitMode").delegate("li","click",this.onFitModeChange),me.$("#playback-fisheye-playMode").delegate("li","click",this.onPlayModeChange),me.$("#playback-fisheye-mode").on("mouseleave",function(){me.$("#playback-fisheye-mode").hide()})},onFitModeChange:function(b){var c=a(b.target);c.siblings(".current").removeClass("current"),c.addClass("current");var d=c.attr("data-for")-0,e=c.attr("id").split("_");fisheye.showPlayModeByFitMode(e[1]),plugin.SetFeInstallMode(d),me.$("#playback-fisheye-playMode li:first").click()},onPlayModeChange:function(b){var c=a(b.target);c.siblings(".current").removeClass("current"),c.addClass("current");var d=c.attr("data-for")-0;d>0&&(me.$("[btn-for = onIVS]").hasClass("play-bottom-iconbg-current")&&me.$("[btn-for = onIVS]").click(),plugin.state("partialEnlarged")&&plugin.state("partialEnlarged",!1)),plugin.SetFeShowMode(d)},showPlayModeByFitMode:function(b){a("#playback-fisheye-playMode li").each(function(c,d){a(d).attr("support-for").indexOf(b)>-1?a(d).show():a(d).hide()})},playbackHasFe:function(a){if(a>0){var b=fisheye.fitMode;fisheye.fitMode=a;var c=fisheye.MountModeArr[a-1];fisheye.showPlayModeByFitMode(c),me.$("#onFishEye").show(),a!=b&&me.$("#playback_"+c).click()}else fisheye.closeFisheEye()},closeFisheEye:function(){me.$("#onFishEye").hide(),me.$("#playback-fisheye-mode").hide(),plugin.ControlFe(!1)},reFishEye:function(){fisheye.fitMode>0&&me.$("#playback-fisheye-playMode li:first").click()}}})}(jQuery);