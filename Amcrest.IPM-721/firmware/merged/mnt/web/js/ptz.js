!function(a){define(function(require,b,c){function d(){e(),"Original Rate"===webApp.DisplayMode&&setTimeout(e,100)}function e(){var a=10,b=h.$(".main-right-container").width()||-10,c=h.$(".main-bottom").width(),d=h.$(".main-right-container").parent(),e=c-a-b,g=Math.max(document.documentElement.clientHeight-56-54-33,390),i=webApp.DisplayMode;switch(k.videoBar("hasItem","video_triggerTrack")&&"Original Rate"==webApp.DisplayMode&&(i="adapted window"),i){case"Original Size":Video.resolution.x&&Video.resolution.y&&("nacl"!==f.type||e>=Video.resolution.x)&&(e=Video.resolution.x,g=Video.resolution.y),d.css({width:e+a+b,margin:"0 auto"});break;case"Original Rate":e=c-a-b,e/Video.rate<g?g=e/Video.rate:e=g*Video.rate,d.css({width:e+a+b,margin:"0 auto"});break;default:d.css({width:c,margin:"0"})}return j.css({width:e,height:g,background:"inherit"}),k.css("width",e),l||f.cover(j),!1}var f=(require("jsCore/rpc"),require("jsCore/plugin")),g=(require("jsCore/ability"),require("common/common").Cookie,require("jsCore/rpcLogin"),require("jsCore/pageBase"));require("jsCore/modules/ptzControl"),require("jsCore/modules/ptzSetting"),require("jsCore/modules/zoomFocus"),require("jsCore/modules/videoBar");var h=null,i=".ptz",j=null,k=null;c.exports=g.extend({init:function(){h=this,j=h.$(".main-video"),k=h.$(".ui-video-bar").videoBar(),h.$(".main-ptz-control").ptzControl(),h.$(".main-ptz-setting").ptzSetting(),h.$(".main-zoom-focus").zoomFocus({type:"preview"}),h.render()},render:function(){a(window).off("resize"+i),a(window).on("resize"+i,d),h.$(".main-ptz-setting").ptzSetting("render"),k.videoBar("render",{showImage:!1,showTrigger:!1,modeChange:d,zoomOn:function(){h.$(".main-zoom-focus").zoomFocus("render").show()},zoomOff:function(){h.$(".main-zoom-focus").zoomFocus("leave").hide()}}),k.videoBar("isCurrent","video_zoomFocus")?h.$(".main-zoom-focus").zoomFocus("render").show():h.$(".main-zoom-focus").zoomFocus("leave").hide(),f.cover(j,function(b){f.SetModuleMode(0);var c=a(b?"a[btn-for=onConnectMain]":"a.current[btn-for^=onConnect]");a("a[btn-for^=onConnect]").removeClass("current"),c.click(),k.videoBar("isCurrent","video_ivsRule",0)?f.SetIVSEnable(!0):k.videoBar("hasItem","video_triggerTrack")&&(f.SetIVSEnable(!0),f.ShowRuleState(!1))}),f.addEvent("ResolutionChangePTZ",d),f.addEvent("DeviceReconnectedPTZ",function(){k.videoBar("isCurrent","video_ivsRule",0)&&f.SetIVSEnable(!0)}),d()},leave:function(){a(window).off("resize"+i),k.videoBar("isCurrent","video_zoomFocus")&&h.$(".main-zoom-focus").zoomFocus("leave").hide(),f.SetIVSEnable(!1),f.hide(),f.close(),f.addEvent("ResolutionChangePTZ",null),f.addEvent("DeviceReconnectedPTZ",null),f.state("activePTZLocate")&&f.state("activePTZLocate",!1)},destory:function(){a(window).off("resize"+i),k.videoBar("isCurrent","video_zoomFocus")&&h.$(".main-zoom-focus").zoomFocus("leave").hide(),k.videoBar("destroy")}});var l=!1})}(jQuery);