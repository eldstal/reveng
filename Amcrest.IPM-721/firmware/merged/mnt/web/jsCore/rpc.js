!function(a){define(function(require,b,c){var d=require("common/rpcBase"),e=require("common/common"),f=(e.Cookie,c.exports={});a.extend(!0,f,d),f.Integration=new function(){this.getLogCount=function(b){var c,e=this;return c=e.token?d.Log.stopFind(e.token).then(function(){return d.Log.startFind(b)}):d.Log.startFind(b),c.then(function(b){return b?(e.token=b,d.Log.getCount(e.token)):0===b?a.Deferred(function(a){a.resolve(0)}).promise():void 0})},this.getLog=function(b,c){return this.token?d.Log.doSeekFind(this.token,b,c):a.Deferred(function(a){a.reject()}).promise()},this.formatPatition=function(b,c,e){function f(){return d.DevStorage.formatPatition(b,c,e).always(function(){d.RecordManager.start(),d.SnapManager.start()})}var g=d.RecordManager.stop(),h=d.SnapManager.stop();return a.when(g,h).then(f,f)},this.formatPatitionOld=function(b,c){function e(){return d.send("devStorage.formatPatition",{pointer:b,part:c}).always(function(){d.RecordManager.start(),d.SnapManager.start()})}var f=d.RecordManager.stop(),g=d.SnapManager.stop();return a.when(f,g).then(e,e)}};var g=["PPPoE","Mobile","Wireless","DDNS","Wire802_1X","LDAP","PPPoE","SNMP","VPN","Email","NAS","WLan","VSP_GAYS"];f.ConfigManager.getConfig=function(b){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&-1!==a.inArray(b,g)?a.Deferred(function(a){e.EncryptInfo(webApp.EncryptInfo.pub,{name:b}).done(function(b){f.Security.getConfig(b.salt,"AES-128",b.content).done(function(c){e.UnEncryptInfo(b.key,c).done(function(b){a.resolve(b.table)})}).fail(a.reject)})}).promise():d.ConfigManager.getConfig(b)},f.ConfigManager.setConfig=function(b,c){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric&&-1!==a.inArray(b,g)?a.Deferred(function(a){e.EncryptInfo(webApp.EncryptInfo.pub,{name:b,table:c}).done(function(b){f.Security.setConfig(b.salt,"AES-128",b.content).done(function(c){c?e.UnEncryptInfo(b.key,c).done(function(b){a.resolve(b.options)}):a.resolve()}).fail(function(c){c.params&&c.params.content?e.UnEncryptInfo(b.key,c.params.content).done(function(b){c.params.options=b.options,a.reject(c)}):a.reject(c)})})}).promise():d.ConfigManager.setConfig(b,c)},f.UserManager.addUser=function(b){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric?a.Deferred(function(a){e.EncryptInfo(webApp.EncryptInfo.pub,{user:b}).done(function(b){f.Security.addUser(b.salt,"AES-128",b.content).done(a.resolve).fail(a.reject)})}).promise():d.UserManager.addUser(b)},f.UserManager.modifyPassword=function(b,c,g){return webApp.EncryptInfo&&webApp.EncryptInfo.asymmetric?a.Deferred(function(a){e.EncryptInfo(webApp.EncryptInfo.pub,{name:b,pwd:c,pwdOld:g}).done(function(b){webCaps.OnvifSync?f.Security.modifyPasswordPlain(b.salt,"AES-128",b.content).done(a.resolve).fail(a.reject):f.Security.modifyPasswordByType(b.salt,"AES-128",b.content).done(a.resolve).fail(a.reject)})}).promise():d.UserManager.modifyPassword(b,c,g)},f.Storage.getDeviceAllInfo=function(){return d.send("storage.getDeviceAllInfo").then(function(a){return a.params.info||a.params})},f.IntervideoManager.getVersion=function(b){return webApp.IsNewProtocol?d.IntervideoManager.getVersion(b):a.Deferred(function(a){d.send("IntervideoManager.factory.instance").done(function(c){c.result&&d.send("IntervideoManager.getVersion",{Name:b},{object:c.result}).done(function(b){a.resolve({Onvif:b.params.Version})})})}).promise()},f.DevAudioDetect.detachDetectData=function(a,b){return webApp.IsNewProtocol?d.DevAudioDetect.detachDetectData(a,b):d.send("devAudioDetect.detachDetectData",{proc:b,channel:a})},f.DevAudioDetect.attachDetectData=function(a,b){return webApp.IsNewProtocol?d.DevAudioDetect.attachDetectData(a,b):d.send("devAudioDetect.attachDetectData",{proc:b,channel:a})},f.PTZ.getProtocolList=function(b){return this.instance({channel:b||0}).then(function(b){return d.send("ptz.getProtocolList",void 0,{object:b.result}).then(function(b){return"boolean"===a.type(b.result)?b.params.list:b.result})})},f.PTZ.start=function(a,b,c,e,f,g){var h=this;return this.instance({channel:g||0}).then(function(i){return d.send("ptz.start",{code:a,arg1:b,arg2:c,arg3:e,arg4:f,channel:webApp.IsNewProtocol?void 0:g||0},{object:i.result,seq:h._getSeq()}).fail(function(a){a&&a.error&&285475072===a.error.code&&alert(tl("Please set PTZ protocol of this channel first!"))})})},f.PTZ.stop=function(a,b,c,e,f,g){var h=this;return this.instance({channel:g||0}).then(function(i){return d.send("ptz.stop",{code:a,arg1:b,arg2:c,arg3:e,arg4:f,channel:webApp.IsNewProtocol?void 0:g||0},{object:i.result,seq:h._getSeq()}).fail(function(a){a&&a.error&&285475072===a.error.code&&alert(tl("Please set PTZ protocol of this channel first!"))})})},f.NetApp.getUPnPStatus=function(){return d.send("netApp.getUPnPStatus").then(function(a){return a.params})},f.NetApp.refreshUpnpRouter=function(){return d.send("netApp.refreshUpnpRouter")},f.WorkDirectory.setType=function(a,b){return d.send("workDirectory.setType",{pointer:a,type:b})},f.RadiometryManager=new function(){this.getRandomPointTemper=function(a,b){return f.send("RadiometryManager.getRandomPointTemper",{coordinate:a,channel:b})},this.getTemper=function(a){return f.send("RadiometryManager.getTemper",{condition:a})},this.getCaps=function(a,b){return f.send("RadiometryManager.getCaps",{name:a||"All",channel:b||0}).then(function(a){return a.params.caps})},this.startFind=function(a){return f.send("RadiometryManager.startFind",{condition:a})},this.doFind=function(a,b,c){return f.send("RadiometryManager.doFind",{token:a,beginNumber:b,count:c})},this.attachProc=function(a,b){return f.send("RadiometryManager.attachProc",{channel:b,proc:a})},this.detachProc=function(a,b){return f.send("RadiometryManager.detachProc",{channel:b,proc:a})},this.toFetch=function(a){return f.send("RadiometryManager.toFetch",{info:{Channel:a}})},this.startRadiometryCalibration=function(a,b){return f.send("RadiometryManager.startRadiometryCalibration",{channel:a,info:b})},this.radiometryCalibration=function(a,b,c){return f.send("RadiometryManager.radiometryCalibration",{channel:a,index:b,blackBody:{Temperature:c}})},this.saveRadiometryCalibration=function(a){return f.send("RadiometryManager.saveRadiometryCalibration",{channel:a})},this.abortRadiometryCalibration=function(a){return f.send("RadiometryManager.abortRadiometryCalibration",{channel:a})},this.getRadiometryCalibrationInfo=function(a){return f.send("RadiometryManager.getRadiometryCalibrationInfo",{channel:a})},this.getCalibrateCompleteInfo=function(a){return f.send("RadiometryManager.getCalibrateCompleteInfo",{channel:a})}},f.ThermographyNuc=new function(){this.getLensInfo=function(a){return f.send("ThermographyNuc.getLensInfo",{channel:a})},this.setLensId=function(a,b){return f.send("ThermographyNuc.setLensId",{channel:a,lensId:b})},this.start=function(a,b){return f.send("ThermographyNuc.start",{channel:a,backupEnable:b})},this.abort=function(a){return f.send("ThermographyNuc.abort",{channel:a})},this.getProgress=function(a,b){return f.send("ThermographyNuc.getProgress",{channel:a,type:b})},this.captureGain=function(a,b){return f.send("ThermographyNuc.captureGain",{channel:a,blackbodyId:b})},this.saveGainMap=function(a){return f.send("ThermographyNuc.saveGainMap",{channel:a})},this.restorePrepare=function(a,b){return f.send("ThermographyNuc.restorePrepare",{channel:a,fileName:b})},this.restoreExecute=function(a){return f.send("ThermographyNuc.restoreExecute",{channel:a})},this.restoreFactoryGainMap=function(a){return f.send("ThermographyNuc.restoreFactoryGainMap",{channel:a})},this.getParams=function(a){return f.send("ThermographyNuc.getParams",{channel:a})},this.setParams=function(a,b,c){return f.send("ThermographyNuc.setParams",{channel:a,info:{FocalLength:b,VenderID:c}})},this.getCoreExInfo=function(a){return f.send("ThermographyNuc.getCoreExInfo",{channel:a})},this.sffcStart=function(a){return f.send("ThermographyNuc.sffcStart",{channel:a})},this.sffcAbort=function(a){return f.send("ThermographyNuc.sffcAbort",{channel:a})},this.sffcBlackBody=function(a){return f.send("ThermographyNuc.sffcBlackBody",{channel:a})},this.sffcSave=function(a){return f.send("ThermographyNuc.sffcSave",{channel:a})},this.checkImgUniformity=function(a){return f.send("ThermographyNuc.checkImgUniformity",{channel:a})},this.getCalibrateCompleteInfo=function(a){return f.send("ThermographyNuc.getCalibrateCompleteInfo",{channel:a})},this.bpcStart=function(a){return f.send("ThermographyNuc.bpcStart",{channel:a})},this.bpcAbort=function(a){return f.send("ThermographyNuc.bpcAbort",{channel:a})},this.bpcSave=function(a){return f.send("ThermographyNuc.bpcSave",{channel:a})},this.bpcRestoreFactorySettings=function(a){return f.send("ThermographyNuc.bpcRestoreFactorySettings",{channel:a})}}})}(jQuery);