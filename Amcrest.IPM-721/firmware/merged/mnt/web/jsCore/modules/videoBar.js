!function(a){define(function(require,b,c){function d(){var b=this,c=[{id:"video_image",title:"w_Image Adjust Config",iconCls:"ui-video-icon-image",type:"Side",on:function(){i.o.imageOn()},off:function(){i.o.imageOff()}},{id:"video_original",title:"FullRes Show",iconCls:"ui-video-icon-per",type:"Single",on:function(b){-1!==e.stream&&("Original Size"!==webApp.DisplayMode&&f.set("DHVideoWHModeOld",webApp.DisplayMode,{duration:30,path:"/"}),webApp.DisplayMode="Original Size",e.SetShowMode(0),f.set("DHVideoWHMode",webApp.DisplayMode,{duration:30,path:"/"}),i.hideItem("video_whRate"),i.o.modeChange(),a(b.target).attr("title",tl("FullRes Hide")))},off:function(b){i.hideItem("video_whRate",!1),i.toggleCurrent("video_whRate","Original Rate"===f.get("DHVideoWHModeOld")?0:1),a(b.target).attr("title",tl("FullRes Show"))}},{id:"video_whRate",title:"WHRate",iconCls:"ui-video-icon-wh",type:"Sub",subElems:[{t:"Original Rate",handle:function(){if(-1!==e.stream){if(webApp.DisplayMode="Original Rate",f.set("DHVideoWHMode",webApp.DisplayMode,{duration:30,path:"/"}),i.hasItem("video_triggerTrack"))if(i.o.showTrigger){var a=i.o.trackMode();e.SetShowMode(a?2:1)}else e.SetShowMode(1);e.SetShowMode(1),i.o.modeChange()}}},{t:"adapted window",handle:function(){-1!==e.stream&&(webApp.DisplayMode="Adaptive Window",f.set("DHVideoWHMode",webApp.DisplayMode,{duration:30,path:"/"}),i.hasItem("video_triggerTrack")&&e.SetShowMode(0),e.SetShowMode(0),i.o.modeChange(webApp.DisplayMode))}}]},{id:"video_fluency",title:"Adjust fluency",iconCls:"ui-video-icon-quality",type:"Sub",subElems:[{t:"w_Real Time",handle:function(){e.SetDelayTime(5)}},{t:"w_Normal",handle:function(){e.SetDelayTime(4)}},{t:"w_Fluency",handle:function(){e.SetDelayTime(1)}}]}];k=a.when(e.CheckFuncSupport(2),ability.get("VideoAnalyse"),ability.get("VideoInputCapsEx"),ability.get("VideoInputCaps"),ability.get("WideViewControl"),ability.get("IVSCaps")).always(function(d,h,k,l,m,n){if(d&&c.splice(2,0,{id:"video_fullScreen",title:"Fullscreen Open",iconCls:"ui-video-icon-full",type:"Normal",click:function(){e.SetFullScreen()}}),-1!=webApp.DeviceType.indexOf("SD")&&h&&h.Support&&c.push({id:"video_ivsRule",title:"w_ivsRule",iconCls:"ui-video-icon-ivs",type:"Sub",subElems:[{t:"enable",handle:function(){e.SetIVSEnable(!0)}},{t:"disable",handle:function(){i.hasItem("video_triggerTrack")?e.ShowRuleState(!1):e.SetIVSEnable(!1)}}]}),c.push({id:"video_ptz",title:"w_PtzLink",iconCls:"ui-video-icon-ptz",type:"Side",on:function(){i.o.ptzOn()},off:function(){i.o.ptzOff()}}),(k&&k.ABFFunction.Support||l&&(l.ElectricFocus||l.SyncFocus))&&g.chkAuthority("VideoInputConfig")&&g.chkAuthority("Monitor_01")&&c.push({id:"video_zoomFocus",title:"w_zoomFocus",iconCls:"ui-video-icon-adjust",type:"Side",on:function(){i.o.zoomOn()},off:function(){i.o.zoomOff()}}),m&&m[0]&&m[0].Support&&c.push({id:"video_wideview",title:"WideView",iconCls:"ui-video-icon-wideview",type:"Single",on:function(a){i.o.wideviewOn(a)},off:function(a){i.o.wideviewOff(a)}}),!webApp.IsSDIntel&&n){var o=n.SupportedScenes||[],p=!1;a.each(o,function(b,d){if(p)return!1;var e=d.SupportedRules||[];a.each(e,function(a,b){return b.TriggerTrack?(c.push({id:"video_triggerTrack",title:"w_TriggerTrack",iconCls:"ui-video-icon-triggerTrack",type:"Side",on:function(){i.o.trackOn()},off:function(){i.o.trackOff()}}),p=!0,!1):void 0})})}l&&l.FishEye&&g.chkAuthority("VideoInputConfig")&&c.push({id:"video_fisheye",title:"fisheyevideo",iconCls:"ui-video-icon-fish",type:"Side",on:function(){i.o.fishEyeOn()},off:function(){i.o.fishEyeOff()}}),c.push({id:"video_svac",title:"w_svac",iconCls:"ui-video-icon-svc",type:"Sub",subElems:[{t:"baseLevel",handle:function(){e.ChooseFrame(0)}},{t:"enhancementLevel",handle:function(){e.ChooseFrame(1)}}]}),c.push({id:"video_rayright",title:"rayRight",iconCls:"ui-video-icon-ray",type:"Single",on:function(){e.ActiveCrossLocation(!0),i.o.crossLocationOn()},off:function(){e.ActiveCrossLocation(!1),i.o.crossLocationOff()}}),a.each(c,function(c,d){var e=a('<div class="ui-video-iconbar"></div>'),f=a('<a href="javascript:;" class="ui-video-icon" itemtype='+d.type+" id="+d.id+"><i></i></a>");d.title&&f.attr("t","title::"+d.title),d.iconCls&&f.children("i").addClass(d.iconCls),j.append(e.append(f));var g="_init"+d.type;a.isFunction(b[g])&&b[g](d,f)}),j.translation(),i.toggleCurrent("video_fluency",1),i.toggleCurrent("video_svac",0),i.hasItem("video_triggerTrack")&&("Original Size"==webApp.DisplayMode?(f.set("DHVideoWHModeOld","Original Rate"),i.toggleCurrent("video_original",1)):i.toggleCurrent("video_whRate",0)),h&&h.Support&&i.toggleCurrent("video_ivsRule",0)})}var e=require("../plugin"),f=require("common/common").Cookie,g=(require("../rpc"),require("../rpcLogin")),h={showImage:!0,showPtz:!1,showRayRight:!1,showTrigger:!0,imageOn:a.noop,imageOff:a.noop,ptzOn:a.noop,ptzOff:a.noop,modeChange:a.noop,zoomOn:a.noop,zoomOff:a.noop,wideviewOn:a.noop,wideviewOff:a.noop,trackOn:a.noop,trackOff:a.noop,crossLocationOn:a.noop,crossLocationOff:a.noop,fishEyeOn:a.noop,fishEyeOff:a.noop},i=null,j=a("<div></div>"),k=null;a.fn.videoBar=function(){var b=arguments[0],c=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],e=this;return this.each(function(){if(!("string"!==a.type(b)||i&&a.isFunction(i[b])))return!1;if("string"===a.type(b)){var f=i[b].apply(a(this),c);if(void 0!==f)return e=f,!1}else"string"===a.type(b)||i||(i=new d)}),e},d.prototype.render=function(b){i.o=a.extend({},h,b),this.append(j),i.hideItem("video_image",i.o.showImage===!1),i.hideItem("video_ptz",i.o.showPtz===!1),i.hideItem("video_rayright",i.o.showRayRight===!1),i.hideItem("video_triggerTrack",i.o.showTrigger===!1)},d.prototype.destroy=function(){i=null,j.empty()},d.prototype.hideItem=function(a,b){k.always(function(){var c=j.find("#"+a);b===!1?c.show().hasClass("current")&&c.next(".ui-video-wrap").show():c.hide().hasClass("current")&&c.next(".ui-video-wrap").hide()})},d.prototype.toggleCurrent=function(a,b){k.always(function(){var c=j.find("#"+a);void 0===b?c.click():c.next(".ui-video-wrap").find(".ui-video-wrap-item:eq("+b+")").click()})},d.prototype.isCurrent=function(a,b){var c=j.find("#"+a);return void 0===b?c.hasClass("current"):c.next(".ui-video-wrap").find(".ui-video-wrap-item:eq("+b+")").hasClass("current")},d.prototype.hasItem=function(a){var b=j.find("#"+a);return b.length},d.prototype._initSide=function(b,c){c.on("click",function(d){return c.hasClass("current")?(c.removeClass("current"),a(b.target).hide(),b.off(d)):(j.find(".ui-video-icon.current[itemtype="+c.attr("itemtype")+"]").click(),c.addClass("current"),a(b.target).show(),b.on(d))})},d.prototype._initNormal=function(a,b){b.on("click",function(b){return a.click(b)})},d.prototype._initSingle=function(a,b){b.on("click",function(c){return b.hasClass("current")?(b.removeClass("current"),a.off(c)):(b.addClass("current"),a.on(c))})},d.prototype._initSub=function(b,c){var d=a('<div class="ui-video-wrap"></div>');a.each(b.subElems,function(b,e){var f=a('<a href="javascript:;" class="ui-video-wrap-item"><i class="ui-video-wrap-icon"></i><label t="'+e.t+'"></label></a>').on("click",function(b){d.find(".ui-video-wrap-item").removeClass("current"),j.find(b.currentTarget).addClass("current"),a.isFunction(e.handle)&&e.handle(),c.trigger("click",[b.isTrigger])});d.append(f)}),c.parent().append(d),c.on("click",function(a,b){return b?!1:(c.hasClass("current")||j.find(".ui-video-icon.current[itemtype="+c.attr("itemtype")+"]").click(),c.toggleClass("current"),void d.toggle())})},c.exports=d})}(jQuery);